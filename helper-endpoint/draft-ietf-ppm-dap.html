<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Distributed Aggregation Protocol for Privacy Preserving Measurement</title>
<meta content="Tim Geoghegan" name="author">
<meta content="Christopher Patton" name="author">
<meta content="Eric Rescorla" name="author">
<meta content="Christopher A. Wood" name="author">
<meta content="
       There are many situations in which it is desirable to take measurements of data
which people consider sensitive. In these cases, the entity taking the
measurement is usually not interested in people's individual responses but
rather in aggregated data. Conventional methods require collecting individual
responses and then aggregating them, thus representing a threat to user privacy
and rendering many such measurements difficult and impractical. This document
describes a multi-party distributed aggregation protocol (DAP) for privacy
preserving measurement (PPM) which can be used to collect aggregate data without
revealing any individual user's data. 
    " name="description">
<meta content="xml2rfc 3.17.1" name="generator">
<meta content="draft-ietf-ppm-dap-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.17.1
    Python 3.10.11
    appdirs 1.4.4
    ConfigArgParse 1.5.3
    google-i18n-address 2.5.2
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.2
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.28.1
    setuptools 65.6.0
    six 1.16.0
    wcwidth 0.2.6
-->
<link href="draft-ietf-ppm-dap.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 1;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl.olPercent {
  --indent: 5ch;
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
dl.olPercent > dt {
  min-width: calc(var(--indent) - 2ch);
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dt:target::before {
  content: "⇒";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 8em !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Give the table caption label the same styling as the figcaption */

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  dd {
    page-break-before: avoid;
  }
  .vcard {
    page-break-inside: avoid;
  }

}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">DAP-PPM</td>
<td class="right">April 2023</td>
</tr></thead>
<tfoot><tr>
<td class="left">Geoghegan, et al.</td>
<td class="center">Expires 29 October 2023</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-ppm-dap-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2023-04-27" class="published">27 April 2023</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2023-10-29">29 October 2023</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">T. Geoghegan</div>
<div class="org">ISRG</div>
</div>
<div class="author">
      <div class="author-name">C. Patton</div>
<div class="org">Cloudflare</div>
</div>
<div class="author">
      <div class="author-name">E. Rescorla</div>
<div class="org">Mozilla</div>
</div>
<div class="author">
      <div class="author-name">C. A. Wood</div>
<div class="org">Cloudflare</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Distributed Aggregation Protocol for Privacy Preserving Measurement</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">There are many situations in which it is desirable to take measurements of data
which people consider sensitive. In these cases, the entity taking the
measurement is usually not interested in people's individual responses but
rather in aggregated data. Conventional methods require collecting individual
responses and then aggregating them, thus representing a threat to user privacy
and rendering many such measurements difficult and impractical. This document
describes a multi-party distributed aggregation protocol (DAP) for privacy
preserving measurement (PPM) which can be used to collect aggregate data without
revealing any individual user's data.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-about-this-document">
<a href="#name-about-this-document" class="section-name selfRef">About This Document</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">
        The latest revision of this draft can be found at <span><a href="https://ietf-wg-ppm.github.io/draft-ietf-ppm-dap/draft-ietf-ppm-dap.html">https://ietf-wg-ppm.github.io/draft-ietf-ppm-dap/draft-ietf-ppm-dap.html</a></span>.
        Status information for this document may be found at <span><a href="https://datatracker.ietf.org/doc/draft-ietf-ppm-dap/">https://datatracker.ietf.org/doc/draft-ietf-ppm-dap/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">
        Discussion of this document takes place on the
        Privacy Preserving Measurement Working Group mailing list (<span><a href="mailto:ppm@ietf.org">mailto:ppm@ietf.org</a></span>),
        which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/ppm/">https://mailarchive.ietf.org/arch/browse/ppm/</a></span>.
        Subscribe at <span><a href="https://www.ietf.org/mailman/listinfo/ppm/">https://www.ietf.org/mailman/listinfo/ppm/</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
<p id="section-note.1-4">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/ietf-wg-ppm/draft-ietf-ppm-dap">https://github.com/ietf-wg-ppm/draft-ietf-ppm-dap</a></span>.<a href="#section-note.1-4" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 29 October 2023.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2023 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-change-log" class="internal xref">Change Log</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="auto internal xref">1.2</a>.  <a href="#name-conventions-and-definitions" class="internal xref">Conventions and Definitions</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-overview" class="internal xref">Overview</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="auto internal xref">2.1</a>.  <a href="#name-system-architecture" class="internal xref">System Architecture</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="auto internal xref">2.2</a>.  <a href="#name-validating-inputs" class="internal xref">Validating Inputs</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-message-transport" class="internal xref">Message Transport</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-https-request-authenticatio" class="internal xref">HTTPS Request Authentication</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-errors" class="internal xref">Errors</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-protocol-definition" class="internal xref">Protocol Definition</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-queries" class="internal xref">Queries</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.1">
                    <p id="section-toc.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="auto internal xref">4.1.1</a>.  <a href="#name-time-interval-queries" class="internal xref">Time-interval Queries</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.2">
                    <p id="section-toc.1-1.4.2.1.2.2.1"><a href="#section-4.1.2" class="auto internal xref">4.1.2</a>.  <a href="#name-fixed-size-queries" class="internal xref">Fixed-size Queries</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-task-configuration" class="internal xref">Task Configuration</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-uploading-reports" class="internal xref">Uploading Reports</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.1">
                    <p id="section-toc.1-1.4.2.3.2.1.1"><a href="#section-4.3.1" class="auto internal xref">4.3.1</a>.  <a href="#name-hpke-configuration-request" class="internal xref">HPKE Configuration Request</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.2">
                    <p id="section-toc.1-1.4.2.3.2.2.1"><a href="#section-4.3.2" class="auto internal xref">4.3.2</a>.  <a href="#name-upload-request" class="internal xref">Upload Request</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.3">
                    <p id="section-toc.1-1.4.2.3.2.3.1"><a href="#section-4.3.3" class="auto internal xref">4.3.3</a>.  <a href="#name-upload-extensions" class="internal xref">Upload Extensions</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3.2.4">
                    <p id="section-toc.1-1.4.2.3.2.4.1"><a href="#section-4.3.4" class="auto internal xref">4.3.4</a>.  <a href="#name-upload-message-security" class="internal xref">Upload Message Security</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-verifying-and-aggregating-r" class="internal xref">Verifying and Aggregating Reports</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4.2.1">
                    <p id="section-toc.1-1.4.2.4.2.1.1"><a href="#section-4.4.1" class="auto internal xref">4.4.1</a>.  <a href="#name-aggregate-initialization" class="internal xref">Aggregate Initialization</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4.2.2">
                    <p id="section-toc.1-1.4.2.4.2.2.1"><a href="#section-4.4.2" class="auto internal xref">4.4.2</a>.  <a href="#name-aggregate-continuation" class="internal xref">Aggregate Continuation</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4.2.3">
                    <p id="section-toc.1-1.4.2.4.2.3.1"><a href="#section-4.4.3" class="auto internal xref">4.4.3</a>.  <a href="#name-aggregate-message-security" class="internal xref">Aggregate Message Security</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="auto internal xref">4.5</a>.  <a href="#name-collecting-results" class="internal xref">Collecting Results</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.1">
                    <p id="section-toc.1-1.4.2.5.2.1.1"><a href="#section-4.5.1" class="auto internal xref">4.5.1</a>.  <a href="#name-collection-job-initializati" class="internal xref">Collection Job Initialization</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.2">
                    <p id="section-toc.1-1.4.2.5.2.2.1"><a href="#section-4.5.2" class="auto internal xref">4.5.2</a>.  <a href="#name-obtaining-aggregate-shares" class="internal xref">Obtaining Aggregate Shares</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.3">
                    <p id="section-toc.1-1.4.2.5.2.3.1"><a href="#section-4.5.3" class="auto internal xref">4.5.3</a>.  <a href="#name-collection-job-finalization" class="internal xref">Collection Job Finalization</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.4">
                    <p id="section-toc.1-1.4.2.5.2.4.1"><a href="#section-4.5.4" class="auto internal xref">4.5.4</a>.  <a href="#name-aggregate-share-encryption" class="internal xref">Aggregate Share Encryption</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.5">
                    <p id="section-toc.1-1.4.2.5.2.5.1"><a href="#section-4.5.5" class="auto internal xref">4.5.5</a>.  <a href="#name-collect-message-security" class="internal xref">Collect Message Security</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.6">
                    <p id="section-toc.1-1.4.2.5.2.6.1"><a href="#section-4.5.6" class="auto internal xref">4.5.6</a>.  <a href="#name-batch-validation" class="internal xref">Batch Validation</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-operational-considerations" class="internal xref">Operational Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-protocol-participant-capabi" class="internal xref">Protocol participant capabilities</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.1">
                    <p id="section-toc.1-1.5.2.1.2.1.1"><a href="#section-5.1.1" class="auto internal xref">5.1.1</a>.  <a href="#name-client-capabilities" class="internal xref">Client capabilities</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.2">
                    <p id="section-toc.1-1.5.2.1.2.2.1"><a href="#section-5.1.2" class="auto internal xref">5.1.2</a>.  <a href="#name-aggregator-capabilities" class="internal xref">Aggregator capabilities</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.3">
                    <p id="section-toc.1-1.5.2.1.2.3.1"><a href="#section-5.1.3" class="auto internal xref">5.1.3</a>.  <a href="#name-collector-capabilities" class="internal xref">Collector capabilities</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-data-resolution-limitations" class="internal xref">Data resolution limitations</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-aggregation-utility-and-sof" class="internal xref">Aggregation utility and soft batch deadlines</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="auto internal xref">5.4</a>.  <a href="#name-protocol-specific-optimizat" class="internal xref">Protocol-specific optimizations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4.2.1">
                    <p id="section-toc.1-1.5.2.4.2.1.1"><a href="#section-5.4.1" class="auto internal xref">5.4.1</a>.  <a href="#name-reducing-storage-requiremen" class="internal xref">Reducing storage requirements</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-compliance-requirements" class="internal xref">Compliance Requirements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-threat-model" class="internal xref">Threat model</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.1">
                    <p id="section-toc.1-1.7.2.1.2.1.1"><a href="#section-7.1.1" class="auto internal xref">7.1.1</a>.  <a href="#name-client-user" class="internal xref">Client/user</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.2">
                    <p id="section-toc.1-1.7.2.1.2.2.1"><a href="#section-7.1.2" class="auto internal xref">7.1.2</a>.  <a href="#name-aggregator" class="internal xref">Aggregator</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.3">
                    <p id="section-toc.1-1.7.2.1.2.3.1"><a href="#section-7.1.3" class="auto internal xref">7.1.3</a>.  <a href="#name-leader" class="internal xref">Leader</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.4">
                    <p id="section-toc.1-1.7.2.1.2.4.1"><a href="#section-7.1.4" class="auto internal xref">7.1.4</a>.  <a href="#name-collector" class="internal xref">Collector</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.5">
                    <p id="section-toc.1-1.7.2.1.2.5.1"><a href="#section-7.1.5" class="auto internal xref">7.1.5</a>.  <a href="#name-aggregator-collusion" class="internal xref">Aggregator collusion</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.6">
                    <p id="section-toc.1-1.7.2.1.2.6.1"><a href="#section-7.1.6" class="auto internal xref">7.1.6</a>.  <a href="#name-attacker-on-the-network" class="internal xref">Attacker on the network</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-client-authentication-or-at" class="internal xref">Client authentication or attestation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="auto internal xref">7.3</a>.  <a href="#name-anonymizing-proxies" class="internal xref">Anonymizing proxies</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.4">
                <p id="section-toc.1-1.7.2.4.1"><a href="#section-7.4" class="auto internal xref">7.4</a>.  <a href="#name-batch-parameters" class="internal xref">Batch parameters</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.5">
                <p id="section-toc.1-1.7.2.5.1"><a href="#section-7.5" class="auto internal xref">7.5</a>.  <a href="#name-differential-privacy" class="internal xref">Differential privacy</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.6">
                <p id="section-toc.1-1.7.2.6.1"><a href="#section-7.6" class="auto internal xref">7.6</a>.  <a href="#name-robustness-in-the-presence-" class="internal xref">Robustness in the presence of malicious servers</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.7">
                <p id="section-toc.1-1.7.2.7.1"><a href="#section-7.7" class="auto internal xref">7.7</a>.  <a href="#name-verification-key-requiremen" class="internal xref">Verification key requirements</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.8">
                <p id="section-toc.1-1.7.2.8.1"><a href="#section-7.8" class="auto internal xref">7.8</a>.  <a href="#name-infrastructure-diversity" class="internal xref">Infrastructure diversity</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.9">
                <p id="section-toc.1-1.7.2.9.1"><a href="#section-7.9" class="auto internal xref">7.9</a>.  <a href="#name-system-requirements" class="internal xref">System requirements</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.9.2.1">
                    <p id="section-toc.1-1.7.2.9.2.1.1"><a href="#section-7.9.1" class="auto internal xref">7.9.1</a>.  <a href="#name-data-types" class="internal xref">Data types</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-protocol-message-media-type" class="internal xref">Protocol Message Media Types</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.1">
                    <p id="section-toc.1-1.8.2.1.2.1.1"><a href="#section-8.1.1" class="auto internal xref">8.1.1</a>.  <a href="#name-application-dap-hpke-config" class="internal xref">"application/dap-hpke-config-list" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.2">
                    <p id="section-toc.1-1.8.2.1.2.2.1"><a href="#section-8.1.2" class="auto internal xref">8.1.2</a>.  <a href="#name-application-dap-report-medi" class="internal xref">"application/dap-report" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.3">
                    <p id="section-toc.1-1.8.2.1.2.3.1"><a href="#section-8.1.3" class="auto internal xref">8.1.3</a>.  <a href="#name-application-dap-aggregation" class="internal xref">"application/dap-aggregation-job-init-req" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.4">
                    <p id="section-toc.1-1.8.2.1.2.4.1"><a href="#section-8.1.4" class="auto internal xref">8.1.4</a>.  <a href="#name-application-dap-aggregation-" class="internal xref">"application/dap-aggregation-job-resp" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.5">
                    <p id="section-toc.1-1.8.2.1.2.5.1"><a href="#section-8.1.5" class="auto internal xref">8.1.5</a>.  <a href="#name-application-dap-aggregation-j" class="internal xref">"application/dap-aggregation-job-continue-req" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.6">
                    <p id="section-toc.1-1.8.2.1.2.6.1"><a href="#section-8.1.6" class="auto internal xref">8.1.6</a>.  <a href="#name-application-dap-aggregate-s" class="internal xref">"application/dap-aggregate-share-req" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.7">
                    <p id="section-toc.1-1.8.2.1.2.7.1"><a href="#section-8.1.7" class="auto internal xref">8.1.7</a>.  <a href="#name-application-dap-aggregate-sh" class="internal xref">"application/dap-aggregate-share" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.8">
                    <p id="section-toc.1-1.8.2.1.2.8.1"><a href="#section-8.1.8" class="auto internal xref">8.1.8</a>.  <a href="#name-application-dap-collect-req" class="internal xref">"application/dap-collect-req" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.9">
                    <p id="section-toc.1-1.8.2.1.2.9.1"><a href="#section-8.1.9" class="auto internal xref">8.1.9</a>.  <a href="#name-application-dap-collection-" class="internal xref">"application/dap-collection" media type</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.  <a href="#name-query-types-registry" class="internal xref">Query Types Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="auto internal xref">8.3</a>.  <a href="#name-upload-extension-registry" class="internal xref">Upload Extension Registry</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.4">
                <p id="section-toc.1-1.8.2.4.1"><a href="#section-8.4" class="auto internal xref">8.4</a>.  <a href="#name-urn-sub-namespace-for-dap-u" class="internal xref">URN Sub-namespace for DAP (urn:ietf:params:ppm:dap)</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="auto internal xref">10.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="auto internal xref">10.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">This document describes the Distributed Aggregation Protocol (DAP) for privacy
preserving measurement. The protocol is executed by a large set of clients and a
small set of servers. The servers' goal is to compute some aggregate statistic
over the clients' inputs without learning the inputs themselves. This is made
possible by distributing the computation among the servers in such a way that,
as long as at least one of them executes the protocol honestly, no input is ever
seen in the clear by any server.<a href="#section-1-1" class="pilcrow">¶</a></p>
<div id="change-log">
<section id="section-1.1">
        <h3 id="name-change-log">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-change-log" class="section-name selfRef">Change Log</a>
        </h3>
<p id="section-1.1-1">(*) Indicates a change that breaks wire compatibility with the previous draft.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">04:<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-3.1">Introduce resource oriented HTTP API. (#278, #398, #400) (*)<a href="#section-1.1-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-3.2">Clarify security requirements for choosing VDAF verify key. (#407, #411)<a href="#section-1.1-3.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-3.3">Require clients to provide nonce and random input when sharding inputs. (#394,
#425) (*)<a href="#section-1.1-3.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-3.4">Add interval of time spanned by constituent reports to Collection message.
(#397, #403) (*)<a href="#section-1.1-3.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-3.5">Update share validation requirements based on latest security analysis. (#408,
#410)<a href="#section-1.1-3.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-3.6">Bump draft-irtf-cfrg-vdaf-03 to 05 <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>. (#429) (*)<a href="#section-1.1-3.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-3.7">Bump version tag from "dap-03" to "dap-04". (#424) (*)<a href="#section-1.1-3.7" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-1.1-4">03:<a href="#section-1.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-5.1">Enrich the "fixed_size" query type to allow the Collector to request a
recently aggregated batch without knowing the batch ID in advance. ID
discovery was previously done out-of-band. (*)<a href="#section-1.1-5.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-5.2">Allow Aggregators to advertise multiple HPKE configurations. (*)<a href="#section-1.1-5.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-5.3">Clarify requirements for enforcing anti-replay. Namely, while it is sufficient
to detect repeated report IDs, it is also enough to detect repeated IDs and
timestamps.<a href="#section-1.1-5.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-5.4">Remove the extensions from the Report and add extensions to the plaintext
payload of each ReportShare. (*)<a href="#section-1.1-5.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-5.5">Clarify that extensions are mandatory to implement: If an Aggregator does not
recognize a ReportShare's extension, it must reject it.<a href="#section-1.1-5.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-5.6">Clarify that Aggregators must reject any ReportShare with repeated extension
types.<a href="#section-1.1-5.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-5.7">Specify explicitly how to serialize the Additional Authenticated Data (AAD)
string for HPKE encryption. This clarifies an ambiguity in the previous
version. (*)<a href="#section-1.1-5.7" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-5.8">Change the length tag for the aggregation parameter to 32 bits. (*)<a href="#section-1.1-5.8" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-5.9">Use the same prefix ("application") for all media types. (*)<a href="#section-1.1-5.9" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-5.10">Make input share validation more explicit, including adding a new
ReportShareError variant, "report_too_early", for handling reports too far in
the future. (*)<a href="#section-1.1-5.10" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-5.11">Improve alignment of problem details usage with <span>[<a href="#RFC7807" class="cite xref">RFC7807</a>]</span>. Replace
"reportTooLate" problem document type with "repjortRejected" and clarify
handling of rejected reports in the upload sub-protocol. (*)<a href="#section-1.1-5.11" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-5.12">Bump version tag from "dap-02" to "dap-03". (*)<a href="#section-1.1-5.12" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-1.1-6">02:<a href="#section-1.1-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-7.1">Define a new task configuration parameter, called the "query type", that
allows tasks to partition reports into batches in different ways. In the
current draft, the Collector specifies a "query", which the Aggregators use to
guide selection of the batch. Two query types are defined: the "time_interval"
type captures the semantics of draft 01; and the "fixed_size" type allows the
Leader to partition the reports arbitrarily, subject to the constraint that
each batch is roughly the same size. (*)<a href="#section-1.1-7.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-7.2">Define a new task configuration parameter, called the task "expiration", that
defines the lifetime of a given task.<a href="#section-1.1-7.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-7.3">Specify requirements for HTTP request authentication rather than a concrete
scheme. (Draft 01 required the use of the <code>DAP-Auth-Token</code> header; this is now
optional.)<a href="#section-1.1-7.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-7.4">Make "task_id" an optional parameter of the "/hpke_config" endpoint.<a href="#section-1.1-7.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-7.5">Add report count to CollectResp message. (*)<a href="#section-1.1-7.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-7.6">Increase message payload sizes to accommodate VDAFs with input and aggregate
shares larger than 2^16-1 bytes. (*)<a href="#section-1.1-7.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-7.7">Bump draft-irtf-cfrg-vdaf-01 to 03 <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>. (*)<a href="#section-1.1-7.7" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-7.8">Bump version tag from "dap-01" to "dap-02". (*)<a href="#section-1.1-7.8" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-7.9">Rename the report nonce to the "report ID" and move it to the top of the
structure. (*)<a href="#section-1.1-7.9" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-7.10">Clarify when it is safe for an Aggregator to evict various data artifacts from
long-term storage.<a href="#section-1.1-7.10" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="conventions-and-definitions">
<section id="section-1.2">
        <h3 id="name-conventions-and-definitions">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and Definitions</a>
        </h3>
<p id="section-1.2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-1.2-2">
          <dt id="section-1.2-2.1">Aggregate result:</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-2.2">
            <p id="section-1.2-2.2.1">The output of the aggregation function over a given set of measurements and
aggregation parameter. As defined in <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>.<a href="#section-1.2-2.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-2.3">Aggregate share:</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-2.4">
            <p id="section-1.2-2.4.1">A share of the aggregate result emitted by an Aggregator. Aggregate shares are
reassembled by the Collector into the aggregate result, which is the final
output of the aggregation function. As defined in <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>.<a href="#section-1.2-2.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-2.5">Aggregation function:</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-2.6">
            <p id="section-1.2-2.6.1">The function computed over the Clients' measurements. As defined in <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>.<a href="#section-1.2-2.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-2.7">Aggregation parameter:</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-2.8">
            <p id="section-1.2-2.8.1">Parameter used to prepare a set of measurements for aggregation (e.g., the
candidate prefixes for Poplar1 from <span><a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-05#section-8" class="relref">Section 8</a> of [<a href="#VDAF" class="cite xref">VDAF</a>]</span>). As defined in
<span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>.<a href="#section-1.2-2.8.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-2.9">Aggregator:</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-2.10">
            <p id="section-1.2-2.10.1">An endpoint that receives input shares from Clients and validates and
aggregates them with the help of the other Aggregators.<a href="#section-1.2-2.10.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-2.11">Batch:</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-2.12">
            <p id="section-1.2-2.12.1">A set of reports that are aggregated into an aggregate result.<a href="#section-1.2-2.12.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-2.13">Batch duration:</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-2.14">
            <p id="section-1.2-2.14.1">The time difference between the oldest and newest report in a batch.<a href="#section-1.2-2.14.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-2.15">Batch interval:</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-2.16">
            <p id="section-1.2-2.16.1">A parameter of a query issued by the Collector that specifies the time range
of the reports in the batch.<a href="#section-1.2-2.16.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-2.17">Client:</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-2.18">
            <p id="section-1.2-2.18.1">A party that uploads a report.<a href="#section-1.2-2.18.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-2.19">Collector:</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-2.20">
            <p id="section-1.2-2.20.1">The endpoint that selects the aggregation parameter and receives the
aggregate result.<a href="#section-1.2-2.20.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-2.21">Helper:</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-2.22">
            <p id="section-1.2-2.22.1">An Aggregator that executes the aggregation and collection sub-protocols as
instructed by the leader.<a href="#section-1.2-2.22.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-2.23">Input share:</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-2.24">
            <p id="section-1.2-2.24.1">An Aggregator's share of a measurement. The input shares are output by the
VDAF sharding algorithm. As defined in <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>.<a href="#section-1.2-2.24.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-2.25">Output share:</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-2.26">
            <p id="section-1.2-2.26.1">An aggregator's share of the prepared measurement resulting from successful
execution of the VDAF preparation phase. Many output shares are combined into
an aggregate share during the VDAF aggregation phase. As defined in
<span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>.<a href="#section-1.2-2.26.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-2.27">Leader:</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-2.28">
            <p id="section-1.2-2.28.1">A distinguished Aggregator that coordinates aggregation and collection
amongst the Aggregators.<a href="#section-1.2-2.28.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-2.29">Measurement:</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-2.30">
            <p id="section-1.2-2.30.1">A plaintext input emitted by a Client (e.g., a count, summand, or string),
before any encryption or secret sharing is applied. Depending on the VDAF in
use, multiple values may be grouped into a single measurement. As defined in
<span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>.<a href="#section-1.2-2.30.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-2.31">Minimum batch size:</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-2.32">
            <p id="section-1.2-2.32.1">The minimum number of reports in a batch.<a href="#section-1.2-2.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-2.33">Public share:</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-2.34">
            <p id="section-1.2-2.34.1">The output of the VDAF sharding algorithm broadcast to each of the
Aggregators. As defined in <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>.<a href="#section-1.2-2.34.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-2.35">Report:</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-2.36">
            <p id="section-1.2-2.36.1">A cryptographically protected measurement uploaded to the Leader by a Client.
Comprised of a set of report shares.<a href="#section-1.2-2.36.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.2-2.37">Report Share:</dt>
          <dd style="margin-left: 1.5em" id="section-1.2-2.38">
            <p id="section-1.2-2.38.1">An encrypted input share comprising a piece of a report.<a href="#section-1.2-2.38.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-1.2-3">This document uses the presentation language of <span>[<a href="#RFC8446" class="cite xref">RFC8446</a>]</span> to define messages
in the DAP protocol. Encoding and decoding of these messages as byte strings
also follows <span>[<a href="#RFC8446" class="cite xref">RFC8446</a>]</span>.<a href="#section-1.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="overview">
<section id="section-2">
      <h2 id="name-overview">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-overview" class="section-name selfRef">Overview</a>
      </h2>
<p id="section-2-1">The protocol is executed by a large set of Clients and a small set of servers.
Servers are referred to as "Aggregators". Each Client's input to the protocol is
its measurement (or set of measurements, e.g., counts of some user behavior).
Given the input set of measurements <code>x_1, ..., x_n</code> held by <code>n</code> users, the goal
of DAP is to compute <code>y = F(p, x_1, ..., x_n)</code> for some function <code>F</code> while
revealing nothing else about the measurements. We call <code>F</code> the "aggregation
function".<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">This protocol is extensible and allows for the addition of new cryptographic
schemes that implement the VDAF interface specified in
<span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>. Candidates include:<a href="#section-2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-3.1">Prio3 (<span><a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-05#section-7" class="relref">Section 7</a> of [<a href="#VDAF" class="cite xref">VDAF</a>]</span>), which allows for aggregate statistics such as
sum, mean, histograms, etc.<a href="#section-2-3.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-3.2">Poplar1 (<span><a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-05#section-8" class="relref">Section 8</a> of [<a href="#VDAF" class="cite xref">VDAF</a>]</span>), which allows for finding the most popular
strings uploaded by a set of Clients (e.g., the URL of their home page) as
well as counting the number of Clients that hold a given string. This VDAF is
the basis of the Poplar protocol of <span>[<a href="#BBCGGI21" class="cite xref">BBCGGI21</a>]</span>, which is designed to solve
the heavy hitters problem in a privacy preserving manner.<a href="#section-2-3.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-2-4">VDAFs rely on secret sharing to protect the privacy of the measurements. Rather
than sending its input in the clear, each client shards its measurements into a
sequence of "input shares" and sends an input share to each of the Aggregators.
This provides two important properties:<a href="#section-2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-5.1">Given only a subset of the input shares, it is impossible to deduce the
plaintext measurement from which they were generated.<a href="#section-2-5.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-5.2">It allows the Aggregators to compute the aggregation function by first
aggregating up their input shares locally into "aggregate shares", then
combining the aggregate shares into the aggregate result.<a href="#section-2-5.2" class="pilcrow">¶</a>
</li>
      </ul>
<div id="system-architecture">
<section id="section-2.1">
        <h3 id="name-system-architecture">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-system-architecture" class="section-name selfRef">System Architecture</a>
        </h3>
<p id="section-2.1-1">The overall system architecture is shown in <a href="#dap-topology" class="auto internal xref">Figure 1</a>.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<span id="name-system-architecture-2"></span><div id="dap-topology">
<figure id="figure-1">
          <div class="alignLeft art-text artwork" id="section-2.1-2.1">
<pre>
                    +------------+
                    |            |
+--------+          |   Helper   |
|        |          |            |
| Client +----+     +-----^------+
|        |    |           |
+--------+    |           |
              |           |
+--------+    |     +-----v------+         +-----------+
|        |    +-----&gt;            |         |           |
| Client +----------&gt;   Leader   &lt;---------&gt; Collector |
|        |    +-----&gt;            |         |           |
+--------+    |     +-----^------+         +-----------+
              |           |
+--------+    |           |
|        |    |           |
| Client +----+     +-----V------+
|        |          |            |
+--------+          |   Helper   |
                    |            |
                    +------------+
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-system-architecture-2" class="selfRef">System Architecture</a>
          </figcaption></figure>
</div>
<p id="section-2.1-3">[[OPEN ISSUE: This shows two helpers, but the document only allows one for now.
https://github.com/ietf-wg-ppm/draft-ietf-ppm-dap/issues/117]]<a href="#section-2.1-3" class="pilcrow">¶</a></p>
<p id="section-2.1-4">The main participants in the protocol are as follows:<a href="#section-2.1-4" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2.1-5">
          <dt id="section-2.1-5.1">Collector:</dt>
          <dd style="margin-left: 1.5em" id="section-2.1-5.2">
            <p id="section-2.1-5.2.1">The entity which wants to obtain the aggregate of the measurements generated
by the Clients. Any given measurement task will have a single Collector.<a href="#section-2.1-5.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.1-5.3">Client(s):</dt>
          <dd style="margin-left: 1.5em" id="section-2.1-5.4">
            <p id="section-2.1-5.4.1">The endpoints which directly take the measurement(s) and report them to the
DAP protocol. In order to provide reasonable levels of privacy, there must be
a large number of clients.<a href="#section-2.1-5.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.1-5.5">Aggregator:</dt>
          <dd style="margin-left: 1.5em" id="section-2.1-5.6">
            <p id="section-2.1-5.6.1">An endpoint which receives report shares. Each Aggregator works with the other
Aggregators to compute the aggregate result. This protocol defines two types of
Aggregators: Leaders and Helpers. For each measurement task, there is a single
Leader and Helper.<a href="#section-2.1-5.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.1-5.7">Leader:</dt>
          <dd style="margin-left: 1.5em" id="section-2.1-5.8">
            <p id="section-2.1-5.8.1">The Aggregator responsible for coordinating the protocol. It receives the
reports, splits them into report shares, and distributes the report shares to
the Helpers, and orchestrates the process of computing the aggregate result as
requested by the Collector.<a href="#section-2.1-5.8.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.1-5.9">Helper:</dt>
          <dd style="margin-left: 1.5em" id="section-2.1-5.10">
            <p id="section-2.1-5.10.1">Helpers are responsible for executing the protocol as instructed by the
Leader. The protocol is designed so that Helpers can be relatively
lightweight, with most of the state held at the Leader.<a href="#section-2.1-5.10.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-2.1-6">The basic unit of DAP is the "task" which represents a single measurement
process (though potentially taken over multiple time windows). The definition of
a task includes the following parameters:<a href="#section-2.1-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.1-7.1">The type of each measurement.<a href="#section-2.1-7.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.1-7.2">The aggregation function to compute (e.g., sum, mean, etc.).<a href="#section-2.1-7.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.1-7.3">The set of Aggregators and necessary cryptographic keying material to use.<a href="#section-2.1-7.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.1-7.4">The VDAF to execute, which to some extent is dictated by the previous choices.<a href="#section-2.1-7.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.1-7.5">The minimum "batch size" of reports which can be aggregated.<a href="#section-2.1-7.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.1-7.6">The rate at which measurements can be taken, i.e., the "minimum batch
duration".<a href="#section-2.1-7.6" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-2.1-8">These parameters are distributed out of band to the Clients and to the
Aggregators. They are distributed by the Collector in some authenticated form.
Each task is identified by a unique 32-byte ID which is used to refer to it in
protocol messages.<a href="#section-2.1-8" class="pilcrow">¶</a></p>
<p id="section-2.1-9">During the duration of the task, each Client records its own measurement
value(s), packages them up into a report, and sends them to the leader. Each
share is separately encrypted for each Aggregator so that even though they pass
through the Leader, the Leader is unable to see or modify them. Depending on the
task, the Client may only send one report or may send many reports over time.<a href="#section-2.1-9" class="pilcrow">¶</a></p>
<p id="section-2.1-10">The Leader distributes the shares to the Helpers and orchestrates the process of
verifying them (see <a href="#validating-inputs" class="auto internal xref">Section 2.2</a>) and assembling them into a final
aggregate result for the Collector. Depending on the VDAF, it may be possible to
incrementally process each report as it comes in, or may be necessary to wait
until the entire batch of reports is received.<a href="#section-2.1-10" class="pilcrow">¶</a></p>
</section>
</div>
<div id="validating-inputs">
<section id="section-2.2">
        <h3 id="name-validating-inputs">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-validating-inputs" class="section-name selfRef">Validating Inputs</a>
        </h3>
<p id="section-2.2-1">An essential task of any data collection pipeline is ensuring that the data
being aggregated is "valid". In DAP, input validation is complicated by the fact
that none of the entities other than the Client ever sees that client's
plaintext measurement.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2">In order to address this problem, the aggregators engage in a secure,
multi-party computation specified by the chosen VDAF <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span> in order to
prepare a report for aggregation. At the beginning of this computation, each
Aggregator is in possession of an input share uploaded by the client. At the end
of the computation, each Aggregator is in possession of either an "output share"
that is ready to be aggregated or an indication that a valid output share could
not be computed.<a href="#section-2.2-2" class="pilcrow">¶</a></p>
<p id="section-2.2-3">To facilitate this computation, the input shares generated by the client include
information used by the aggregators during aggregation in order to validate
their corresponding output shares. For example, Prio3 includes a distributed
zero-knowledge proof of the input's validity <span>[<a href="#BBCGGI19" class="cite xref">BBCGGI19</a>]</span> which the Aggregators
can jointly verify and reject the report if it cannot be verified. However, they
do not learn anything about the individual report other than that it is valid.<a href="#section-2.2-3" class="pilcrow">¶</a></p>
<p id="section-2.2-4">The specific properties attested to in the proof vary depending on the
measurement being taken. For instance, to measure the time the user took
performing a given task the proof might demonstrate that the value reported was
within a certain range (e.g., 0-60 seconds). By contrast, to report which of a
set of <code>N</code> options the user select, the report might contain <code>N</code> integers and
the proof would demonstrate that <code>N-1</code> were <code>0</code> and the other was <code>1</code>.<a href="#section-2.2-4" class="pilcrow">¶</a></p>
<p id="section-2.2-5">It is important to recognize that "validity" is distinct from "correctness". For
instance, the user might have spent 30s on a task but the client might report
60s. This is a problem with any measurement system and DAP does not attempt to
address it; it merely ensures that the data is within acceptable limits, so the
client could not report 10^6s or -20s.<a href="#section-2.2-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="message-transport">
<section id="section-3">
      <h2 id="name-message-transport">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-message-transport" class="section-name selfRef">Message Transport</a>
      </h2>
<p id="section-3-1">Communications between DAP participants are carried over HTTPS <span>[<a href="#RFC9110" class="cite xref">RFC9110</a>]</span>.
HTTPS provides server authentication and confidentiality. Use of HTTPS is
<span class="bcp14">REQUIRED</span>.<a href="#section-3-1" class="pilcrow">¶</a></p>
<div id="request-authentication">
<section id="section-3.1">
        <h3 id="name-https-request-authenticatio">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-https-request-authenticatio" class="section-name selfRef">HTTPS Request Authentication</a>
        </h3>
<p id="section-3.1-1">DAP is made up of several sub-protocols in which different subsets of the
protocol's participants interact with each other.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">In those cases where a channel between two participants is tunneled through
another protocol participant, DAP mandates the use of public-key encryption
using <span>[<a href="#HPKE" class="cite xref">HPKE</a>]</span> to ensure that only the intended recipient can see a
message in the clear.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1-3">In other cases, DAP requires HTTPS client authentication. Any authentication
scheme that is composable with HTTP is allowed. For example:<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-4.1">
            <span>[<a href="#OAuth2" class="cite xref">OAuth2</a>]</span> credentials are presented in an Authorization HTTP header,
which can be added to any DAP protocol message.<a href="#section-3.1-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-4.2">TLS client certificates can be used to authenticate the underlying transport.<a href="#section-3.1-4.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.1-5">This flexibility allows organizations deploying DAP to use existing well-known
HTTP authentication mechanisms that they already support. Discovering what
authentication mechanisms are supported by a DAP participant is outside of this
document's scope.<a href="#section-3.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="errors">
<section id="section-3.2">
        <h3 id="name-errors">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-errors" class="section-name selfRef">Errors</a>
        </h3>
<p id="section-3.2-1">Errors can be reported in DAP both at the HTTP layer and within challenge
objects as defined in <a href="#iana-considerations" class="auto internal xref">Section 8</a>. DAP servers can return responses
with an HTTP error response code (4XX or 5XX). For example, if the client
submits a request using a method not allowed in this document, then the server
<span class="bcp14">MAY</span> return HTTP status code 405 Method Not Allowed.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">When the server responds with an error status, it <span class="bcp14">SHOULD</span> provide additional
information using a problem document <span>[<a href="#RFC7807" class="cite xref">RFC7807</a>]</span>. To facilitate automatic
response to errors, this document defines the following standard tokens for use
in the "type" field (within the DAP URN namespace
"urn:ietf:params:ppm:dap:error:"):<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<table class="center" id="table-1">
          <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Type</th>
              <th class="text-left" rowspan="1" colspan="1">Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">unrecognizedMessage</td>
              <td class="text-left" rowspan="1" colspan="1">The message type for a response was incorrect or the payload was malformed.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">unrecognizedTask</td>
              <td class="text-left" rowspan="1" colspan="1">An endpoint received a message with an unknown task ID.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">unrecognizedAggregationJob</td>
              <td class="text-left" rowspan="1" colspan="1">An endpoint received a message with an unknown aggregation job ID.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">outdatedConfig</td>
              <td class="text-left" rowspan="1" colspan="1">The message was generated using an outdated configuration.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">reportRejected</td>
              <td class="text-left" rowspan="1" colspan="1">Report could not be processed for an unspecified reason.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">reportTooEarly</td>
              <td class="text-left" rowspan="1" colspan="1">Report could not be processed because its timestamp is too far in the future.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">batchInvalid</td>
              <td class="text-left" rowspan="1" colspan="1">The batch boundary check for collector's query failed.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">invalidBatchSize</td>
              <td class="text-left" rowspan="1" colspan="1">There are an invalid number of reports in the batch.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">batchQueriedTooManyTimes</td>
              <td class="text-left" rowspan="1" colspan="1">The maximum number of batch queries has been exceeded for one or more reports included in the batch.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">batchMismatch</td>
              <td class="text-left" rowspan="1" colspan="1">Aggregators disagree on the report shares that were aggregated in a batch.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">unauthorizedRequest</td>
              <td class="text-left" rowspan="1" colspan="1">Authentication of an HTTP request failed (see <a href="#request-authentication" class="auto internal xref">Section 3.1</a>).</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">missingTaskID</td>
              <td class="text-left" rowspan="1" colspan="1">HPKE configuration was requested without specifying a task ID.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">queryMismatch</td>
              <td class="text-left" rowspan="1" colspan="1">Query type indicated by a message does not match the task's query type.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">roundMismatch</td>
              <td class="text-left" rowspan="1" colspan="1">The aggregators disagree on the current round of the VDAF preparation protocol.</td>
            </tr>
          </tbody>
        </table>
<p id="section-3.2-4">This list is not exhaustive. The server <span class="bcp14">MAY</span> return errors set to a URI other
than those defined above. Servers <span class="bcp14">MUST NOT</span> use the DAP URN namespace for errors
not listed in the appropriate IANA registry (see <a href="#urn-space" class="auto internal xref">Section 8.4</a>). The "detail"
member of the Problem Details document includes additional diagnostic
information.<a href="#section-3.2-4" class="pilcrow">¶</a></p>
<p id="section-3.2-5">When the task ID is known (see <a href="#task-configuration" class="auto internal xref">Section 4.2</a>), the problem document
<span class="bcp14">SHOULD</span> include an additional "taskid" member containing the ID encoded in Base
64 using the URL and filename safe alphabet with no padding defined in
Sections <a href="https://rfc-editor.org/rfc/rfc4648#section-5" class="relref">5</a> and <a href="https://rfc-editor.org/rfc/rfc4648#section-3.2" class="relref">3.2</a> of <span>[<a href="#RFC4648" class="cite xref">RFC4648</a>]</span>.<a href="#section-3.2-5" class="pilcrow">¶</a></p>
<p id="section-3.2-6">In the remainder of this document, the tokens in the table above are used to
refer to error types, rather than the full URNs. For example, an "error of type
'unrecognizedMessage'" refers to an error document with "type" value
"urn:ietf:params:ppm:dap:error:unrecognizedMessage".<a href="#section-3.2-6" class="pilcrow">¶</a></p>
<p id="section-3.2-7">This document uses the verbs "abort" and "alert with [some error message]" to
describe how protocol participants react to various error conditions. This
implies HTTP status code 400 Bad Request unless explicitly specified otherwise.<a href="#section-3.2-7" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="protocol-definition">
<section id="section-4">
      <h2 id="name-protocol-definition">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-protocol-definition" class="section-name selfRef">Protocol Definition</a>
      </h2>
<p id="section-4-1">DAP has three major interactions which need to be defined:<a href="#section-4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-2.1">Uploading reports from the Client to the Aggregators, specified in
<a href="#upload-flow" class="auto internal xref">Section 4.3</a><a href="#section-4-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-2.2">Computing the results for a given measurement task, specified in
<a href="#aggregate-flow" class="auto internal xref">Section 4.4</a><a href="#section-4-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-2.3">Collecting aggregated results, specified in <a href="#collect-flow" class="auto internal xref">Section 4.5</a><a href="#section-4-2.3" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-4-3">Each of these interactions is defined in terms of "resources". In this section
we define these resources and the messages used to act on them.<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4">A resource's path is resolved relative to a server's endpoint to construct a
resource URI. Resource paths are specified as templates like:<a href="#section-4-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4-5">
<pre>
{role}/resource_type/{resource-id}
</pre><a href="#section-4-5" class="pilcrow">¶</a>
</div>
<p id="section-4-6"><code>{role}</code> is one of the API endpoints in the task's <code>aggregator_endpoints</code> (see
<a href="#task-configuration" class="auto internal xref">Section 4.2</a>). The remainder of the path is resolved relative to the
endpoint.<a href="#section-4-6" class="pilcrow">¶</a></p>
<p id="section-4-7">DAP resource identifiers are opaque byte strings, so any occurrence of
<code>{resource-id}</code> in a URL template (e.g., <code>{task-id}</code> or <code>{report-id}</code>) <span class="bcp14">MUST</span> be
expanded to the URL-safe, unpadded Base 64 representation of the corresponding
resource identifier, as specified in Sections <a href="https://rfc-editor.org/rfc/rfc4648#section-5" class="relref">5</a> and <a href="https://rfc-editor.org/rfc/rfc4648#section-3.2" class="relref">3.2</a> of <span>[<a href="#RFC4648" class="cite xref">RFC4648</a>]</span>.<a href="#section-4-7" class="pilcrow">¶</a></p>
<p id="section-4-8">The following are some basic type definitions used in other messages:<a href="#section-4-8" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4-9">
<pre>
/* ASCII encoded URL. e.g., "https://example.com" */
opaque Url&lt;1..2^16-1&gt;;

uint64 Duration; /* Number of seconds elapsed between two instants */

uint64 Time; /* seconds elapsed since start of UNIX epoch */

/* An interval of time of length duration, where start is included and (start +
duration) is excluded. */
struct {
  Time start;
  Duration duration;
} Interval;

/* An ID used to uniquely identify a report in the context of a DAP task. */
opaque ReportID[16];

/* The various roles in the DAP protocol. */
enum {
  collector(0),
  client(1),
  leader(2),
  helper(3),
  (255)
} Role;

/* Identifier for a server's HPKE configuration */
uint8 HpkeConfigId;

/* An HPKE ciphertext. */
struct {
  HpkeConfigId config_id;    /* config ID */
  opaque enc&lt;1..2^16-1&gt;;     /* encapsulated HPKE key */
  opaque payload&lt;1..2^32-1&gt;; /* ciphertext */
} HpkeCiphertext;

/* Represent a zero-length byte string. */
struct {} Empty;
</pre><a href="#section-4-9" class="pilcrow">¶</a>
</div>
<p id="section-4-10">DAP uses the 16-byte <code>ReportID</code> as the nonce parameter for the VDAF
<code>measurement_to_input_shares</code> and <code>prep_init</code> methods (see <span>[<a href="#VDAF" class="cite xref">VDAF</a>], <a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-05#section-5" class="relref">Section 5</a></span>). Thus for a VDAF to be compatible with DAP, it <span class="bcp14">MUST</span> specify a <code>NONCE_SIZE</code>
of 16 bytes.<a href="#section-4-10" class="pilcrow">¶</a></p>
<div id="query">
<section id="section-4.1">
        <h3 id="name-queries">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-queries" class="section-name selfRef">Queries</a>
        </h3>
<p id="section-4.1-1">Aggregated results are computed based on sets of reports, called "batches". The
Collector influences which reports are used in a batch via a "query." The
Aggregators use this query to carry out the aggregation flow and produce
aggregate shares encrypted to the Collector.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">This document defines the following query types:<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.1-3">
<pre>
enum {
  reserved(0), /* Reserved for testing purposes */
  time_interval(1),
  fixed_size(2),
  (255)
} QueryType;
</pre><a href="#section-4.1-3" class="pilcrow">¶</a>
</div>
<p id="section-4.1-4">The time_interval query type is described in <a href="#time-interval-query" class="auto internal xref">Section 4.1.1</a>; the
fixed_size query type is described in <a href="#fixed-size-query" class="auto internal xref">Section 4.1.2</a>. Future
specifications may introduce new query types as needed (see <a href="#query-type-reg" class="auto internal xref">Section 8.2</a>).
A query includes parameters used by the Aggregators to select a batch of reports
specific to the given query type. A query is defined as follows:<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.1-5">
<pre>
opaque BatchID[32];

enum {
  by_batch_id(0),
  current_batch(1),
} FixedSizeQueryType;

struct {
  FixedSizeQueryType query_type;
  select (query_type) {
    by_batch_id: BatchID batch_id;
    current_batch: Empty;
  }
} FixedSizeQuery;

struct {
  QueryType query_type;
  select (Query.query_type) {
    case time_interval: Interval batch_interval;
    case fixed_size: FixedSizeQuery fixed_size_query;
  }
} Query;
</pre><a href="#section-4.1-5" class="pilcrow">¶</a>
</div>
<p id="section-4.1-6">The parameters pertaining to each query type are described in one of the
subsections below. The query is issued in-band as part of the collect
sub-protocol (<a href="#collect-flow" class="auto internal xref">Section 4.5</a>). Its content is determined by the "query type",
which in turn is encoded by the "query configuration" configured out-of-band.
All query types have the following configuration parameters in common:<a href="#section-4.1-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-7.1">
            <code>min_batch_size</code> - The smallest number of reports the batch is allowed to
include. In a sense, this parameter controls the degree of privacy that will
be obtained: The larger the minimum batch size, the higher degree of privacy.
However, this ultimately depends on the application and the nature of the
measurements and aggregation function.<a href="#section-4.1-7.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-7.2">
            <code>time_precision</code> - Clients use this value to truncate their report timestamps;
see <a href="#upload-flow" class="auto internal xref">Section 4.3</a>. Additional semantics may apply, depending on the query
type. (See <a href="#batch-validation" class="auto internal xref">Section 4.5.6</a> for details.)<a href="#section-4.1-7.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.1-8">The parameters pertaining to specific query types are described in the relevant
subsection below.<a href="#section-4.1-8" class="pilcrow">¶</a></p>
<div id="time-interval-query">
<section id="section-4.1.1">
          <h4 id="name-time-interval-queries">
<a href="#section-4.1.1" class="section-number selfRef">4.1.1. </a><a href="#name-time-interval-queries" class="section-name selfRef">Time-interval Queries</a>
          </h4>
<p id="section-4.1.1-1">The first query type, <code>time_interval</code>, is designed to support applications in
which reports are collected over a long period of time. The Collector specifies
a "batch interval" that determines the time range for reports included in the
batch. For each report in the batch, the time at which that report was generated
(see <a href="#upload-flow" class="auto internal xref">Section 4.3</a>) <span class="bcp14">MUST</span> fall within the batch interval specified by the
Collector.<a href="#section-4.1.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1.1-2">Typically the Collector issues queries for which the batch intervals are
continuous, monotonically increasing, and have the same duration. For example,
the sequence of batch intervals <code>(1659544000, 1000)</code>, <code>(1659545000, 1000)</code>,
<code>(1659545000, 1000)</code>, <code>(1659546000, 1000)</code> satisfies these conditions. (The
first element of the pair denotes the start of the batch interval and the second
denotes the duration.) Of course, there are cases in which Collector may need to
issue queries out-of-order. For example, a previous batch might need to be
queried again with a different aggregation parameter (e.g, for Poplar1). In
addition, the Collector may need to vary the duration to adjust to changing
report upload rates.<a href="#section-4.1.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="fixed-size-query">
<section id="section-4.1.2">
          <h4 id="name-fixed-size-queries">
<a href="#section-4.1.2" class="section-number selfRef">4.1.2. </a><a href="#name-fixed-size-queries" class="section-name selfRef">Fixed-size Queries</a>
          </h4>
<p id="section-4.1.2-1">The <code>fixed_size</code> query type is used to support applications in which the
Collector needs the ability to strictly control the sample size. This is
particularly important for controlling the amount of noise added to reports by
Clients (or added to aggregate shares by Aggregators) in order to achieve
differential privacy.<a href="#section-4.1.2-1" class="pilcrow">¶</a></p>
<p id="section-4.1.2-2">For this query type, the Aggregators group reports into arbitrary batches such
that each batch has roughly the same number of reports. These batches are
identified by opaque "batch IDs", allocated in an arbitrary fashion by the
Leader.<a href="#section-4.1.2-2" class="pilcrow">¶</a></p>
<p id="section-4.1.2-3">To get the aggregate of a batch, the Collector issues a query specifying the
batch ID of interest (see <a href="#query" class="auto internal xref">Section 4.1</a>). The Collector may not know which batch ID
it is interested in; in this case, it can also issue a query of type
<code>current_batch</code>, which allows the Leader to select a recent batch to aggregate.
The leader <span class="bcp14">SHOULD</span> select a batch which has not yet began collection.<a href="#section-4.1.2-3" class="pilcrow">¶</a></p>
<p id="section-4.1.2-4">In addition to the minimum batch size common to all query types, the
configuration includes a parameter <code>max_batch_size</code> that determines maximum
number of reports per batch.<a href="#section-4.1.2-4" class="pilcrow">¶</a></p>
<p id="section-4.1.2-5">Implementation note: The goal for the Aggregators is to aggregate precisely
<code>min_batch_size</code> reports per batch. Doing so, however, may be challenging for
Leader deployments in which multiple, independent nodes running the aggregate
sub-protocol (see <a href="#aggregate-flow" class="auto internal xref">Section 4.4</a>) need to be coordinated. The maximum batch
size is intended to allow room for error. Typically the difference between the
minimum and maximum batch size will be a small fraction of the target batch size
for each batch.<a href="#section-4.1.2-5" class="pilcrow">¶</a></p>
<p id="section-4.1.2-6">[OPEN ISSUE: It may be feasible to require a fixed batch size, i.e.,
<code>min_batch_size == max_batch_size</code>. We should know better once we've had some
implementation/deployment experience.]<a href="#section-4.1.2-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="task-configuration">
<section id="section-4.2">
        <h3 id="name-task-configuration">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-task-configuration" class="section-name selfRef">Task Configuration</a>
        </h3>
<p id="section-4.2-1">Prior to the start of execution of the protocol, each participant must agree on
the configuration for each task. A task is uniquely identified by its task ID:<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.2-2">
<pre>
opaque TaskID[32];
</pre><a href="#section-4.2-2" class="pilcrow">¶</a>
</div>
<p id="section-4.2-3">A <code>TaskID</code> is a globally unique sequence of bytes. It is <span class="bcp14">RECOMMENDED</span> that this
be set to a random string output by a cryptographically secure pseudorandom
number generator. Each task has the following parameters associated with it:<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-4.1">
            <code>aggregator_endpoints</code>: A list of URLs relative to which each Aggregator's API
endpoints can be found. Each endpoint's list <span class="bcp14">MUST</span> be in the same order. The
Leader's endpoint <span class="bcp14">MUST</span> be the first in the list; subsequent items contain
Helper endpoints. The order of the <code>encrypted_input_shares</code> in a <code>Report</code>
(see <a href="#upload-flow" class="auto internal xref">Section 4.3</a>) <span class="bcp14">MUST</span> be the same as the order in which aggregators
appear in this list.<a href="#section-4.2-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-4.2">The query configuration for this task (see <a href="#query" class="auto internal xref">Section 4.1</a>). This determines the
query type for batch selection and the properties that all batches for this
task must have.<a href="#section-4.2-4.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-4.3">
            <code>max_batch_query_count</code>: The maximum number of times a batch of reports may be
queried by the Collector.<a href="#section-4.2-4.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-4.4">
            <code>task_expiration</code>: The time up to which clients are expected to upload to this
task. The task is considered completed after this time. Aggregators <span class="bcp14">MAY</span> reject
reports that have timestamps later than <code>task_expiration</code>.<a href="#section-4.2-4.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-4.5">A unique identifier for the VDAF in use for the task, e.g., one of the VDAFs
defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-05#section-10" class="relref">Section 10</a> of [<a href="#VDAF" class="cite xref">VDAF</a>]</span>.<a href="#section-4.2-4.5" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.2-5">In addition, in order to facilitate the aggregation and collect protocols, each
of the Aggregators is configured with following parameters:<a href="#section-4.2-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-6.1">
            <code>collector_config</code>: The <span>[<a href="#HPKE" class="cite xref">HPKE</a>]</span> configuration of the Collector
(described in <a href="#hpke-config" class="auto internal xref">Section 4.3.1</a>); see <a href="#compliance" class="auto internal xref">Section 6</a> for information about the
HPKE configuration algorithms.<a href="#section-4.2-6.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-6.2">
            <code>vdaf_verify_key</code>: The VDAF verification key shared by the Aggregators. This
key is used in the aggregation sub-protocol (<a href="#aggregate-flow" class="auto internal xref">Section 4.4</a>). The security
requirements are described in <a href="#verification-key" class="auto internal xref">Section 7.7</a>.<a href="#section-4.2-6.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.2-7">Finally, the Collector is configured with the HPKE secret key corresponding to
<code>collector_hpke_config</code>.<a href="#section-4.2-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="upload-flow">
<section id="section-4.3">
        <h3 id="name-uploading-reports">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-uploading-reports" class="section-name selfRef">Uploading Reports</a>
        </h3>
<p id="section-4.3-1">Clients periodically upload reports to the Leader, which then distributes the
individual report shares to each Helper.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<div id="hpke-config">
<section id="section-4.3.1">
          <h4 id="name-hpke-configuration-request">
<a href="#section-4.3.1" class="section-number selfRef">4.3.1. </a><a href="#name-hpke-configuration-request" class="section-name selfRef">HPKE Configuration Request</a>
          </h4>
<p id="section-4.3.1-1">Before the Client can upload its report to the Leader, it must know the HPKE
configuration of each Aggregator. See <a href="#compliance" class="auto internal xref">Section 6</a> for information on HPKE
algorithm choices.<a href="#section-4.3.1-1" class="pilcrow">¶</a></p>
<p id="section-4.3.1-2">Clients retrieve the HPKE configuration from each aggregator by sending an HTTP
GET request to <code>{aggregator}/hpke_config</code>. Clients <span class="bcp14">MAY</span> specify a query parameter
<code>task_id</code> whose value is the task ID whose HPKE configuration they want. If the
Aggregator does not recognize the task ID, then it <span class="bcp14">MUST</span> abort with error
<code>unrecognizedTask</code>.<a href="#section-4.3.1-2" class="pilcrow">¶</a></p>
<p id="section-4.3.1-3">An Aggregator is free to use different HPKE configurations for each task with
which it is configured. If the task ID is missing from  the Client's request,
the Aggregator <span class="bcp14">MAY</span> abort with an error of type <code>missingTaskID</code>, in which case
the Client <span class="bcp14">SHOULD</span> retry the request with a well-formed task ID included.<a href="#section-4.3.1-3" class="pilcrow">¶</a></p>
<p id="section-4.3.1-4">An Aggregator responds to well-formed requests with HTTP status code 200 OK and
an <code>HpkeConfigList</code> value. The <code>HpkeConfigList</code> structure contains one or more
<code>HpkeConfig</code> structures in decreasing order of preference. This allows an
Aggregator to support multiple HPKE configurations simultaneously.<a href="#section-4.3.1-4" class="pilcrow">¶</a></p>
<p id="section-4.3.1-5">[TODO: Allow aggregators to return HTTP status code 403 Forbidden in deployments
that use authentication to avoid leaking information about which tasks exist.]<a href="#section-4.3.1-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.1-6">
<pre>
HpkeConfig HpkeConfigList&lt;1..2^16-1&gt;;

struct {
  HpkeConfigId id;
  HpkeKemId kem_id;
  HpkeKdfId kdf_id;
  HpkeAeadId aead_id;
  HpkePublicKey public_key;
} HpkeConfig;

opaque HpkePublicKey&lt;1..2^16-1&gt;;
uint16 HpkeAeadId; /* Defined in [HPKE] */
uint16 HpkeKemId;  /* Defined in [HPKE] */
uint16 HpkeKdfId;  /* Defined in [HPKE] */
</pre><a href="#section-4.3.1-6" class="pilcrow">¶</a>
</div>
<p id="section-4.3.1-7">[OPEN ISSUE: Decide whether to expand the width of the id.]<a href="#section-4.3.1-7" class="pilcrow">¶</a></p>
<p id="section-4.3.1-8">Aggregators <span class="bcp14">SHOULD</span> allocate distinct id values for each <code>HpkeConfig</code> in a
<code>HpkeConfigList</code>. The <span class="bcp14">RECOMMENDED</span> strategy for generating these values is via
rejection sampling, i.e., to randomly select an id value repeatedly until it
does not match any known <code>HpkeConfig</code>.<a href="#section-4.3.1-8" class="pilcrow">¶</a></p>
<p id="section-4.3.1-9">The Client <span class="bcp14">MUST</span> abort if any of the following happen for any HPKE config
request:<a href="#section-4.3.1-9" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3.1-10.1">the GET request failed or did not return a valid HPKE config list;<a href="#section-4.3.1-10.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.3.1-10.2">the HPKE config list is empty; or<a href="#section-4.3.1-10.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.3.1-10.3">no HPKE config advertised by the aggregator specifies a supported a KEM, KDF,
or AEAD algorithm triple.<a href="#section-4.3.1-10.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.3.1-11">Aggregators <span class="bcp14">SHOULD</span> use HTTP caching to permit client-side caching of this
resource <span>[<a href="#RFC5861" class="cite xref">RFC5861</a>]</span>. Aggregators <span class="bcp14">SHOULD</span> favor long cache lifetimes to avoid
frequent cache revalidation, e.g., on the order of days. Aggregators can control
this cached lifetime with the Cache-Control header, as follows:<a href="#section-4.3.1-11" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.1-12">
<pre>
  Cache-Control: max-age=86400
</pre><a href="#section-4.3.1-12" class="pilcrow">¶</a>
</div>
<p id="section-4.3.1-13">Clients <span class="bcp14">SHOULD</span> follow the usual HTTP caching <span>[<a href="#RFC9111" class="cite xref">RFC9111</a>]</span> semantics for HPKE
configurations.<a href="#section-4.3.1-13" class="pilcrow">¶</a></p>
<p id="section-4.3.1-14">Note: Long cache lifetimes may result in clients using stale HPKE
configurations; Aggregators <span class="bcp14">SHOULD</span> continue to accept reports with old keys for
at least twice the cache lifetime in order to avoid rejecting reports.<a href="#section-4.3.1-14" class="pilcrow">¶</a></p>
</section>
</div>
<div id="upload-request">
<section id="section-4.3.2">
          <h4 id="name-upload-request">
<a href="#section-4.3.2" class="section-number selfRef">4.3.2. </a><a href="#name-upload-request" class="section-name selfRef">Upload Request</a>
          </h4>
<p id="section-4.3.2-1">Clients upload reports by using an HTTP PUT to
<code>{leader}/tasks/{task-id}/reports</code>, where <code>{leader}</code> is the first entry in the
task's Aggregator endpoints.<a href="#section-4.3.2-1" class="pilcrow">¶</a></p>
<p id="section-4.3.2-2">The payload is structured as follows:<a href="#section-4.3.2-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.2-3">
<pre>
struct {
  ReportID report_id;
  Time time;
} ReportMetadata;

struct {
  ReportMetadata report_metadata;
  opaque public_share&lt;0..2^32-1&gt;;
  HpkeCiphertext encrypted_input_shares&lt;1..2^32-1&gt;;
} Report;
</pre><a href="#section-4.3.2-3" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="section-4.3.2-4.1">
              <p id="section-4.3.2-4.1.1"><code>report_metadata</code> is public metadata describing the report.<a href="#section-4.3.2-4.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3.2-4.1.2.1">
                  <code>report_id</code> is used by the Aggregators to ensure the report appears in at
most one batch (see <a href="#input-share-validation" class="auto internal xref">Section 4.4.1.4</a>). The Client <span class="bcp14">MUST</span> generate
this by generating 16 random bytes using a cryptographically secure random
number generator.<a href="#section-4.3.2-4.1.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4.3.2-4.1.2.2">
                  <code>time</code> is the time at which the report was generated. The Client <span class="bcp14">SHOULD</span>
round this value down to the nearest multiple of the task's
<code>time_precision</code> in order to ensure that that the timestamp cannot be used
to link a report back to the Client that generated it.<a href="#section-4.3.2-4.1.2.2" class="pilcrow">¶</a>
</li>
              </ul>
</li>
            <li class="normal" id="section-4.3.2-4.2">
              <code>public_share</code> is the public share output by the VDAF sharding algorithm. Note
that the public share might be empty, depending on the VDAF.<a href="#section-4.3.2-4.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.3.2-4.3">
              <code>encrypted_input_shares</code> is the sequence of input shares encrypted to each of
the Aggregators.<a href="#section-4.3.2-4.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.3.2-5">To generate a report, the Client begins by sharding its measurement into input
shares and the public share using the VDAF's sharding algorithm (<span><a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-05#section-5.1" class="relref">Section 5.1</a> of [<a href="#VDAF" class="cite xref">VDAF</a>]</span>), using the report ID as the nonce:<a href="#section-4.3.2-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.2-6">
<pre>
(public_share, input_shares) = VDAF.measurement_to_input_shares(
    measurement, /* plaintext measurement */
    report_id,   /* nonce */
    rand,        /* randomness for sharding algorithm */
)
</pre><a href="#section-4.3.2-6" class="pilcrow">¶</a>
</div>
<p id="section-4.3.2-7">The last input comprises the randomness consumed by the sharding algorithm. The
sharding randomness is a random byte string of length specified by the VDAF. The
Client <span class="bcp14">MUST</span> generate this using a cryptographically secure random number
generator.<a href="#section-4.3.2-7" class="pilcrow">¶</a></p>
<p id="section-4.3.2-8">The Client then wraps each input share in the following structure:<a href="#section-4.3.2-8" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.2-9">
<pre>
struct {
  Extension extensions&lt;0..2^16-1&gt;;
  opaque payload&lt;0..2^32-1&gt;;
} PlaintextInputShare;
</pre><a href="#section-4.3.2-9" class="pilcrow">¶</a>
</div>
<p id="section-4.3.2-10">Field <code>extensions</code> is set to the list of extensions intended to be consumed by
the given Aggregator. (See <a href="#upload-extensions" class="auto internal xref">Section 4.3.3</a>.) Field <code>payload</code> is set to the
Aggregator's input share output by the VDAF sharding algorithm.<a href="#section-4.3.2-10" class="pilcrow">¶</a></p>
<p id="section-4.3.2-11">Next, the Client encrypts each PlaintextInputShare <code>plaintext_input_share</code> as
follows:<a href="#section-4.3.2-11" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.2-12">
<pre>
enc, payload = SealBase(pk,
  "dap-04 input share" || 0x01 || server_role,
  input_share_aad, plaintext_input_share)
</pre><a href="#section-4.3.2-12" class="pilcrow">¶</a>
</div>
<p id="section-4.3.2-13">where <code>pk</code> is the Aggregator's public key; <code>server_role</code> is the Role of the
intended recipient (<code>0x02</code> for the Leader and <code>0x03</code> for the Helper),
<code>plaintext_input_share</code> is the Aggregator's PlaintextInputShare, and
<code>input_share_aad</code> is an encoded message of type InputShareAad defined below,
constructed from the same values as the corresponding fields in the report. The
<code>SealBase()</code> function is as specified in <span>[<a href="#HPKE" class="cite xref">HPKE</a>], <a href="https://rfc-editor.org/rfc/rfc9180#section-6.1" class="relref">Section 6.1</a></span> for the
ciphersuite indicated by the HPKE configuration.<a href="#section-4.3.2-13" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.2-14">
<pre>
struct {
  TaskID task_id;
  ReportMetadata report_metadata;
  opaque public_share&lt;0..2^32-1&gt;;
} InputShareAad;
</pre><a href="#section-4.3.2-14" class="pilcrow">¶</a>
</div>
<p id="section-4.3.2-15">The order of the encrypted input shares appear <span class="bcp14">MUST</span> match the order of the
task's <code>aggregator_endpoints</code>. That is, the first share should be the Leader's,
the second share should be for the first Helper, and so on.<a href="#section-4.3.2-15" class="pilcrow">¶</a></p>
<p id="section-4.3.2-16">The Leader responds to well-formed requests with HTTP status code 201
Created. Malformed requests are handled as described in <a href="#errors" class="auto internal xref">Section 3.2</a>.
Clients <span class="bcp14">SHOULD NOT</span> upload the same measurement value in more than one report if
the Leader responds with HTTP status code 201 Created.<a href="#section-4.3.2-16" class="pilcrow">¶</a></p>
<p id="section-4.3.2-17">If the leader does not recognize the task ID, then it <span class="bcp14">MUST</span> abort with error
<code>unrecognizedTask</code>.<a href="#section-4.3.2-17" class="pilcrow">¶</a></p>
<p id="section-4.3.2-18">The Leader responds to requests whose leader encrypted input share uses an
out-of-date or unknown <code>HpkeConfig.id</code> value, indicated by
<code>HpkeCiphertext.config_id</code>, with error of type 'outdatedConfig'. If the leader
supports multiple HPKE configurations, it can use trial decryption with each
configuration to determine if requests match a known HPKE configuration. When
the Client receives an 'outdatedConfig' error, it <span class="bcp14">SHOULD</span> invalidate any cached
HpkeConfigList and retry with a freshly generated Report. If this retried upload
does not succeed, the Client <span class="bcp14">SHOULD</span> abort and discontinue retrying.<a href="#section-4.3.2-18" class="pilcrow">¶</a></p>
<p id="section-4.3.2-19">If a report's ID matches that of a previously uploaded report, the Leader <span class="bcp14">MUST</span>
ignore it. In addition, it <span class="bcp14">MAY</span> alert the client with error <code>reportRejected</code>. See
the implementation note in <a href="#input-share-validation" class="auto internal xref">Section 4.4.1.4</a>.<a href="#section-4.3.2-19" class="pilcrow">¶</a></p>
<p id="section-4.3.2-20">The Leader <span class="bcp14">MUST</span> ignore any report pertaining to a batch that has already been
collected (see <a href="#input-share-validation" class="auto internal xref">Section 4.4.1.4</a> for details). Otherwise, comparing the
aggregate result to the previous aggregate result may result in a privacy
violation. Note that this is enforced by all Aggregators, not just the Leader.
The Leader <span class="bcp14">MAY</span> also abort the upload protocol and alert the client with error
<code>reportRejected</code>.<a href="#section-4.3.2-20" class="pilcrow">¶</a></p>
<p id="section-4.3.2-21">The Leader <span class="bcp14">MAY</span> ignore any report whose timestamp is past the task's
<code>task_expiration</code>. When it does so, it <span class="bcp14">SHOULD</span> also abort the upload protocol and
alert the Client with error <code>reportRejected</code>. Client <span class="bcp14">MAY</span> choose to opt out of
the task if its own clock has passed <code>task_expiration</code>.<a href="#section-4.3.2-21" class="pilcrow">¶</a></p>
<p id="section-4.3.2-22">The Leader may need to buffer reports while waiting to aggregate them (e.g.,
while waiting for an aggregation parameter from the Collector; see
<a href="#collect-flow" class="auto internal xref">Section 4.5</a>). The Leader <span class="bcp14">SHOULD NOT</span> accept reports whose timestamps are too
far in the future. Implementors <span class="bcp14">MAY</span> provide for some small leeway, usually no
more than a few minutes, to account for clock skew. If the Leader rejects a
report for this reason, it <span class="bcp14">SHOULD</span> abort the upload protocol and alert the Client
with error <code>reportTooEarly</code>. In this situation, the Client <span class="bcp14">MAY</span> re-upload the
report later on.<a href="#section-4.3.2-22" class="pilcrow">¶</a></p>
<p id="section-4.3.2-23">If the Leader's ReportShare contains an unrecognized extension, or if two
extensions have the same ExtensionType, then the Leader <span class="bcp14">MAY</span> abort the upload
request with error "unrecognizedMessage". Note that this behavior is not
mandatory because it requires the Leader to decrypt its ReportShare.<a href="#section-4.3.2-23" class="pilcrow">¶</a></p>
</section>
</div>
<div id="upload-extensions">
<section id="section-4.3.3">
          <h4 id="name-upload-extensions">
<a href="#section-4.3.3" class="section-number selfRef">4.3.3. </a><a href="#name-upload-extensions" class="section-name selfRef">Upload Extensions</a>
          </h4>
<p id="section-4.3.3-1">Each PlaintextInputShare carries a list of extensions that Clients use to convey
additional information to the Aggregator. Some extensions might be intended for
all Aggregators; others may only be intended for a specific Aggregator. (For
example, a DAP deployment might use some out-of-band mechanism for an Aggregator
to verify that Reports come from authenticated Clients. It will likely be useful
to bind the extension to the input share via HPKE encryption.)<a href="#section-4.3.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3.3-2">Each extension is a tag-length encoded value of the following form:<a href="#section-4.3.3-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3.3-3">
<pre>
struct {
  ExtensionType extension_type;
  opaque extension_data&lt;0..2^16-1&gt;;
} Extension;

enum {
  TBD(0),
  (65535)
} ExtensionType;
</pre><a href="#section-4.3.3-3" class="pilcrow">¶</a>
</div>
<p id="section-4.3.3-4">Field "extension_type" indicates the type of extension, and "extension_data"
contains information specific to the extension.<a href="#section-4.3.3-4" class="pilcrow">¶</a></p>
<p id="section-4.3.3-5">Extensions are mandatory-to-implement: If an Aggregator receives a Report
containing an extension it does not recognize, then it <span class="bcp14">MUST</span> reject the Report.
(See <a href="#input-share-validation" class="auto internal xref">Section 4.4.1.4</a> for details.)<a href="#section-4.3.3-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="upload-message-security">
<section id="section-4.3.4">
          <h4 id="name-upload-message-security">
<a href="#section-4.3.4" class="section-number selfRef">4.3.4. </a><a href="#name-upload-message-security" class="section-name selfRef">Upload Message Security</a>
          </h4>
<p id="section-4.3.4-1">The contents of each input share must be kept confidential from everyone but the
Client and the Aggregator it is being sent to. In addition, Clients must be able
to authenticate the Aggregator they upload to.<a href="#section-4.3.4-1" class="pilcrow">¶</a></p>
<p id="section-4.3.4-2">HTTPS provides confidentiality between the DAP client and the leader, but this
is not sufficient since the helper's report shares are relayed through the
leader. Confidentiality of report shares is achieved by encrypting each report
share to a public key held by the respective aggregator using <span>[<a href="#HPKE" class="cite xref">HPKE</a>]</span>. Clients
fetch the public keys from each aggregator over HTTPS, allowing them to
authenticate the server.<a href="#section-4.3.4-2" class="pilcrow">¶</a></p>
<p id="section-4.3.4-3">Aggregators <span class="bcp14">MAY</span> require clients to authenticate when uploading reports. This is
an effective mitigation against Sybil <span>[<a href="#Dou02" class="cite xref">Dou02</a>]</span> attacks in deployments where it
is practical for each Client to have an identity provisioned (e.g., a user
logged into an online service or a hardware device programmed with an identity).
If it is used, Client authentication <span class="bcp14">MUST</span> use a scheme that meets the
requirements in <a href="#request-authentication" class="auto internal xref">Section 3.1</a>.<a href="#section-4.3.4-3" class="pilcrow">¶</a></p>
<p id="section-4.3.4-4">In some deployments, it will not be practical to require Clients to authenticate
(e.g., a widely distributed application that does not require its users to login
to any service), so Client authentication is not mandatory in DAP.<a href="#section-4.3.4-4" class="pilcrow">¶</a></p>
<p id="section-4.3.4-5">[[OPEN ISSUE: deployments that don't have client auth will need to do something
about Sybil attacks. Is there any useful guidance or <span class="bcp14">SHOULD</span> we can provide? Sort
of relevant: issue #89]]<a href="#section-4.3.4-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="aggregate-flow">
<section id="section-4.4">
        <h3 id="name-verifying-and-aggregating-r">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-verifying-and-aggregating-r" class="section-name selfRef">Verifying and Aggregating Reports</a>
        </h3>
<p id="section-4.4-1">Once a set of Clients have uploaded their reports to the Leader, the Leader can
begin the process of validating and aggregating them with the Helper. To enable
the system to handle large batches of reports, this process can be parallelized
across many "aggregation jobs" in which small subsets of the reports are
processed independently. Each aggregation job is associated with exactly one
DAP task, but a task can have many aggregation jobs.<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<p id="section-4.4-2">The primary objective of an aggregation job is to run the VDAF preparation
process described in <span>[<a href="#VDAF" class="cite xref">VDAF</a>], <a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-05#section-5.2" class="relref">Section 5.2</a></span> for each report in the job.
Preparation has two purposes:<a href="#section-4.4-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.4-3">
<li id="section-4.4-3.1">To "refine" the input shares into "output shares" that have the desired
aggregatable form. For some VDAFs, like Prio3, the mapping from input to
output shares is some fixed, linear operation, but in general the mapping is
controlled dynamically by the Collector and can be highly non-linear. In
Poplar1, for example, the refinement process involves a sequence of
"candidate prefixes" and the output consists of a sequence of zeros and
ones, each indicating whether the corresponding candidate is a prefix of the
measurement from which the input shares were generated.<a href="#section-4.4-3.1" class="pilcrow">¶</a>
</li>
          <li id="section-4.4-3.2">To verify that the output shares, when combined, correspond to a valid,
refined measurement, where validity is determined by the VDAF itself. For
example, the Prio3Sum variant of Prio3 (<span><a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-05#section-7.4.2" class="relref">Section 7.4.2</a> of [<a href="#VDAF" class="cite xref">VDAF</a>]</span>) requires
that the output shares sum up to an integer in a specific range; for
Poplar1, the output shares are required to sum up to a vector that is
non-zero in at most one position.<a href="#section-4.4-3.2" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-4.4-4">In general, refinement and verification are not distinct computations, since
for some VDAFs, verification may only be achieved implicitly as a result of the
refinement process. We instead think of these as properties of the output
shares themselves: if preparation succeeds, then the resulting output
shares are guaranteed to combine into a valid, refined measurement.<a href="#section-4.4-4" class="pilcrow">¶</a></p>
<p id="section-4.4-5">As shown in Figure 6 of <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>, the preparation process is organized into a
sequence of rounds (at least one). At the start of each round, each Aggregator
produces a value called a preparation message-share; we refer to this value as
a "prep share" for short. The prep shares are combined into the preparation
message, or "prep message", which is used as input for the next round. The
value output in the final round is the Aggregator's output share.<a href="#section-4.4-5" class="pilcrow">¶</a></p>
<p id="section-4.4-6">VDAF preparation is mapped onto an aggregation job as illustrated in
<a href="#agg-flow" class="auto internal xref">Figure 2</a>. The protocol is comprised of a sequence of HTTP requests from the
Leader to the Helper, the first of which includes the aggregation parameter,
the Helper's report shares, and the Leader's round-1 prep share corresponding
to each report in the aggregation job. The remaining requests and responses
carry prep messages and prep shares for each report.<a href="#section-4.4-6" class="pilcrow">¶</a></p>
<span id="name-mapping-of-vdaf-preparation"></span><div id="agg-flow">
<figure id="figure-2">
          <div class="alignLeft art-text artwork" id="section-4.4-7.1">
<pre>
    report, agg_param
     |
     v
  +--------+                                         +--------+
  | Leader |                                         | Helper |
  +--------+                                         +--------+
     | AggregationJobInitReq                               |
   I | agg_param, helper_report_share, leader_prep_share_1 |
  N1 |----------------------------------------------------&gt;| I
     |                                  AggregationJobResp | N1
     |                   prep_msg_1, [helper_prep_share_2] | P1
     |&lt;----------------------------------------------------| [N2]
  N2 | AggregationJobContinueReq                           |
  P2 | prep_msg_2, [leader_prep_share_3]                   |
[N3] |----------------------------------------------------&gt;| P2
     |                                  AggregationJobResp | [N3]
     |                 [prep_msg_3, {helper_prep_share_4}] | [P3]
  P3 |&lt;----------------------------------------------------| {N4}
  N4 | AggregationJobContinueReq                           |
  P4 | prep_msg_4, [leader_prep_share_5]                   |
[N5] |----------------------------------------------------&gt;| P4
     |                                  AggregationJobResp | [N5]
     |                 [prep_msg_5, {helper_prep_share_6}] | [P5]
     |&lt;----------------------------------------------------| {N6}
     |                                                     |
    ...                                                   ...
Pr-2 |                                                     |
Nr-1 | AggregationJobContinueReq                           |
Pr-1 | prep_msg_r-1, [leader_prep_share_r]                 |
[Nr] |----------------------------------------------------&gt;| Pr-1
     |                                  AggregationJobResp | [Nr]
     |                               [helper_prep_share_r] | [Pr]
   F |&lt;----------------------------------------------------| F
     |                                                     |
     v                                                     v
    leader_out_share                         helper_out_share

      [] - Indicates a field that is only sent if the VDAF
           requires at least one more round.
      {} - Indicates a field that is only sent if the VDAF
           requires at least two more rounds.
       I - Produce first-round prep-share.
       P - Combine prep shares into prep message.
       N - Produce next prep share.
       F - Produce output share.
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-mapping-of-vdaf-preparation" class="selfRef">Mapping of VDAF preparation to the DAP aggregation sub-protocol.</a>
          </figcaption></figure>
</div>
<p id="section-4.4-8">The exact protocol structure depends on the number of rounds of preparation
that are required by the VDAF. (The number of rounds is a constant parameter
specified by the VDAF itself: Prio3 has just one round, but Poplar1 requires
two.) The high-level idea is that the Aggregators take turns running the
computation locally until input from their peer is required:<a href="#section-4.4-8" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4-9.1">For a 1-round VDAF, The Leader sends its prep share to the Helper, who
computes the prep message locally (the computations are specified in the
following sections), commits to its output share, then sends the prep message
to the Leader.<a href="#section-4.4-9.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.4-9.2">For a 2-round VDAF, the Leader sends its first-round prep share to the
Helper, who replies with the first-round prep message and its second-round
prep share. In the next request, the Leader computes its second-round
prep share locally, commits and sends the second-round prep message.<a href="#section-4.4-9.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.4-9.3">In general, each request includes the Leader's prep share for the previous
round and/or the prep message for the current round; correspondingly, each
response consists of the prep message for the current round and the Helper's
prep share for the next round.<a href="#section-4.4-9.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.4-10">The Aggregators proceed in this ping-ponging fashion until a step of the
computation fails, indicating the report is invalid and should be rejected, or
the last round is reached and each Aggregator computes an output share. All
told there there are <code>ceil((ROUNDS+1)/2)</code> HTTP requests sent, where <code>ROUNDS</code> is
the number of rounds specified by the VDAF.<a href="#section-4.4-10" class="pilcrow">¶</a></p>
<p id="section-4.4-11">[OPEN ISSUE: For the moment we don't have an example of a VDAF that requires
more than two rounds. Eventually we may want to specialize the spec to
accommodate 1-2 rounds (or even just 1).]<a href="#section-4.4-11" class="pilcrow">¶</a></p>
<p id="section-4.4-12">In general, reports cannot be aggregated until the Collector specifies an
aggregation parameter. However, in some situations it is possible to begin
aggregation as soon as reports arrive. For example, Prio3 has just one valid
aggregation parameter (the empty string). And there are use cases for Poplar1
in which aggregation can begin immediately (i.e., those for which the candidate
prefixes/strings are fixed in advance).<a href="#section-4.4-12" class="pilcrow">¶</a></p>
<p id="section-4.4-13">The aggregation flow can be thought of as having three phases:<a href="#section-4.4-13" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4-14.1">Initialization: Begin the aggregation flow by disseminating report shares and
initializing the VDAF preparation state for each report.<a href="#section-4.4-14.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.4-14.2">Continuation: Continue the aggregation flow by exchanging prep shares and
messages until preparation completes or an error occurs.<a href="#section-4.4-14.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.4-14.3">Completion: Finish the aggregate flow, yielding an output share corresponding
to each report report share in the batch.<a href="#section-4.4-14.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.4-15">These phases are described in the following subsections.<a href="#section-4.4-15" class="pilcrow">¶</a></p>
<div id="agg-init">
<section id="section-4.4.1">
          <h4 id="name-aggregate-initialization">
<a href="#section-4.4.1" class="section-number selfRef">4.4.1. </a><a href="#name-aggregate-initialization" class="section-name selfRef">Aggregate Initialization</a>
          </h4>
<p id="section-4.4.1-1">The Leader begins an aggregation job by choosing a set of candidate reports that
pertain to the same DAP task and a unique job ID. The job ID is a 16-byte value,
structured as follows:<a href="#section-4.4.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4.1-2">
<pre>
opaque AggregationJobID[16];
</pre><a href="#section-4.4.1-2" class="pilcrow">¶</a>
</div>
<p id="section-4.4.1-3">The leader can run this process for many sets of candidate reports in parallel
as needed. After choosing a set of candidates, the leader begins aggregation by
splitting each report into report shares, one for each Aggregator. The Leader
and Helpers then run the aggregate initialization flow to accomplish two tasks:<a href="#section-4.4.1-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.4.1-4">
<li id="section-4.4.1-4.1">Recover and determine which input report shares are invalid.<a href="#section-4.4.1-4.1" class="pilcrow">¶</a>
</li>
            <li id="section-4.4.1-4.2">For each valid report share, initialize the VDAF preparation process (see
<span><a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-05#section-5.2" class="relref">Section 5.2</a> of [<a href="#VDAF" class="cite xref">VDAF</a>]</span>).<a href="#section-4.4.1-4.2" class="pilcrow">¶</a>
</li>
          </ol>
<p id="section-4.4.1-5">An invalid report share is marked with one of the following errors:<a href="#section-4.4.1-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4.1-6">
<pre>
enum {
  batch_collected(0),
  report_replayed(1),
  report_dropped(2),
  hpke_unknown_config_id(3),
  hpke_decrypt_error(4),
  vdaf_prep_error(5),
  batch_saturated(6),
  task_expired(7),
  unrecognized_message(8),
  report_too_early(9),
  (255)
} ReportShareError;
</pre><a href="#section-4.4.1-6" class="pilcrow">¶</a>
</div>
<p id="section-4.4.1-7">The Leader and Helper initialization behavior is detailed below.<a href="#section-4.4.1-7" class="pilcrow">¶</a></p>
<div id="leader-init">
<section id="section-4.4.1.1">
            <h5 id="name-leader-initialization">
<a href="#section-4.4.1.1" class="section-number selfRef">4.4.1.1. </a><a href="#name-leader-initialization" class="section-name selfRef">Leader Initialization</a>
            </h5>
<p id="section-4.4.1.1-1">The Leader begins the aggregate initialization phase with the set of candidate
report shares as follows:<a href="#section-4.4.1.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.4.1.1-2">
<li id="section-4.4.1.1-2.1">Generate a fresh AggregationJobID. This ID <span class="bcp14">MUST</span> be unique within the context
of the corresponding DAP task. It is <span class="bcp14">RECOMMENDED</span> that this be set to a random
string output by a cryptographically secure pseudorandom number generator.<a href="#section-4.4.1.1-2.1" class="pilcrow">¶</a>
</li>
              <li id="section-4.4.1.1-2.2">Decrypt the input share for each report share as described in
<a href="#input-share-decryption" class="auto internal xref">Section 4.4.1.3</a>.<a href="#section-4.4.1.1-2.2" class="pilcrow">¶</a>
</li>
              <li id="section-4.4.1.1-2.3">Check that the resulting input share is valid as described in
<a href="#input-share-validation" class="auto internal xref">Section 4.4.1.4</a>.<a href="#section-4.4.1.1-2.3" class="pilcrow">¶</a>
</li>
              <li id="section-4.4.1.1-2.4">Initialize VDAF preparation as described in <a href="#input-share-prep" class="auto internal xref">Section 4.4.1.5</a>.<a href="#section-4.4.1.1-2.4" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-4.4.1.1-3">If any step invalidates the report share, the Leader removes the report share
from the set of candidate reports. Once the leader has initialized this state
for all valid candidate report shares, it creates an <code>AggregationJobInitReq</code>
message for each Helper to initialize the preparation of this candidate set. The
<code>AggregationJobInitReq</code> message is structured as follows:<a href="#section-4.4.1.1-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4.1.1-4">
<pre>
struct {
  ReportMetadata report_metadata;
  opaque public_share&lt;0..2^32-1&gt;;
  HpkeCiphertext encrypted_input_share;
} ReportShare;

struct {
  QueryType query_type;
  select (PartialBatchSelector.query_type) {
    case time_interval: Empty;
    case fixed_size: BatchID batch_id;
  };
} PartialBatchSelector;

struct {
  opaque agg_param&lt;0..2^32-1&gt;;
  PartialBatchSelector part_batch_selector;
  ReportShare report_shares&lt;1..2^32-1&gt;;
} AggregationJobInitReq;
</pre><a href="#section-4.4.1.1-4" class="pilcrow">¶</a>
</div>
<p id="section-4.4.1.1-5">[[OPEN ISSUE: Consider sending report shares separately (in parallel) to the
aggregate instructions. Right now, aggregation parameters and the corresponding
report shares are sent at the same time, but this may not be strictly
necessary.]]<a href="#section-4.4.1.1-5" class="pilcrow">¶</a></p>
<p id="section-4.4.1.1-6">This message consists of:<a href="#section-4.4.1.1-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.1.1-7.1">
                <code>agg_param</code>: The opaque, VDAF-specific aggregation parameter provided during
the collection flow (<a href="#collect-flow" class="auto internal xref">Section 4.5</a>),<a href="#section-4.4.1.1-7.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-4.4.1.1-7.2">
                <p id="section-4.4.1.1-7.2.1"><code>part_batch_selector</code>: The "partial batch selector" used by the Aggregators to
determine how to aggregate each report:<a href="#section-4.4.1.1-7.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.1.1-7.2.2.1">
                    <p id="section-4.4.1.1-7.2.2.1.1">For fixed_size tasks, the Leader specifies a "batch ID" that determines
the batch to which each report for this aggregation job belongs.<a href="#section-4.4.1.1-7.2.2.1.1" class="pilcrow">¶</a></p>
<p id="section-4.4.1.1-7.2.2.1.2">
[OPEN ISSUE: For fixed_size tasks, the Leader is in complete control over
which batch a report is included in. For time_interval tasks, the Client
has some control, since the timestamp determines which batch window it
falls in. Is this desirable from a privacy perspective? If not, it might
be simpler to drop the timestamp altogether and have the agg init request
specify the batch window instead.]<a href="#section-4.4.1.1-7.2.2.1.2" class="pilcrow">¶</a></p>
</li>
                </ul>
<p id="section-4.4.1.1-7.2.3">
The indicated query type <span class="bcp14">MUST</span> match the task's query type. Otherwise, the
Helper <span class="bcp14">MUST</span> abort with error "queryMismatch".<a href="#section-4.4.1.1-7.2.3" class="pilcrow">¶</a></p>
<p id="section-4.4.1.1-7.2.4">
This field is called the "partial" batch selector because, depending on the
query type, it may not determine a batch. In particular, if the query type is
<code>time_interval</code>, the batch is not determined until the Collector's query is
issued (see <a href="#query" class="auto internal xref">Section 4.1</a>).<a href="#section-4.4.1.1-7.2.4" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-4.4.1.1-7.3">
                <code>report_shares</code>: The sequence of report shares to aggregate. The
<code>encrypted_input_share</code> field of the report share is the <code>HpkeCiphertext</code>
whose index in <code>Report.encrypted_input_shares</code> is equal to the index of the
aggregator in the task's <code>aggregator_endpoints</code> to which the
<code>AggregationJobInitReq</code> is being sent.<a href="#section-4.4.1.1-7.3" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-4.4.1.1-8">Let <code>{helper}</code> denote the Helper's API endpoint. The Leader sends a PUT
request to <code>{helper}/tasks/{task-id}/aggregation_jobs/{aggregation-job-id}</code>
with its <code>AggregationJobInitReq</code> message as the payload. The media type is
"application/dap-aggregation-job-init-req". The Leader's aggregation job is now
in round 0.<a href="#section-4.4.1.1-8" class="pilcrow">¶</a></p>
<p id="section-4.4.1.1-9">The Helper's response will be an <code>AggregationJobResp</code> message (see
<a href="#aggregation-helper-init" class="auto internal xref">Section 4.4.1.2</a>, which the Leader validates according to the
criteria in <a href="#aggregation-job-validation" class="auto internal xref">Section 4.4.1.6</a>. If the message is valid, the Leader
moves to the aggregation job continuation phase with the enclosed prepare steps,
as described in <a href="#agg-continue-flow" class="auto internal xref">Section 4.4.2</a>. Otherwise, the Leader should abandon the
aggregation job entirely.<a href="#section-4.4.1.1-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="aggregation-helper-init">
<section id="section-4.4.1.2">
            <h5 id="name-helper-initialization">
<a href="#section-4.4.1.2" class="section-number selfRef">4.4.1.2. </a><a href="#name-helper-initialization" class="section-name selfRef">Helper Initialization</a>
            </h5>
<p id="section-4.4.1.2-1">Each Helper begins their portion of the aggregate initialization when they
receive an AggregationJobInitReq message from the Leader. For each ReportShare
conveyed by this message, the Helper attempts to initialize VDAF preparation
(see <span><a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-05#section-5.1" class="relref">Section 5.1</a> of [<a href="#VDAF" class="cite xref">VDAF</a>]</span>) just as the Leader does. If successful, it
includes its prepare message in its response that the Leader will use to
continue the process.<a href="#section-4.4.1.2-1" class="pilcrow">¶</a></p>
<p id="section-4.4.1.2-2">To begin this process, the Helper first checks if it recognizes the task ID. If
not, then it <span class="bcp14">MUST</span> abort with error <code>unrecognizedTask</code>. Then the Helper checks
that the report IDs in <code>AggregationJobInitReq.report_shares</code> are all distinct.
If two ReportShare values have the same report ID, then the helper <span class="bcp14">MUST</span> abort
with error <code>unrecognizedMessage</code>. If this check succeeds, the helper then
attempts to recover each input share in <code>AggregationJobInitReq.report_shares</code> as
follows:<a href="#section-4.4.1.2-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.4.1.2-3">
<li id="section-4.4.1.2-3.1">Decrypt the input share for each report share as described in
<a href="#input-share-decryption" class="auto internal xref">Section 4.4.1.3</a>.<a href="#section-4.4.1.2-3.1" class="pilcrow">¶</a>
</li>
              <li id="section-4.4.1.2-3.2">Check that the resulting input share is valid as described in
<a href="#input-share-validation" class="auto internal xref">Section 4.4.1.4</a>.<a href="#section-4.4.1.2-3.2" class="pilcrow">¶</a>
</li>
              <li id="section-4.4.1.2-3.3">Initialize VDAF preparation and initial outputs as described in
<a href="#input-share-prep" class="auto internal xref">Section 4.4.1.5</a>.<a href="#section-4.4.1.2-3.3" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-4.4.1.2-4">Once the Helper has processed each report share in
<code>AggregationJobInitReq.report_shares</code>, the Helper creates an
<code>AggregationJobResp</code> message to complete its initialization. This message is
structured as follows:<a href="#section-4.4.1.2-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4.1.2-5">
<pre>
enum {
  continued(0),
  finished(1),
  failed(2),
  (255)
} PrepareStepState;

struct {
  ReportID report_id;
  PrepareStepState prepare_step_state;
  select (PrepareStep.prepare_step_state) {
    case continued: opaque prep_msg&lt;0..2^32-1&gt;; /* VDAF preparation message */
    case finished:  Empty;
    case failed:    ReportShareError;
  };
} PrepareStep;

struct {
  PrepareStep prepare_steps&lt;1..2^32-1&gt;;
} AggregationJobResp;
</pre><a href="#section-4.4.1.2-5" class="pilcrow">¶</a>
</div>
<p id="section-4.4.1.2-6">The message is a sequence of PrepareStep values, the order of which matches that
of the ReportShare values in <code>AggregationJobInitReq.report_shares</code>. Each report
that was marked as invalid is assigned the <code>PrepareStepState</code> <code>failed</code>.
Otherwise, the <code>PrepareStep</code> is either marked as continued with the output
<code>prep_msg</code>, or is marked as finished if the VDAF preparation process is finished
for the report share. The Helper's aggregation job is now in round 0.<a href="#section-4.4.1.2-6" class="pilcrow">¶</a></p>
<p id="section-4.4.1.2-7">On success, the Helper responds to the Leader with HTTP status code 201 Created
and a body consisting of the <code>AggregationJobResp</code>, with media type
"application/dap-aggregation-job-resp".<a href="#section-4.4.1.2-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="input-share-decryption">
<section id="section-4.4.1.3">
            <h5 id="name-input-share-decryption">
<a href="#section-4.4.1.3" class="section-number selfRef">4.4.1.3. </a><a href="#name-input-share-decryption" class="section-name selfRef">Input Share Decryption</a>
            </h5>
<p id="section-4.4.1.3-1">Each report share has a corresponding task ID, report metadata (report ID and,
timestamp), the public share sent to each Aggregator, and the recipient's
encrypted input share. Let <code>task_id</code>, <code>report_metadata</code>, <code>public_share</code>, and
<code>encrypted_input_share</code> denote these values, respectively. Given these values,
an aggregator decrypts the input share as follows. First, it constructs an
<code>InputShareAad</code> message from <code>task_id</code>, <code>report_metadata</code>, and <code>public_share</code>.
Let this be denoted by <code>input_share_aad</code>. Then, the aggregator looks up the
HPKE config and corresponding secret key indicated by
<code>encrypted_input_share.config_id</code> and attempts decryption of the payload with
the following procedure:<a href="#section-4.4.1.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4.1.3-2">
<pre>
plaintext_input_share = OpenBase(encrypted_input_share.enc, sk,
  "dap-04 input share" || 0x01 || server_role,
  input_share_aad, encrypted_input_share.payload)
</pre><a href="#section-4.4.1.3-2" class="pilcrow">¶</a>
</div>
<p id="section-4.4.1.3-3">where <code>sk</code> is the HPKE secret key, and <code>server_role</code> is the role of the
aggregator (<code>0x02</code> for the leader and <code>0x03</code> for the helper). The <code>OpenBase()</code>
function is as specified in <span>[<a href="#HPKE" class="cite xref">HPKE</a>], <a href="https://rfc-editor.org/rfc/rfc9180#section-6.1" class="relref">Section 6.1</a></span> for the ciphersuite indicated
by the HPKE configuration. If the leader supports multiple HPKE configurations
with non-distinct configuration identifiers, it can use trial decryption with
each configuration. If decryption fails, the aggregator marks the report share
as invalid with the error <code>hpke_decrypt_error</code>. Otherwise, the aggregator
outputs the resulting PlaintextInputShare <code>plaintext_input_share</code>.<a href="#section-4.4.1.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="input-share-validation">
<section id="section-4.4.1.4">
            <h5 id="name-input-share-validation">
<a href="#section-4.4.1.4" class="section-number selfRef">4.4.1.4. </a><a href="#name-input-share-validation" class="section-name selfRef">Input Share Validation</a>
            </h5>
<p id="section-4.4.1.4-1">Validating an input share will either succeed or fail. In the case of failure,
the input share is marked as invalid with a corresponding ReportShareError
error.<a href="#section-4.4.1.4-1" class="pilcrow">¶</a></p>
<p id="section-4.4.1.4-2">Before beginning the preparation step, Aggregators are required to perform the
following checks:<a href="#section-4.4.1.4-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.4.1.4-3">
<li id="section-4.4.1.4-3.1">Check that the input share can be decoded as specified by the VDAF. If not,
the input share <span class="bcp14">MUST</span> be marked as invalid with the error
<code>unrecognized_message</code>.<a href="#section-4.4.1.4-3.1" class="pilcrow">¶</a>
</li>
              <li id="section-4.4.1.4-3.2">Check if the report is too far into the future. Implementors can provide for
some small leeway, usually no more than a few minutes, to account for clock
skew. If a report is rejected for this reason, the Aggregator <span class="bcp14">SHOULD</span> mark the
input share as invalid with the error <code>report_too_early</code>.<a href="#section-4.4.1.4-3.2" class="pilcrow">¶</a>
</li>
              <li id="section-4.4.1.4-3.3">Check if the report's timestamp has passed the task's <code>task_expiration</code> time.
If so, the Aggregator <span class="bcp14">MAY</span> mark the input share as invalid with the error
"task_expired".<a href="#section-4.4.1.4-3.3" class="pilcrow">¶</a>
</li>
              <li id="section-4.4.1.4-3.4">Check if the PlaintextInputShare contains unrecognized extensions. If so, the
Aggregator <span class="bcp14">MUST</span> mark the input share as invalid with error
"unrecognized_message".<a href="#section-4.4.1.4-3.4" class="pilcrow">¶</a>
</li>
              <li id="section-4.4.1.4-3.5">Check if the ExtensionType of any two extensions in PlaintextInputShare are
the same. If so, the Aggregator <span class="bcp14">MUST</span> mark the input share as invalid with
error "unrecognized_message".<a href="#section-4.4.1.4-3.5" class="pilcrow">¶</a>
</li>
              <li id="section-4.4.1.4-3.6">
                <p id="section-4.4.1.4-3.6.1">Check if the report may still be aggregated with the current aggregation
parameter. This can be done by looking up all aggregation parameters
previously used for this report and calling<a href="#section-4.4.1.4-3.6.1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4.1.4-3.6.2">
<pre>
VDAF.is_valid(current_agg_param, previous_agg_params)
</pre><a href="#section-4.4.1.4-3.6.2" class="pilcrow">¶</a>
</div>
<p id="section-4.4.1.4-3.6.3">
If this returns false, the input share <span class="bcp14">MUST</span> be marked as invalid with the
error <code>report_replayed</code>.<a href="#section-4.4.1.4-3.6.3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.1.4-3.6.4.1">Implementation note: To detect replay attacks, each Aggregator is required
to keep track of the set of reports it has processed for a given task.
Because honest Clients choose the report ID at random, it is sufficient to
store the set of IDs of processed reports. However, implementations may
find it helpful to track additional information, like the timestamp, so
that the storage used for anti-replay can be sharded efficiently.<a href="#section-4.4.1.4-3.6.4.1" class="pilcrow">¶</a>
</li>
                </ul>
</li>
              <li id="section-4.4.1.4-3.7">
                <p id="section-4.4.1.4-3.7.1">If the report pertains to a batch that was previously collected, then make
sure the report was already included in all previous collections for the
batch. If not, the input share <span class="bcp14">MUST</span> be marked as invalid with error
"batch_collected". This prevents Collectors from learning anything about
small numbers of reports that are uploaded between two collections of a
batch.<a href="#section-4.4.1.4-3.7.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.1.4-3.7.2.1">
                    <p id="section-4.4.1.4-3.7.2.1.1">Implementation note: The Leader considers a batch to be collected once it
has completed a collection job for a CollectionReq message from the
Collector; the Helper considers a batch to be collected once it has
responded to an AggregateShareReq message from the Leader. A batches is
determined by query (<a href="#query" class="auto internal xref">Section 4.1</a>) conveyed in these messages. Queries must
satisfy the criteria covered in <a href="#batch-validation" class="auto internal xref">Section 4.5.6</a>. These criteria are
meant to restrict queries in a way make it easy to determine wither a
report pertains to a batch that was collected.<a href="#section-4.4.1.4-3.7.2.1.1" class="pilcrow">¶</a></p>
<p id="section-4.4.1.4-3.7.2.1.2">
[TODO: If a section to clarify report and batch states is added this can be
removed. See Issue #384]<a href="#section-4.4.1.4-3.7.2.1.2" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li id="section-4.4.1.4-3.8">
                <p id="section-4.4.1.4-3.8.1">Depending on the query type for the task, additional checks may be
applicable:<a href="#section-4.4.1.4-3.8.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.1.4-3.8.2.1">For fixed_size tasks, the Aggregators need to ensure that each batch is
roughly the same size. If the number of reports aggregated for the current
batch exceeds the maximum batch size (per the task configuration), the
Aggregator <span class="bcp14">MAY</span> mark the input share as invalid with the error
"batch_saturated". Note that this behavior is not strictly enforced here
but during the collect sub-protocol. (See <a href="#batch-validation" class="auto internal xref">Section 4.5.6</a>.) If both
checks succeed, the input share is not marked as invalid.<a href="#section-4.4.1.4-3.8.2.1" class="pilcrow">¶</a>
</li>
                </ul>
</li>
              <li id="section-4.4.1.4-3.9">Finally, if an Aggregator cannot determine if an input share is valid, it
<span class="bcp14">MUST</span> mark the input share as invalid with error <code>report_dropped</code>. For
example, if the Aggregator has evicted the state required to perform the
check from long-term storage. (See <a href="#reducing-storage-requirements" class="auto internal xref">Section 5.4.1</a> for
details.)<a href="#section-4.4.1.4-3.9" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-4.4.1.4-4">If all of the above checks succeed, the input share is not marked as invalid.<a href="#section-4.4.1.4-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="input-share-prep">
<section id="section-4.4.1.5">
            <h5 id="name-input-share-preparation">
<a href="#section-4.4.1.5" class="section-number selfRef">4.4.1.5. </a><a href="#name-input-share-preparation" class="section-name selfRef">Input Share Preparation</a>
            </h5>
<p id="section-4.4.1.5-1">Input share preparation consists of running the preparation-state initialization
algorithm for the VDAF associated with the task and computing the first state
transition. This produces three possible values:<a href="#section-4.4.1.5-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.4.1.5-2">
<li id="section-4.4.1.5-2.1">An error, in which case the input report share is marked as invalid.<a href="#section-4.4.1.5-2.1" class="pilcrow">¶</a>
</li>
              <li id="section-4.4.1.5-2.2">An output share, in which case the aggregator stores the output share for
future collection as described in <a href="#collect-flow" class="auto internal xref">Section 4.5</a>.<a href="#section-4.4.1.5-2.2" class="pilcrow">¶</a>
</li>
              <li id="section-4.4.1.5-2.3">An initial VDAF state and preparation message-share, denoted <code>(prep_state,
prep_share)</code>.<a href="#section-4.4.1.5-2.3" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-4.4.1.5-3">Each aggregator runs this procedure for a given input share with corresponding
report ID as follows:<a href="#section-4.4.1.5-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4.1.5-4">
<pre>
prep_state = VDAF.prep_init(vdaf_verify_key,
                            agg_id,
                            agg_param,
                            report_id,
                            public_share,
                            plaintext_input_share.payload)
out = VDAF.prep_next(prep_state, None)
</pre><a href="#section-4.4.1.5-4" class="pilcrow">¶</a>
</div>
<p id="section-4.4.1.5-5"><code>vdaf_verify_key</code> is the VDAF verification key shared by the Aggregators;
<code>agg_id</code> is the aggregator ID (<code>0x00</code> for the Leader and <code>0x01</code> for the helper);
<code>agg_param</code> is the opaque aggregation parameter distributed to the Aggregators
by the Collector; <code>public_share</code> is the public share generated by the client and
distributed to each aggregator; and <code>plaintext_input_share</code> is the Aggregator's
PlaintextInputShare.<a href="#section-4.4.1.5-5" class="pilcrow">¶</a></p>
<p id="section-4.4.1.5-6">If either step fails, the Aggregator marks the report as invalid with error
<code>vdaf_prep_error</code>. Otherwise, the value <code>out</code> is interpreted as follows. If this
is the last round of the VDAF, then <code>out</code> is the aggregator's output share.
Otherwise, <code>out</code> is the pair <code>(prep_state, prep_share)</code>.<a href="#section-4.4.1.5-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="aggregation-job-validation">
<section id="section-4.4.1.6">
            <h5 id="name-aggregation-job-validation">
<a href="#section-4.4.1.6" class="section-number selfRef">4.4.1.6. </a><a href="#name-aggregation-job-validation" class="section-name selfRef">Aggregation Job Validation</a>
            </h5>
<p id="section-4.4.1.6-1">During the aggregation job initialization (<a href="#leader-init" class="auto internal xref">Section 4.4.1.1</a>) or continuation
(<a href="#agg-continue-flow" class="auto internal xref">Section 4.4.2</a>) phases, the Leader will receive an <code>AggregationJobResp</code>
message from the Helper, which needs to be validated before the Leader can move
to the next phase of the aggregation protocol.<a href="#section-4.4.1.6-1" class="pilcrow">¶</a></p>
<p id="section-4.4.1.6-2">An <code>AggregationJobResp</code> is valid only if it satisfies the following requirement:<a href="#section-4.4.1.6-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.1.6-3.1">The Helper's <code>prepare_steps</code> <span class="bcp14">MUST</span> include exactly the same report IDs in the
same order as either the <code>report_shares</code> in the Leader's
<code>AggregationJobInitReq</code> (if this is the first round of continuation) or the
<code>prepare_steps</code> in the Leader's <code>AggregationJobContinueReq</code> (if this is a
subsequent round).<a href="#section-4.4.1.6-3.1" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-4.4.1.6-4">[[OPEN ISSUE: consider relaxing this ordering constraint. See issue#217.]]<a href="#section-4.4.1.6-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="agg-continue-flow">
<section id="section-4.4.2">
          <h4 id="name-aggregate-continuation">
<a href="#section-4.4.2" class="section-number selfRef">4.4.2. </a><a href="#name-aggregate-continuation" class="section-name selfRef">Aggregate Continuation</a>
          </h4>
<p id="section-4.4.2-1">In the continuation phase, the leader drives the VDAF preparation of each share
in the candidate report set until the underlying VDAF moves into a terminal
state, yielding an output share for all Aggregators or an error. This phase may
involve multiple rounds of interaction depending on the underlying VDAF. Each
round trip is initiated by the leader.<a href="#section-4.4.2-1" class="pilcrow">¶</a></p>
<div id="aggregation-leader-continuation">
<section id="section-4.4.2.1">
            <h5 id="name-leader-continuation">
<a href="#section-4.4.2.1" class="section-number selfRef">4.4.2.1. </a><a href="#name-leader-continuation" class="section-name selfRef">Leader Continuation</a>
            </h5>
<p id="section-4.4.2.1-1">The Leader begins each round of continuation for a report share based on its
locally computed prepare message and the previous PrepareStep from the Helper.
If PrepareStep is of type <code>failed</code>, then the leader acts based on the value of
the <code>ReportShareError</code>:<a href="#section-4.4.2.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.2.1-2.1">If the error is <code>ReportShareError.report_too_early</code>, then the leader <span class="bcp14">MAY</span> try
to re-send the report in a later <code>AggregationJobInitReq</code>.<a href="#section-4.4.2.1-2.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-4.4.2.1-2.2">For any other error, the leader marks the report as failed, removes it from
the candidate report set and does not process it further.<a href="#section-4.4.2.1-2.2" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-4.4.2.1-3">If the type is <code>finished</code> and the Leader's preparation of this report share is
also finished, then the report share is aggregated and can now be collected (see
<a href="#collect-flow" class="auto internal xref">Section 4.5</a>). If the Leader is not finished, then the report cannot be
processed further and <span class="bcp14">MUST</span> be removed from the candidate set.<a href="#section-4.4.2.1-3" class="pilcrow">¶</a></p>
<p id="section-4.4.2.1-4">If the Helper's <code>PrepareStep</code> is of type <code>continued</code>, then the Leader proceeds
as follows.<a href="#section-4.4.2.1-4" class="pilcrow">¶</a></p>
<p id="section-4.4.2.1-5">Let <code>leader_prep_share</code> denote the Leader's prepare message-share and
<code>helper_prep_share</code> denote the Helper's. The Leader computes the next state
transition as follows:<a href="#section-4.4.2.1-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4.2.1-6">
<pre>
prep_msg = VDAF.prep_shares_to_prep(agg_param, [
    leader_prep_share,
    helper_prep_share,
])
out = VDAF.prep_next(prep_state, prep_msg)
</pre><a href="#section-4.4.2.1-6" class="pilcrow">¶</a>
</div>
<p id="section-4.4.2.1-7">where <code>[leader_prep_share, helper_prep_share]</code> is a vector of two elements. If
either of these operations fails, then the leader marks the report as invalid
with error "prep_share_failed". Otherwise it interprets <code>out</code> as follows: If
this is the last round of the VDAF, then <code>out</code> is the Leader's output share, in
which case it stores the output share for further processing as described in
<a href="#collect-flow" class="auto internal xref">Section 4.5</a>. Otherwise, <code>out</code> is the pair <code>(next_prep_state,
next_prep_share)</code>, where <code>next_prep_state</code> is its updated state and
<code>next_prep_share</code> is its next preparation message-share (which will be
<code>leader_prep_share</code> in the next round of continuation). For the latter case, the
helper sets <code>prep_state</code> to <code>next_prep_state</code>.<a href="#section-4.4.2.1-7" class="pilcrow">¶</a></p>
<p id="section-4.4.2.1-8">The Leader now advances its aggregation job to the next round (round 1 if this
is the first continuation after initialization) and then instructs the Helper to
advance the aggregation job to the round the Leader has just reached by sending
the new <code>prep_msg</code> message to the Helper in a POST request to the aggregation
job URI used during initialization (see <a href="#leader-init" class="auto internal xref">Section 4.4.1.1</a>). The body of the
request is an <code>AggregationJobContinueReq</code>:<a href="#section-4.4.2.1-8" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4.2.1-9">
<pre>
struct {
  u16 round;
  PrepareStep prepare_steps&lt;1..2^32-1&gt;;
} AggregationJobContinueReq;
</pre><a href="#section-4.4.2.1-9" class="pilcrow">¶</a>
</div>
<p id="section-4.4.2.1-10">The <code>round</code> field is the round of VDAF preparation that the Leader just reached
and wants the Helper to advance to.<a href="#section-4.4.2.1-10" class="pilcrow">¶</a></p>
<p id="section-4.4.2.1-11">The <code>prepare_steps</code> field <span class="bcp14">MUST</span> be a sequence of <code>PrepareStep</code>s in the
<code>continued</code> state containing the corresponding <code>inbound</code> prepare message. The
media type is set to "application/dap-aggregation-job-continue-req".<a href="#section-4.4.2.1-11" class="pilcrow">¶</a></p>
<p id="section-4.4.2.1-12">The Helper's response will be an <code>AggregationJobResp</code> message (see
<a href="#aggregation-helper-init" class="auto internal xref">Section 4.4.1.2</a>), which the Leader validates according to
the criteria in <a href="#aggregation-job-validation" class="auto internal xref">Section 4.4.1.6</a>. If the message is valid, the
Leader moves to the next round of continuation with the enclosed prepare steps.
Otherwise, the Leader should abandon the aggregation job entirely.<a href="#section-4.4.2.1-12" class="pilcrow">¶</a></p>
</section>
</div>
<div id="aggregation-helper-continuation">
<section id="section-4.4.2.2">
            <h5 id="name-helper-continuation">
<a href="#section-4.4.2.2" class="section-number selfRef">4.4.2.2. </a><a href="#name-helper-continuation" class="section-name selfRef">Helper Continuation</a>
            </h5>
<p id="section-4.4.2.2-1">If the Helper does not recognize the task ID, then it <span class="bcp14">MUST</span> abort with error
<code>unrecognizedTask</code>.<a href="#section-4.4.2.2-1" class="pilcrow">¶</a></p>
<p id="section-4.4.2.2-2">Otherwise, the Helper continues with preparation for a report share by combining
the previous message round's prepare message (carried by the AggregationJobReq)
and its current preparation state (<code>prep_state</code>). This step yields one of three
outputs:<a href="#section-4.4.2.2-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.4.2.2-3">
<li id="section-4.4.2.2-3.1">An error, in which case the report share is marked as invalid.<a href="#section-4.4.2.2-3.1" class="pilcrow">¶</a>
</li>
              <li id="section-4.4.2.2-3.2">An output share, in which case the helper stores the output share for future
collection as described in <a href="#collect-flow" class="auto internal xref">Section 4.5</a>.<a href="#section-4.4.2.2-3.2" class="pilcrow">¶</a>
</li>
              <li id="section-4.4.2.2-3.3">Its next VDAF preparation state and message-share, denoted <code>(next_prep_state,
next_prep_share)</code>.<a href="#section-4.4.2.2-3.3" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-4.4.2.2-4">To carry out this step, for each <code>PrepareStep</code> in <code>AggregationJob.prepare_steps</code>
received from the leader, the helper performs the following check to determine
if it should continue preparing the report share:<a href="#section-4.4.2.2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.2.2-5.1">If the status is <code>failed</code>, then mark the report as failed and reply with a
failed PrepareStep to the Leader.<a href="#section-4.4.2.2-5.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-4.4.2.2-5.2">If the status is <code>finished</code>, then mark the report as finished and reply with a
finished PrepareStep to the leader. The Helper then stores the output share
and awaits collection; see <a href="#collect-flow" class="auto internal xref">Section 4.5</a>.<a href="#section-4.4.2.2-5.2" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-4.4.2.2-6">Otherwise, preparation continues. The Helper <span class="bcp14">MUST</span> check its current round
against the Leader's <code>AggregationJobContinueReq.round</code> value. If the Leader is
one round ahead of the Helper, then the Helper combines the Leader's prepare
message and the Helper's current preparation state as follows:<a href="#section-4.4.2.2-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4.2.2-7">
<pre>
out = VDAF.prep_next(prep_state, prep_msg)
</pre><a href="#section-4.4.2.2-7" class="pilcrow">¶</a>
</div>
<p id="section-4.4.2.2-8">where <code>prep_msg</code> is the previous VDAF prepare message sent by the leader and
<code>prep_state</code> is the helper's current preparation state. This step yields one of
three outputs:<a href="#section-4.4.2.2-8" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4.2.2-9.1">An error, in which case the report share is marked as failed and the Helper
replies to the Leader with a <code>PrepareStep</code> in the <code>failed</code> state.<a href="#section-4.4.2.2-9.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-4.4.2.2-9.2">An output share, in which case the Helper stores the output share for future
collection as described in <a href="#collect-flow" class="auto internal xref">Section 4.5</a> and replies to the Leader with a
<code>PrepareStep</code> in the <code>finished</code> state.<a href="#section-4.4.2.2-9.2" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-4.4.2.2-9.3">An updated VDAF state and preparation message-share, denoted
<code>(next_prep_state, next_prep_msg)</code>, in which case the Helper replies to the
Leader with a <code>PrepareStep</code> in the <code>continued</code> state containing <code>prep_share</code>.<a href="#section-4.4.2.2-9.3" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-4.4.2.2-10">After stepping each state, the Helper advances its aggregation job to the
Leader's <code>AggregationJobContinueReq.round</code>.<a href="#section-4.4.2.2-10" class="pilcrow">¶</a></p>
<p id="section-4.4.2.2-11">If the <code>round</code> in the Leader's request is 0, then the Helper <span class="bcp14">MUST</span> abort with an
error of type <code>unrecognizedMessage</code>.<a href="#section-4.4.2.2-11" class="pilcrow">¶</a></p>
<p id="section-4.4.2.2-12">If the <code>round</code> in the Leader's request is equal to the Helper's current round
(i.e., this is not the first time the Leader has sent this request), then the
Helper responds with the current round's prepare message-shares. The Helper
<span class="bcp14">SHOULD</span> verify that the contents of the <code>AggregationJobContinueReq</code> are identical
to the previous message (see <a href="#aggregation-round-skew-recovery" class="auto internal xref">Section 4.4.2.3</a>).<a href="#section-4.4.2.2-12" class="pilcrow">¶</a></p>
<p id="section-4.4.2.2-13">If the Leader's <code>round</code> is behind or more than one round ahead of the Helper's
current round, then the Helper <span class="bcp14">MUST</span> abort with an error of type <code>roundMismatch</code>.<a href="#section-4.4.2.2-13" class="pilcrow">¶</a></p>
<p id="section-4.4.2.2-14">If successful, the Helper responds to the Leader with HTTP status 200 OK, media
type <code>application/dap-aggregation-job-resp</code> and a body consisting of an
<code>AggregationJobResp</code> (see <a href="#aggregation-helper-init" class="auto internal xref">Section 4.4.1.2</a>) compiled from the stepped
<code>PrepareStep</code>s.<a href="#section-4.4.2.2-14" class="pilcrow">¶</a></p>
</section>
</div>
<div id="aggregation-round-skew-recovery">
<section id="section-4.4.2.3">
            <h5 id="name-recovering-from-round-skew">
<a href="#section-4.4.2.3" class="section-number selfRef">4.4.2.3. </a><a href="#name-recovering-from-round-skew" class="section-name selfRef">Recovering From Round Skew</a>
            </h5>
<p id="section-4.4.2.3-1"><code>AggregationJobContinueReq</code> messages contain a <code>round</code> field, allowing
Aggregators to ensure that their peer is on an expected round of the VDAF
preparation algorithm. In particular, the intent is to allow recovery from a
scenario where the Helper successfully advances from round <code>n</code> to <code>n+1</code>, but its
<code>AggregationJobResp</code> response to the Leader gets dropped due to something like a
transient network failure. The Leader could then resend the request to have the
Helper advance to round <code>n+1</code> and the Helper should be able to retransmit the
<code>AggregationJobContinueReq</code> that was previously dropped. To make that kind of
recovery possible, Aggregator implementations <span class="bcp14">SHOULD</span> checkpoint the most recent
round's preparation state and messages to durable storage such that Leaders can
re-construct continuation requests and Helpers can re-construct continuation
responses as needed.<a href="#section-4.4.2.3-1" class="pilcrow">¶</a></p>
<p id="section-4.4.2.3-2">When implementing a round skew recovery strategy, Helpers <span class="bcp14">SHOULD</span> ensure that the
Leader's <code>AggregationJobContinueReq</code> message did not change when it was re-sent
(i.e., the two messages must contain the same set of report IDs and prepare
messages). This prevents the Leader from re-winding an aggregation job and
re-running a round with different parameters.<a href="#section-4.4.2.3-2" class="pilcrow">¶</a></p>
<p id="section-4.4.2.3-3">[[OPEN ISSUE: Allowing the Leader to "rewind" aggregation job state of the
Helper may allow an attack on privacy. For instance, if the VDAF verification
key changes, the preparation shares in the Helper's response would change even
if the consistency check is made. Security analysis is required. See #401.]]<a href="#section-4.4.2.3-3" class="pilcrow">¶</a></p>
<p id="section-4.4.2.3-4">One way a Helper could address this would be to store a digest of the Leader's
request, indexed by aggregation job ID and round, and refuse to service a
request for a given aggregation job round unless it matches the previously seen
request (if any).<a href="#section-4.4.2.3-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="aggregate-message-security">
<section id="section-4.4.3">
          <h4 id="name-aggregate-message-security">
<a href="#section-4.4.3" class="section-number selfRef">4.4.3. </a><a href="#name-aggregate-message-security" class="section-name selfRef">Aggregate Message Security</a>
          </h4>
<p id="section-4.4.3-1">Aggregate sub-protocol messages must be confidential and mutually authenticated.<a href="#section-4.4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.4.3-2">The aggregate sub-protocol is driven by the leader acting as an HTTPS client,
making requests to the helper's HTTPS server. HTTPS provides confidentiality and
authenticates the helper to the leader.<a href="#section-4.4.3-2" class="pilcrow">¶</a></p>
<p id="section-4.4.3-3">Leaders <span class="bcp14">MUST</span> authenticate their requests to helpers using a scheme that meets
the requirements in <a href="#request-authentication" class="auto internal xref">Section 3.1</a>.<a href="#section-4.4.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="collect-flow">
<section id="section-4.5">
        <h3 id="name-collecting-results">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-collecting-results" class="section-name selfRef">Collecting Results</a>
        </h3>
<p id="section-4.5-1">In this phase, the Collector requests aggregate shares from each Aggregator and
then locally combines them to yield a single aggregate result. In particular,
the Collector issues a query to the Leader (<a href="#query" class="auto internal xref">Section 4.1</a>), which the Aggregators
use to select a batch of reports to aggregate. Each emits an aggregate share
encrypted to the Collector so that it can decrypt and combine them to yield the
aggregate result. This entire process is composed of two interactions:<a href="#section-4.5-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.5-2">
<li id="section-4.5-2.1">Collect request and response between the collector and leader, specified in
<a href="#collect-init" class="auto internal xref">Section 4.5.1</a><a href="#section-4.5-2.1" class="pilcrow">¶</a>
</li>
          <li id="section-4.5-2.2">Aggregate share request and response between the leader and each aggregator,
specified in <a href="#collect-aggregate" class="auto internal xref">Section 4.5.2</a><a href="#section-4.5-2.2" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-4.5-3">Once complete, the collector computes the final aggregate result as specified in
<a href="#collect-finalization" class="auto internal xref">Section 4.5.3</a>.<a href="#section-4.5-3" class="pilcrow">¶</a></p>
<p id="section-4.5-4">This overall process is referred to as a "collection job".<a href="#section-4.5-4" class="pilcrow">¶</a></p>
<div id="collect-init">
<section id="section-4.5.1">
          <h4 id="name-collection-job-initializati">
<a href="#section-4.5.1" class="section-number selfRef">4.5.1. </a><a href="#name-collection-job-initializati" class="section-name selfRef">Collection Job Initialization</a>
          </h4>
<p id="section-4.5.1-1">First, the Collector chooses a collection job ID:<a href="#section-4.5.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.5.1-2">
<pre>
opaque CollectionJobID[16];
</pre><a href="#section-4.5.1-2" class="pilcrow">¶</a>
</div>
<p id="section-4.5.1-3">This ID <span class="bcp14">MUST</span> be unique within the context of the corresponding DAP task. It is
<span class="bcp14">RECOMMENDED</span> that this be set to a random string output by a cryptographically
secure pseudorandom number generator.<a href="#section-4.5.1-3" class="pilcrow">¶</a></p>
<p id="section-4.5.1-4">To initiate the collection job, the collector issues a PUT request to
<code>{leader}/tasks/{task-id}/collection_jobs/{collection-job-id}</code>. The body of the
request is structured as follows:<a href="#section-4.5.1-4" class="pilcrow">¶</a></p>
<p id="section-4.5.1-5">[OPEN ISSUE: Decide if and how the Collector's request is authenticated. If not,
then we need to ensure that collection job URIs are resistant to enumeration
attacks.]<a href="#section-4.5.1-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.5.1-6">
<pre>
struct {
  Query query;
  opaque agg_param&lt;0..2^32-1&gt;; /* VDAF aggregation parameter */
} CollectionReq;
</pre><a href="#section-4.5.1-6" class="pilcrow">¶</a>
</div>
<p id="section-4.5.1-7">The named parameters are:<a href="#section-4.5.1-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.1-8.1">
              <code>query</code>, the Collector's query. The indicated query type <span class="bcp14">MUST</span> match the task's
query type. Otherwise, the Leader <span class="bcp14">MUST</span> abort with error "queryMismatch".<a href="#section-4.5.1-8.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.1-8.2">
              <code>agg_param</code>, an aggregation parameter for the VDAF being executed. This is the
same value as in <code>AggregationJobInitReq</code> (see <a href="#leader-init" class="auto internal xref">Section 4.4.1.1</a>).<a href="#section-4.5.1-8.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.5.1-9">Depending on the VDAF scheme and how the Leader is configured, the Leader and
Helper may already have prepared a sufficient number of reports satisfying the
query and be ready to return the aggregate shares right away. However, this is
not always the case. In fact, for some VDAFs, it is not be possible to begin
running aggregation jobs (<a href="#aggregate-flow" class="auto internal xref">Section 4.4</a>) until the Collector initiates a
collection job. This is because, in general, the aggregation parameter is not
known until this point. In certain situations it is possible to predict the
aggregation parameter in advance. For example, for Prio3 the only valid
aggregation parameter is the empty string. For these reasons, the collection
job is handled asynchronously.<a href="#section-4.5.1-9" class="pilcrow">¶</a></p>
<p id="section-4.5.1-10">Upon receipt of a <code>CollectionReq</code>, the Leader begins by checking that it
recognizes the task ID in the request path. If not, it <span class="bcp14">MUST</span> abort with error
<code>unrecognizedTask</code>. Then, the Leader verifies that the request meets the
requirements of the batch parameters using the procedure in
<a href="#batch-validation" class="auto internal xref">Section 4.5.6</a>. If so, it immediately responds with HTTP status 201.<a href="#section-4.5.1-10" class="pilcrow">¶</a></p>
<p id="section-4.5.1-11">The Leader then begins working with the Helper to aggregate the reports
satisfying the query (or continues this process, depending on the VDAF) as
described in <a href="#aggregate-flow" class="auto internal xref">Section 4.4</a>.<a href="#section-4.5.1-11" class="pilcrow">¶</a></p>
<p id="section-4.5.1-12">After receiving the response to its <code>CollectionReq</code>, the Collector makes an HTTP
<code>POST</code> request to the collection job URI to check on the status of the collect
job and eventually obtain the result. If the collection job is not finished
yet, the Leader responds with HTTP status 202 Accepted. The response <span class="bcp14">MAY</span> include
a Retry-After header field to suggest a polling interval to the Collector.<a href="#section-4.5.1-12" class="pilcrow">¶</a></p>
<p id="section-4.5.1-13">The Leader obtains each Helper's aggregate share following the
aggregate-share request flow described in <a href="#collect-aggregate" class="auto internal xref">Section 4.5.2</a>. When all
aggregate shares are successfully obtained, the Leader responds to subsequent
HTTP POST requests to the collection job with HTTP status code 200 OK and a body
consisting of a <code>Collection</code>:<a href="#section-4.5.1-13" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.5.1-14">
<pre>
struct {
  PartialBatchSelector part_batch_selector;
  uint64 report_count;
  Interval interval;
  HpkeCiphertext encrypted_agg_shares&lt;1..2^32-1&gt;;
} Collection;
</pre><a href="#section-4.5.1-14" class="pilcrow">¶</a>
</div>
<p id="section-4.5.1-15">This structure includes the following:<a href="#section-4.5.1-15" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.1-16.1">
              <p id="section-4.5.1-16.1.1"><code>part_batch_selector</code>: Information used to bind the aggregate result to the
query. For fixed_size tasks, this includes the batch ID assigned to the batch
by the Leader. The indicated query type <span class="bcp14">MUST</span> match the task's query type.<a href="#section-4.5.1-16.1.1" class="pilcrow">¶</a></p>
<p id="section-4.5.1-16.1.2">
[OPEN ISSUE: What should the Collector do if the query type doesn't match?]<a href="#section-4.5.1-16.1.2" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.5.1-16.2">The number of reports included in the batch.<a href="#section-4.5.1-16.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.1-16.3">The smallest interval of time that contains the timestamps of all reports
included in the batch, such that the interval's start and duration are
both multiples of the task's <code>time_precision</code> parameter. Note that in the case
of a <code>time_interval</code> type query (see <a href="#query" class="auto internal xref">Section 4.1</a>), this interval can be smaller
than the one in the corresponding <code>CollectionReq.query</code>.<a href="#section-4.5.1-16.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.1-16.4">The vector of encrypted aggregate shares. They <span class="bcp14">MUST</span> appear in the same order
as the aggregator endpoints list of the task parameters.<a href="#section-4.5.1-16.4" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.5.1-17">If obtaining aggregate shares fails, then the leader responds to subsequent HTTP
POST requests to the collection job with an HTTP error status and a problem
document as described in <a href="#errors" class="auto internal xref">Section 3.2</a>.<a href="#section-4.5.1-17" class="pilcrow">¶</a></p>
<p id="section-4.5.1-18">The Leader <span class="bcp14">MAY</span> respond with HTTP status 204 No Content to requests to a
collection job if the results have been deleted.<a href="#section-4.5.1-18" class="pilcrow">¶</a></p>
<p id="section-4.5.1-19">The collector can send an HTTP DELETE request to the collection job, which
indicates to the leader that it can abandon the collection job and discard all
state related to it.<a href="#section-4.5.1-19" class="pilcrow">¶</a></p>
<div id="a-note-on-idempotence">
<section id="section-4.5.1.1">
            <h5 id="name-a-note-on-idempotence">
<a href="#section-4.5.1.1" class="section-number selfRef">4.5.1.1. </a><a href="#name-a-note-on-idempotence" class="section-name selfRef">A Note on Idempotence</a>
            </h5>
<p id="section-4.5.1.1-1">The reason we use a POST instead of a GET to poll the state of a collection job
is because of the fixed-size query mode (see <a href="#fixed-size-query" class="auto internal xref">Section 4.1.2</a>). Collectors
may make a query against the current batch, and it is the Leader's
responsibility to keep track of what batch is current for some task. Polling a
collection job is the only point at which it is safe for the Leader to change
its current batch, since it constitutes acknowledgement on the Collector's part
that it received the response to some previous PUT request to the collection
jobs resource.<a href="#section-4.5.1.1-1" class="pilcrow">¶</a></p>
<p id="section-4.5.1.1-2">This means that polling a collection job can have the side effect of changing
the current batch in the Leader, and thus using a GET is inappropriate.<a href="#section-4.5.1.1-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="collect-aggregate">
<section id="section-4.5.2">
          <h4 id="name-obtaining-aggregate-shares">
<a href="#section-4.5.2" class="section-number selfRef">4.5.2. </a><a href="#name-obtaining-aggregate-shares" class="section-name selfRef">Obtaining Aggregate Shares</a>
          </h4>
<p id="section-4.5.2-1">The Leader obtains each Helper's encrypted aggregate share before it completes a
collection job. To do this, the Leader first computes a checksum over the set of
output shares included in the batch. The checksum is computed by taking the
SHA256 <span>[<a href="#SHS" class="cite xref">SHS</a>]</span> hash of each report ID from the
client reports included in the aggregation, then combining the hash values with
a bitwise-XOR operation.<a href="#section-4.5.2-1" class="pilcrow">¶</a></p>
<p id="section-4.5.2-2">Then, for each Helper endpoint, <code>{helper}</code>, associated with the task (see
<a href="#task-configuration" class="auto internal xref">Section 4.2</a>), the Leader sends a POST request to
<code>{helper}/tasks/{task-id}/aggregate_shares</code> with the following message:<a href="#section-4.5.2-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.5.2-3">
<pre>
struct {
  QueryType query_type;
  select (BatchSelector.query_type) {
    case time_interval: Interval batch_interval;
    case fixed_size: BatchID batch_id;
  };
} BatchSelector;

struct {
  BatchSelector batch_selector;
  opaque agg_param&lt;0..2^32-1&gt;;
  uint64 report_count;
  opaque checksum[32];
} AggregateShareReq;
</pre><a href="#section-4.5.2-3" class="pilcrow">¶</a>
</div>
<p id="section-4.5.2-4">The message contains the following parameters:<a href="#section-4.5.2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.2-5.1">
              <p id="section-4.5.2-5.1.1"><code>batch_selector</code>: The "batch selector", which encodes parameters used to
determine the batch being aggregated. The value depends on the query type for
the task:<a href="#section-4.5.2-5.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.2-5.1.2.1">For time_interval tasks, the request specifies the batch interval.<a href="#section-4.5.2-5.1.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4.5.2-5.1.2.2">For fixed_size tasks, the request specifies the batch ID.<a href="#section-4.5.2-5.1.2.2" class="pilcrow">¶</a>
</li>
              </ul>
<p id="section-4.5.2-5.1.3">
The indicated query type <span class="bcp14">MUST</span> match the task's query type. Otherwise, the
Helper <span class="bcp14">MUST</span> abort with "queryMismatch".<a href="#section-4.5.2-5.1.3" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.5.2-5.2">
              <code>agg_param</code>: The opaque aggregation parameter for the VDAF being executed.
This value <span class="bcp14">MUST</span> match the AggregationJobInitReq message for each aggregation
job used to compute the aggregate shares (see <a href="#leader-init" class="auto internal xref">Section 4.4.1.1</a>) and the
aggregation parameter indicated by the Collector in the CollectionReq message
(see <a href="#collect-init" class="auto internal xref">Section 4.5.1</a>).<a href="#section-4.5.2-5.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.2-5.3">
              <code>report_count</code>: The number number of reports included in the batch.<a href="#section-4.5.2-5.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.2-5.4">
              <code>checksum</code>: The batch checksum.<a href="#section-4.5.2-5.4" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.5.2-6">To handle the Leader's request, the Helper first ensures that it recognizes the
task ID in the request path. If not, it <span class="bcp14">MUST</span> abort with error
<code>unrecognizedTask</code>. The Helper then verifies that the request meets the
requirements for batch parameters following the procedure in
<a href="#batch-validation" class="auto internal xref">Section 4.5.6</a>.<a href="#section-4.5.2-6" class="pilcrow">¶</a></p>
<p id="section-4.5.2-7">Next, it computes a checksum based on the reports that satisfy the query, and
checks that the <code>report_count</code> and <code>checksum</code> included in the request match its
computed values. If not, then it <span class="bcp14">MUST</span> abort with an error of type
"batchMismatch".<a href="#section-4.5.2-7" class="pilcrow">¶</a></p>
<p id="section-4.5.2-8">Next, it computes the aggregate share <code>agg_share</code> corresponding to the set of
output shares, denoted <code>out_shares</code>, for the batch interval, as follows:<a href="#section-4.5.2-8" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.5.2-9">
<pre>
agg_share = VDAF.out_shares_to_agg_share(agg_param, out_shares)
</pre><a href="#section-4.5.2-9" class="pilcrow">¶</a>
</div>
<p id="section-4.5.2-10">Implementation note: For most VDAFs, it is possible to aggregate output shares
as they arrive rather than wait until the batch is collected. To do so however,
it is necessary to enforce the batch parameters as described in
<a href="#batch-validation" class="auto internal xref">Section 4.5.6</a> so that the aggregator knows which aggregate share to
update.<a href="#section-4.5.2-10" class="pilcrow">¶</a></p>
<p id="section-4.5.2-11">The Helper then encrypts <code>agg_share</code> under the collector's HPKE public key as
described in <a href="#aggregate-share-encrypt" class="auto internal xref">Section 4.5.4</a>, yielding <code>encrypted_agg_share</code>.
Encryption prevents the Leader from learning the actual result, as it only has
its own aggregate share and cannot compute the Helper's.<a href="#section-4.5.2-11" class="pilcrow">¶</a></p>
<p id="section-4.5.2-12">The Helper responds to the Leader with HTTP status code 200 OK and a body
consisting of an <code>AggregateShare</code>:<a href="#section-4.5.2-12" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.5.2-13">
<pre>
struct {
  HpkeCiphertext encrypted_aggregate_share;
} AggregateShare;
</pre><a href="#section-4.5.2-13" class="pilcrow">¶</a>
</div>
<p id="section-4.5.2-14"><code>encrypted_aggregate_share.config_id</code> is set to the Collector's HPKE config ID.
<code>encrypted_aggregate_share.enc</code> is set to the encapsulated HPKE context <code>enc</code>
computed above and <code>encrypted_aggregate_share.ciphertext</code> is the ciphertext
<code>encrypted_agg_share</code> computed above.<a href="#section-4.5.2-14" class="pilcrow">¶</a></p>
<p id="section-4.5.2-15">After receiving the Helper's response, the Leader uses the HpkeCiphertext to
finalize a collection job (see <a href="#collect-finalization" class="auto internal xref">Section 4.5.3</a>).<a href="#section-4.5.2-15" class="pilcrow">¶</a></p>
<p id="section-4.5.2-16">Once an AggregateShareReq has been issued for the batch determined by a given
query, it is an error for the Leader to issue any more aggregation jobs for
additional reports that satisfy the query. These reports will be rejected by
helpers as described <a href="#input-share-validation" class="auto internal xref">Section 4.4.1.4</a>.<a href="#section-4.5.2-16" class="pilcrow">¶</a></p>
<p id="section-4.5.2-17">Before completing the collection job, the leader also computes its own
aggregate share <code>agg_share</code> by aggregating all of the prepared output shares
that fall within the batch interval. Finally, it encrypts it under the
collector's HPKE public key as described in <a href="#aggregate-share-encrypt" class="auto internal xref">Section 4.5.4</a>.<a href="#section-4.5.2-17" class="pilcrow">¶</a></p>
</section>
</div>
<div id="collect-finalization">
<section id="section-4.5.3">
          <h4 id="name-collection-job-finalization">
<a href="#section-4.5.3" class="section-number selfRef">4.5.3. </a><a href="#name-collection-job-finalization" class="section-name selfRef">Collection Job Finalization</a>
          </h4>
<p id="section-4.5.3-1">Once the Collector has received a collection job from the leader, it can decrypt
the aggregate shares and produce an aggregate result. The Collector decrypts
each aggregate share as described in <a href="#aggregate-share-encrypt" class="auto internal xref">Section 4.5.4</a>. Once the
Collector successfully decrypts all aggregate shares, it unshards the aggregate
shares into an aggregate result using the VDAF's <code>agg_shares_to_result</code>
algorithm. In particular, let <code>agg_shares</code> denote the ordered sequence of
aggregator shares, ordered by aggregator index, let <code>report_count</code> denote the
report count sent by the Leader, and let <code>agg_param</code> be the opaque aggregation
parameter. The final aggregate result is computed as follows:<a href="#section-4.5.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.5.3-2">
<pre>
agg_result = VDAF.agg_shares_to_result(agg_param,
                                       agg_shares,
                                       report_count)
</pre><a href="#section-4.5.3-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="aggregate-share-encrypt">
<section id="section-4.5.4">
          <h4 id="name-aggregate-share-encryption">
<a href="#section-4.5.4" class="section-number selfRef">4.5.4. </a><a href="#name-aggregate-share-encryption" class="section-name selfRef">Aggregate Share Encryption</a>
          </h4>
<p id="section-4.5.4-1">Encrypting an aggregate share <code>agg_share</code> for a given <code>AggregateShareReq</code> is
done as follows:<a href="#section-4.5.4-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.5.4-2">
<pre>
enc, payload = SealBase(pk, "dap-04 aggregate share" || server_role || 0x00,
  agg_share_aad, agg_share)
</pre><a href="#section-4.5.4-2" class="pilcrow">¶</a>
</div>
<p id="section-4.5.4-3">where <code>pk</code> is the HPKE public key encoded by the collector's HPKE key,
<code>server_role</code> is <code>0x02</code> for the Leader and <code>0x03</code> for a Helper, and
<code>agg_share_aad</code> is a value of type <code>AggregateShareAad</code> with its values set from
the corresponding fields of the <code>AggregateShareReq</code>. The <code>SealBase()</code> function
is as specified in <span>[<a href="#HPKE" class="cite xref">HPKE</a>], <a href="https://rfc-editor.org/rfc/rfc9180#section-6.1" class="relref">Section 6.1</a></span> for the ciphersuite indicated by the
HPKE configuration.<a href="#section-4.5.4-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.5.4-4">
<pre>
struct {
  TaskID task_id;
  BatchSelector batch_selector;
} AggregateShareAad;
</pre><a href="#section-4.5.4-4" class="pilcrow">¶</a>
</div>
<p id="section-4.5.4-5">The Collector decrypts these aggregate shares using the opposite process.
Specifically, given an encrypted input share, denoted <code>enc_share</code>, for a given
batch selector, decryption works as follows:<a href="#section-4.5.4-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.5.4-6">
<pre>
agg_share = OpenBase(enc_share.enc, sk, "dap-04 aggregate share" ||
  server_role || 0x00, agg_share_aad, enc_share.payload)
</pre><a href="#section-4.5.4-6" class="pilcrow">¶</a>
</div>
<p id="section-4.5.4-7">where <code>sk</code> is the HPKE secret key, <code>server_role</code> is the role of the server that
sent the aggregate share (<code>0x02</code> for the leader and <code>0x03</code> for the helper), and
<code>agg_share_aad</code> is an <code>AggregateShareAad</code> message constructed from the task ID
in the collect request and a batch selector. The value of the batch selector
used in <code>agg_share_aad</code> is computed by the Collector from its query and the
response to its query as follows:<a href="#section-4.5.4-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.4-8.1">For time_interval tasks, the batch selector is the batch interval specified in
the query.<a href="#section-4.5.4-8.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.4-8.2">For fixed_size tasks, the batch selector is the batch ID assigned sent in the
response.<a href="#section-4.5.4-8.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.5.4-9">The <code>OpenBase()</code> function is as specified in <span>[<a href="#HPKE" class="cite xref">HPKE</a>], <a href="https://rfc-editor.org/rfc/rfc9180#section-6.1" class="relref">Section 6.1</a></span> for the
ciphersuite indicated by the HPKE configuration.<a href="#section-4.5.4-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="collect-message-security">
<section id="section-4.5.5">
          <h4 id="name-collect-message-security">
<a href="#section-4.5.5" class="section-number selfRef">4.5.5. </a><a href="#name-collect-message-security" class="section-name selfRef">Collect Message Security</a>
          </h4>
<p id="section-4.5.5-1">Collect sub-protocol messages must be confidential and mutually authenticated.<a href="#section-4.5.5-1" class="pilcrow">¶</a></p>
<p id="section-4.5.5-2">HTTPS provides confidentiality and authenticates the Leader to the Collector.
Additionally, the Leader encrypts its aggregate share to a public key held by
the Collector using <span>[<a href="#HPKE" class="cite xref">HPKE</a>]</span>.<a href="#section-4.5.5-2" class="pilcrow">¶</a></p>
<p id="section-4.5.5-3">Collectors <span class="bcp14">MUST</span> authenticate their requests to Leaders using a scheme that meets
the requirements in <a href="#request-authentication" class="auto internal xref">Section 3.1</a>.<a href="#section-4.5.5-3" class="pilcrow">¶</a></p>
<p id="section-4.5.5-4">[[OPEN ISSUE: collector public key is currently in the task parameters, but this
will have to change #102]]<a href="#section-4.5.5-4" class="pilcrow">¶</a></p>
<p id="section-4.5.5-5">The collector and helper never directly communicate with each other, but the
helper does transmit an aggregate share to the collector through the leader, as
detailed in <a href="#collect-aggregate" class="auto internal xref">Section 4.5.2</a>. The aggregate share must be confidential from
everyone but the helper and the collector.<a href="#section-4.5.5-5" class="pilcrow">¶</a></p>
<p id="section-4.5.5-6">Confidentiality is achieved by having the helper encrypt its aggregate share to
a public key held by the collector using <span>[<a href="#HPKE" class="cite xref">HPKE</a>]</span>.<a href="#section-4.5.5-6" class="pilcrow">¶</a></p>
<p id="section-4.5.5-7">There is no authentication between the collector and the helper. This allows the
leader to:<a href="#section-4.5.5-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.5-8.1">Send collect parameters to the helper that do not reflect the parameters
chosen by the collector<a href="#section-4.5.5-8.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.5.5-8.2">Discard the aggregate share computed by the helper and then fabricate
aggregate shares that combine into an arbitrary aggregate result<a href="#section-4.5.5-8.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.5.5-9">These are attacks on robustness, which we already assume to hold only if both
aggregators are honest, which puts these malicious-leader attacks out of scope
(see <a href="#sec-considerations" class="auto internal xref">Section 7</a>).<a href="#section-4.5.5-9" class="pilcrow">¶</a></p>
<p id="section-4.5.5-10">[[OPEN ISSUE: Should we have authentication in either direction between the
helper and the collector? #155]]<a href="#section-4.5.5-10" class="pilcrow">¶</a></p>
</section>
</div>
<div id="batch-validation">
<section id="section-4.5.6">
          <h4 id="name-batch-validation">
<a href="#section-4.5.6" class="section-number selfRef">4.5.6. </a><a href="#name-batch-validation" class="section-name selfRef">Batch Validation</a>
          </h4>
<p id="section-4.5.6-1">Before an Aggregator responds to a CollectionReq or AggregateShareReq, it must
first check that the request does not violate the parameters associated with the
DAP task. It does so as described here.<a href="#section-4.5.6-1" class="pilcrow">¶</a></p>
<p id="section-4.5.6-2">First the Aggregator checks that the batch respects any "boundaries" determined
by the query type. These are described in the subsections below. If the boundary
check fails, then the Aggregator <span class="bcp14">MUST</span> abort with an error of type
"batchInvalid".<a href="#section-4.5.6-2" class="pilcrow">¶</a></p>
<p id="section-4.5.6-3">Next, the Aggregator checks that batch contains a valid number of reports, as
determined by the query type. If the size check fails, then the Aggregator <span class="bcp14">MUST</span>
abort with error of type "invalidBatchSize".<a href="#section-4.5.6-3" class="pilcrow">¶</a></p>
<p id="section-4.5.6-4">Next, the Aggregator checks that the batch has not been aggregated too many
times. This is determined by the maximum number of times a batch can be queried,
<code>max_batch_query_count</code>. Unless the query has been issued less than
<code>max_batch_query_count</code> times, the Aggregator <span class="bcp14">MUST</span> abort with error of type
"batchQueriedTooManyTimes".<a href="#section-4.5.6-4" class="pilcrow">¶</a></p>
<p id="section-4.5.6-5">Finally, the Aggregator checks that the batch does not contain a report that was
included in any previous batch. If this batch overlap check fails, then the
Aggregator <span class="bcp14">MUST</span> abort with error of type "batchOverlap". For time_interval
tasks, it is sufficient (but not necessary) to check that the batch interval
does not overlap with the batch interval of any previous query. If this batch
interval check fails, then the Aggregator <span class="bcp14">MAY</span> abort with error of type
"batchOverlap".<a href="#section-4.5.6-5" class="pilcrow">¶</a></p>
<p id="section-4.5.6-6">[[OPEN ISSUE: #195 tracks how we might relax this constraint to allow for more
collect query flexibility. As of now, this is quite rigid and doesn't give the
collector much room for mistakes.]]<a href="#section-4.5.6-6" class="pilcrow">¶</a></p>
<div id="time-interval-batch-validation">
<section id="section-4.5.6.1">
            <h5 id="name-time-interval-queries-2">
<a href="#section-4.5.6.1" class="section-number selfRef">4.5.6.1. </a><a href="#name-time-interval-queries-2" class="section-name selfRef">Time-interval Queries</a>
            </h5>
<div id="boundary-check">
<section id="section-4.5.6.1.1">
              <h6 id="name-boundary-check">
<a href="#section-4.5.6.1.1" class="section-number selfRef">4.5.6.1.1. </a><a href="#name-boundary-check" class="section-name selfRef">Boundary Check</a>
              </h6>
<p id="section-4.5.6.1.1-1">The batch boundaries are determined by the <code>time_precision</code> field of the query
configuration. For the <code>batch_interval</code> included with the query, the Aggregator
checks that:<a href="#section-4.5.6.1.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.6.1.1-2.1">
                  <code>batch_interval.duration &gt;= time_precision</code> (this field determines,
effectively, the minimum batch duration)<a href="#section-4.5.6.1.1-2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4.5.6.1.1-2.2">both <code>batch_interval.start</code> and <code>batch_interval.duration</code> are divisible by
<code>time_precision</code><a href="#section-4.5.6.1.1-2.2" class="pilcrow">¶</a>
</li>
              </ul>
<p id="section-4.5.6.1.1-3">These measures ensure that Aggregators can efficiently "pre-aggregate" output
shares recovered during the aggregation sub-protocol.<a href="#section-4.5.6.1.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="size-check">
<section id="section-4.5.6.1.2">
              <h6 id="name-size-check">
<a href="#section-4.5.6.1.2" class="section-number selfRef">4.5.6.1.2. </a><a href="#name-size-check" class="section-name selfRef">Size Check</a>
              </h6>
<p id="section-4.5.6.1.2-1">The query configuration specifies the minimum batch size, <code>min_batch_size</code>. The
Aggregator checks that <code>len(X) &gt;= min_batch_size</code>, where <code>X</code> is the set of
reports in the batch.<a href="#section-4.5.6.1.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="fixed-size-batch-validation">
<section id="section-4.5.6.2">
            <h5 id="name-fixed-size-queries-2">
<a href="#section-4.5.6.2" class="section-number selfRef">4.5.6.2. </a><a href="#name-fixed-size-queries-2" class="section-name selfRef">Fixed-size Queries</a>
            </h5>
<div id="boundary-check-1">
<section id="section-4.5.6.2.1">
              <h6 id="name-boundary-check-2">
<a href="#section-4.5.6.2.1" class="section-number selfRef">4.5.6.2.1. </a><a href="#name-boundary-check-2" class="section-name selfRef">Boundary Check</a>
              </h6>
<p id="section-4.5.6.2.1-1">For fixed_size tasks, the batch boundaries are defined by opaque batch IDs. Thus
the Aggregator needs to check that the query is associated with a known batch
ID:<a href="#section-4.5.6.2.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5.6.2.1-2.1">For a CollectionReq containing a query of type <code>by_batch_id</code>, the Leader
checks that the provided batch ID corresponds to a batch ID it returned in a
previous Collection for the task.<a href="#section-4.5.6.2.1-2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4.5.6.2.1-2.2">For an AggregateShareReq, the Helper checks that the batch ID provided by the
Leader corresponds to a batch ID used in a previous <code>AggregationJobInitReq</code>
for the task.<a href="#section-4.5.6.2.1-2.2" class="pilcrow">¶</a>
</li>
              </ul>
</section>
</div>
<div id="size-check-1">
<section id="section-4.5.6.2.2">
              <h6 id="name-size-check-2">
<a href="#section-4.5.6.2.2" class="section-number selfRef">4.5.6.2.2. </a><a href="#name-size-check-2" class="section-name selfRef">Size Check</a>
              </h6>
<p id="section-4.5.6.2.2-1">The query configuration specifies the minimum batch size, <code>min_batch_size</code>, and
maximum batch size, <code>max_batch_size</code>. The Aggregator checks that <code>len(X) &gt;=
min_batch_size</code> and <code>len(X) &lt;= max_batch_size</code>, where <code>X</code> is the set of reports
in the batch.<a href="#section-4.5.6.2.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="operational-capabilities">
<section id="section-5">
      <h2 id="name-operational-considerations">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-operational-considerations" class="section-name selfRef">Operational Considerations</a>
      </h2>
<p id="section-5-1">The DAP protocol has inherent constraints derived from the tradeoff between
privacy guarantees and computational complexity. These tradeoffs influence how
applications may choose to utilize services implementing the specification.<a href="#section-5-1" class="pilcrow">¶</a></p>
<div id="entity-capabilities">
<section id="section-5.1">
        <h3 id="name-protocol-participant-capabi">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-protocol-participant-capabi" class="section-name selfRef">Protocol participant capabilities</a>
        </h3>
<p id="section-5.1-1">The design in this document has different assumptions and requirements for
different protocol participants, including clients, aggregators, and collectors.
This section describes these capabilities in more detail.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<div id="client-capabilities">
<section id="section-5.1.1">
          <h4 id="name-client-capabilities">
<a href="#section-5.1.1" class="section-number selfRef">5.1.1. </a><a href="#name-client-capabilities" class="section-name selfRef">Client capabilities</a>
          </h4>
<p id="section-5.1.1-1">Clients have limited capabilities and requirements. Their only inputs to the
protocol are (1) the parameters configured out of band and (2) a measurement.
Clients are not expected to store any state across any upload flows, nor are
they required to implement any sort of report upload retry mechanism. By design,
the protocol in this document is robust against individual client upload
failures since the protocol output is an aggregate over all inputs.<a href="#section-5.1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="aggregator-capabilities">
<section id="section-5.1.2">
          <h4 id="name-aggregator-capabilities">
<a href="#section-5.1.2" class="section-number selfRef">5.1.2. </a><a href="#name-aggregator-capabilities" class="section-name selfRef">Aggregator capabilities</a>
          </h4>
<p id="section-5.1.2-1">Helpers and leaders have different operational requirements. The design in this
document assumes an operationally competent leader, i.e., one that has no
storage or computation limitations or constraints, but only a modestly
provisioned helper, i.e., one that has computation, bandwidth, and storage
constraints. By design, leaders must be at least as capable as helpers, where
helpers are generally required to:<a href="#section-5.1.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1.2-2.1">Support the aggregate sub-protocol, which includes validating and aggregating
reports; and<a href="#section-5.1.2-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.1.2-2.2">Publish and manage an HPKE configuration that can be used for the upload
protocol.<a href="#section-5.1.2-2.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-5.1.2-3">In addition, for each DAP task, helpers are required to:<a href="#section-5.1.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1.2-4.1">Implement some form of batch-to-report index, as well as inter- and
intra-batch replay mitigation storage, which includes some way of tracking
batch report size. Some of this state may be used for replay attack
mitigation. The replay mitigation strategy is described in
<a href="#input-share-validation" class="auto internal xref">Section 4.4.1.4</a>.<a href="#section-5.1.2-4.1" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-5.1.2-5">Beyond the minimal capabilities required of helpers, leaders are generally
required to:<a href="#section-5.1.2-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1.2-6.1">Support the upload protocol and store reports; and<a href="#section-5.1.2-6.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.1.2-6.2">Track batch report size during each collect flow and request encrypted output
shares from helpers.<a href="#section-5.1.2-6.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-5.1.2-7">In addition, for each DAP task, leaders are required to:<a href="#section-5.1.2-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1.2-8.1">Implement and store state for the form of inter- and intra-batch replay
mitigation in <a href="#input-share-validation" class="auto internal xref">Section 4.4.1.4</a>.<a href="#section-5.1.2-8.1" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="collector-capabilities">
<section id="section-5.1.3">
          <h4 id="name-collector-capabilities">
<a href="#section-5.1.3" class="section-number selfRef">5.1.3. </a><a href="#name-collector-capabilities" class="section-name selfRef">Collector capabilities</a>
          </h4>
<p id="section-5.1.3-1">Collectors statefully interact with aggregators to produce an aggregate output.
Their input to the protocol is the task parameters, configured out of band,
which include the corresponding batch window and size. For each collect
invocation, collectors are required to keep state from the start of the protocol
to the end as needed to produce the final aggregate output.<a href="#section-5.1.3-1" class="pilcrow">¶</a></p>
<p id="section-5.1.3-2">Collectors must also maintain state for the lifetime of each task, which
includes key material associated with the HPKE key configuration.<a href="#section-5.1.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="data-resolution-limitations">
<section id="section-5.2">
        <h3 id="name-data-resolution-limitations">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-data-resolution-limitations" class="section-name selfRef">Data resolution limitations</a>
        </h3>
<p id="section-5.2-1">Privacy comes at the cost of computational complexity. While affine-aggregatable
encodings (AFEs) can compute many useful statistics, they require more bandwidth
and CPU cycles to account for finite-field arithmetic during input-validation.
The increased work from verifying inputs decreases the throughput of the system
or the inputs processed per unit time. Throughput is related to the verification
circuit's complexity and the available compute-time to each aggregator.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">Applications that utilize proofs with a large number of multiplication gates or
a high frequency of inputs may need to limit inputs into the system to meet
bandwidth or compute constraints. Some methods of overcoming these limitations
include choosing a better representation for the data or introducing sampling
into the data collection methodology.<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<p id="section-5.2-3">[[TODO: Discuss explicit key performance indicators, here or elsewhere.]]<a href="#section-5.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="aggregation-utility-and-soft-batch-deadlines">
<section id="section-5.3">
        <h3 id="name-aggregation-utility-and-sof">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-aggregation-utility-and-sof" class="section-name selfRef">Aggregation utility and soft batch deadlines</a>
        </h3>
<p id="section-5.3-1">A soft real-time system should produce a response within a deadline to be
useful. This constraint may be relevant when the value of an aggregate decreases
over time. A missed deadline can reduce an aggregate's utility but not
necessarily cause failure in the system.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3-2">An example of a soft real-time constraint is the expectation that input data can
be verified and aggregated in a period equal to data collection, given some
computational budget. Meeting these deadlines will require efficient
implementations of the input-validation protocol. Applications might batch
requests or utilize more efficient serialization to improve throughput.<a href="#section-5.3-2" class="pilcrow">¶</a></p>
<p id="section-5.3-3">Some applications may be constrained by the time that it takes to reach a
privacy threshold defined by a minimum number of reports. One possible solution
is to increase the reporting period so more samples can be collected, balanced
against the urgency of responding to a soft deadline.<a href="#section-5.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="protocol-specific-optimizations">
<section id="section-5.4">
        <h3 id="name-protocol-specific-optimizat">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-protocol-specific-optimizat" class="section-name selfRef">Protocol-specific optimizations</a>
        </h3>
<p id="section-5.4-1">Not all DAP tasks have the same operational requirements, so the protocol is
designed to allow implementations to reduce operational costs in certain cases.<a href="#section-5.4-1" class="pilcrow">¶</a></p>
<div id="reducing-storage-requirements">
<section id="section-5.4.1">
          <h4 id="name-reducing-storage-requiremen">
<a href="#section-5.4.1" class="section-number selfRef">5.4.1. </a><a href="#name-reducing-storage-requiremen" class="section-name selfRef">Reducing storage requirements</a>
          </h4>
<p id="section-5.4.1-1">In general, the aggregators are required to keep state for tasks and all valid
reports for as long as collect requests can be made for them. In particular,
aggregators must store a batch as long as the batch has not been queried more
than <code>max_batch_query_count</code> times. However, it is not always necessary to store
the reports themselves. For schemes like Prio3 <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span> in which reports are
verified only once, each aggregator only needs to store its aggregate share for
each possible batch interval, along with the number of times the aggregate share
was used in a batch. This is due to the requirement that the batch interval
respect the boundaries defined by the DAP parameters. (See
<a href="#batch-validation" class="auto internal xref">Section 4.5.6</a>.)<a href="#section-5.4.1-1" class="pilcrow">¶</a></p>
<p id="section-5.4.1-2">However, Aggregators are also required to implement several per-report checks
that require retaining a number of data artifacts. For example, to detect replay
attacks, it is necessary for each Aggregator to retain the set of report IDs of
reports that have been aggregated for the task so far. Depending on the task
lifetime and report upload rate, this can result in high storage costs. To
alleviate this burden, DAP allows Aggregators to drop this state as needed, so
long as reports are dropped properly as described in <a href="#input-share-validation" class="auto internal xref">Section 4.4.1.4</a>.
Aggregators <span class="bcp14">SHOULD</span> take steps to mitigate the risk of dropping reports (e.g., by
evicting the oldest data first).<a href="#section-5.4.1-2" class="pilcrow">¶</a></p>
<p id="section-5.4.1-3">Furthermore, the aggregators must store data related to a task as long as the
current time has not passed this task's <code>task_expiration</code>. Aggregator <span class="bcp14">MAY</span> delete
the task and all data pertaining to this task after <code>task_expiration</code>.
Implementors <span class="bcp14">SHOULD</span> provide for some leeway so the collector can collect the
batch after some delay.<a href="#section-5.4.1-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="compliance">
<section id="section-6">
      <h2 id="name-compliance-requirements">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-compliance-requirements" class="section-name selfRef">Compliance Requirements</a>
      </h2>
<p id="section-6-1">In the absence of an application or deployment-specific profile specifying
otherwise, a compliant DAP application <span class="bcp14">MUST</span> implement the following HPKE cipher
suite:<a href="#section-6-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6-2.1">KEM: DHKEM(X25519, HKDF-SHA256) (see <span>[<a href="#HPKE" class="cite xref">HPKE</a>], <a href="https://rfc-editor.org/rfc/rfc9180#section-7.1" class="relref">Section 7.1</a></span>)<a href="#section-6-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-6-2.2">KDF: HKDF-SHA256 (see <span>[<a href="#HPKE" class="cite xref">HPKE</a>], <a href="https://rfc-editor.org/rfc/rfc9180#section-7.2" class="relref">Section 7.2</a></span>)<a href="#section-6-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-6-2.3">AEAD: AES-128-GCM (see <span>[<a href="#HPKE" class="cite xref">HPKE</a>], <a href="https://rfc-editor.org/rfc/rfc9180#section-7.3" class="relref">Section 7.3</a></span>)<a href="#section-6-2.3" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<div id="sec-considerations">
<section id="section-7">
      <h2 id="name-security-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-7-1">DAP assumes an active attacker that controls the network and has the ability to
statically corrupt any number of clients, aggregators, and collectors. That is,
the attacker can learn the secret state of any party prior to the start of its
attack. For example, it may coerce a client into providing malicious input
shares for aggregation or coerce an aggregator into diverting from the protocol
specified (e.g., by divulging its input shares to the attacker).<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">In the presence of this adversary, DAP aims to achieve the privacy and
robustness security goals described in <span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span>'s Security Considerations
section.<a href="#section-7-2" class="pilcrow">¶</a></p>
<p id="section-7-3">Currently, the specification does not achieve these goals. In particular, there
are several open issues that need to be addressed before these goals are met.
Details for each issue are below.<a href="#section-7-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7-4">
<li id="section-7-4.1">When crafted maliciously, collect requests may leak more information about
the measurements than the system intends. For example, the spec currently
allows sequences of collect requests to reveal an aggregate result for a
batch smaller than the minimum batch size. [OPEN ISSUE: See issue#195. This
also has implications for how we solve issue#183.]<a href="#section-7-4.1" class="pilcrow">¶</a>
</li>
        <li id="section-7-4.2">Even benign collect requests may leak information beyond what one might
expect intuitively. For example, the Poplar1 VDAF
<span>[<a href="#VDAF" class="cite xref">VDAF</a>]</span> can be used to compute the set of heavy hitters among a set of
arbitrary bit strings uploaded by clients. This requires multiple evaluations
of the VDAF, the results of which reveal information to the aggregators and
collector beyond what follows from the heavy hitters themselves. Note that
this leakage can be mitigated using differential privacy.
[OPEN ISSUE: We have yet not specified how to add DP.]<a href="#section-7-4.2" class="pilcrow">¶</a>
</li>
        <li id="section-7-4.3">The core DAP spec does not defend against Sybil attacks. In this type of
attack, the adversary adds to a batch a number of reports that skew the
aggregate result in its favor. For example: The result may reveal additional
information about the honest measurements, leading to a privacy violation; or
the result may have some property that is desirable to the adversary ("stats
poisoning"). The upload sub-protocol includes an extensions mechanism that
can be used to prevent --- or at least mitigate --- these types of attacks.
See <a href="#upload-extensions" class="auto internal xref">Section 4.3.3</a>. [OPEN ISSUE: No such extension has been
implemented, so we're not yet sure if the current mechanism is sufficient.]<a href="#section-7-4.3" class="pilcrow">¶</a>
</li>
      </ol>
<div id="threat-model">
<section id="section-7.1">
        <h3 id="name-threat-model">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-threat-model" class="section-name selfRef">Threat model</a>
        </h3>
<p id="section-7.1-1">[OPEN ISSUE: This subsection is a bit out-of-date.]<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1-2">In this section, we enumerate the actors participating in the Prio system and
enumerate their assets (secrets that are either inherently valuable or which
confer some capability that enables further attack on the system), the
capabilities that a malicious or compromised actor has, and potential
mitigations for attacks enabled by those capabilities.<a href="#section-7.1-2" class="pilcrow">¶</a></p>
<p id="section-7.1-3">This model assumes that all participants have previously agreed upon and
exchanged all shared parameters over some unspecified secure channel.<a href="#section-7.1-3" class="pilcrow">¶</a></p>
<div id="clientuser">
<section id="section-7.1.1">
          <h4 id="name-client-user">
<a href="#section-7.1.1" class="section-number selfRef">7.1.1. </a><a href="#name-client-user" class="section-name selfRef">Client/user</a>
          </h4>
<div id="assets">
<section id="section-7.1.1.1">
            <h5 id="name-assets">
<a href="#section-7.1.1.1" class="section-number selfRef">7.1.1.1. </a><a href="#name-assets" class="section-name selfRef">Assets</a>
            </h5>
<ol start="1" type="1" class="normal type-1" id="section-7.1.1.1-1">
<li id="section-7.1.1.1-1.1">Unshared inputs. Clients are the only actor that can ever see the original
inputs.<a href="#section-7.1.1.1-1.1" class="pilcrow">¶</a>
</li>
              <li id="section-7.1.1.1-1.2">Unencrypted input shares.<a href="#section-7.1.1.1-1.2" class="pilcrow">¶</a>
</li>
            </ol>
</section>
</div>
<div id="capabilities">
<section id="section-7.1.1.2">
            <h5 id="name-capabilities">
<a href="#section-7.1.1.2" class="section-number selfRef">7.1.1.2. </a><a href="#name-capabilities" class="section-name selfRef">Capabilities</a>
            </h5>
<ol start="1" type="1" class="normal type-1" id="section-7.1.1.2-1">
<li id="section-7.1.1.2-1.1">Individual users can reveal their own input and compromise their own privacy.<a href="#section-7.1.1.2-1.1" class="pilcrow">¶</a>
</li>
              <li id="section-7.1.1.2-1.2">Clients (that is, software which might be used by many users of the system)
can defeat privacy by leaking input outside of the Prio system.<a href="#section-7.1.1.2-1.2" class="pilcrow">¶</a>
</li>
              <li id="section-7.1.1.2-1.3">
                <p id="section-7.1.1.2-1.3.1">Clients may affect the quality of aggregations by reporting false input.<a href="#section-7.1.1.2-1.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1.1.2-1.3.2.1">Prio can only prove that submitted input is valid, not that it is true.
False input can be mitigated orthogonally to the Prio protocol (e.g., by
requiring that aggregations include a minimum number of contributions)
and so these attacks are considered to be outside of the threat model.<a href="#section-7.1.1.2-1.3.2.1" class="pilcrow">¶</a>
</li>
                </ul>
</li>
              <li id="section-7.1.1.2-1.4">Clients can send invalid encodings of input.<a href="#section-7.1.1.2-1.4" class="pilcrow">¶</a>
</li>
            </ol>
</section>
</div>
<div id="mitigations">
<section id="section-7.1.1.3">
            <h5 id="name-mitigations">
<a href="#section-7.1.1.3" class="section-number selfRef">7.1.1.3. </a><a href="#name-mitigations" class="section-name selfRef">Mitigations</a>
            </h5>
<ol start="1" type="1" class="normal type-1" id="section-7.1.1.3-1">
<li id="section-7.1.1.3-1.1">The input validation protocol executed by the aggregators prevents either
individual clients or a coalition of clients from compromising the robustness
property.<a href="#section-7.1.1.3-1.1" class="pilcrow">¶</a>
</li>
              <li id="section-7.1.1.3-1.2">If aggregator output satisfies differential privacy <a href="#dp" class="auto internal xref">Section 7.5</a>, then all records
not leaked by malicious clients are still protected.<a href="#section-7.1.1.3-1.2" class="pilcrow">¶</a>
</li>
            </ol>
</section>
</div>
</section>
</div>
<div id="aggregator">
<section id="section-7.1.2">
          <h4 id="name-aggregator">
<a href="#section-7.1.2" class="section-number selfRef">7.1.2. </a><a href="#name-aggregator" class="section-name selfRef">Aggregator</a>
          </h4>
<div id="assets-1">
<section id="section-7.1.2.1">
            <h5 id="name-assets-2">
<a href="#section-7.1.2.1" class="section-number selfRef">7.1.2.1. </a><a href="#name-assets-2" class="section-name selfRef">Assets</a>
            </h5>
<ol start="1" type="1" class="normal type-1" id="section-7.1.2.1-1">
<li id="section-7.1.2.1-1.1">Unencrypted input shares.<a href="#section-7.1.2.1-1.1" class="pilcrow">¶</a>
</li>
              <li id="section-7.1.2.1-1.2">Input share decryption keys.<a href="#section-7.1.2.1-1.2" class="pilcrow">¶</a>
</li>
              <li id="section-7.1.2.1-1.3">Client identifying information.<a href="#section-7.1.2.1-1.3" class="pilcrow">¶</a>
</li>
              <li id="section-7.1.2.1-1.4">Aggregate shares.<a href="#section-7.1.2.1-1.4" class="pilcrow">¶</a>
</li>
              <li id="section-7.1.2.1-1.5">Aggregator identity.<a href="#section-7.1.2.1-1.5" class="pilcrow">¶</a>
</li>
            </ol>
</section>
</div>
<div id="capabilities-1">
<section id="section-7.1.2.2">
            <h5 id="name-capabilities-2">
<a href="#section-7.1.2.2" class="section-number selfRef">7.1.2.2. </a><a href="#name-capabilities-2" class="section-name selfRef">Capabilities</a>
            </h5>
<ol start="1" type="1" class="normal type-1" id="section-7.1.2.2-1">
<li id="section-7.1.2.2-1.1">Aggregators may defeat the robustness of the system by emitting bogus output
shares.<a href="#section-7.1.2.2-1.1" class="pilcrow">¶</a>
</li>
              <li id="section-7.1.2.2-1.2">
                <p id="section-7.1.2.2-1.2.1">If clients reveal identifying information to aggregators (such as a trusted
identity during client authentication), aggregators can learn which clients
are contributing input.<a href="#section-7.1.2.2-1.2.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.1.2.2-1.2.2">
<li id="section-7.1.2.2-1.2.2.1">Aggregators may reveal that a particular client contributed input.<a href="#section-7.1.2.2-1.2.2.1" class="pilcrow">¶</a>
</li>
                  <li id="section-7.1.2.2-1.2.2.2">
                    <p id="section-7.1.2.2-1.2.2.2.1">Aggregators may attack robustness by selectively omitting inputs from
certain clients.<a href="#section-7.1.2.2-1.2.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1.2.2-1.2.2.2.2.1">For example, omitting submissions from a particular geographic
region to falsely suggest that a particular localization is not
being used.<a href="#section-7.1.2.2-1.2.2.2.2.1" class="pilcrow">¶</a>
</li>
                    </ul>
</li>
                </ol>
</li>
              <li id="section-7.1.2.2-1.3">Individual aggregators may compromise availability of the system by refusing
to emit aggregate shares.<a href="#section-7.1.2.2-1.3" class="pilcrow">¶</a>
</li>
              <li id="section-7.1.2.2-1.4">Input validity proof forging. Any aggregator can collude with a malicious
client to craft a proof that will fool honest aggregators into accepting
invalid input.<a href="#section-7.1.2.2-1.4" class="pilcrow">¶</a>
</li>
              <li id="section-7.1.2.2-1.5">Aggregators can count the total number of input shares, which could
compromise user privacy (and differential privacy <a href="#dp" class="auto internal xref">Section 7.5</a>) if the presence or
absence of a share for a given user is sensitive.<a href="#section-7.1.2.2-1.5" class="pilcrow">¶</a>
</li>
            </ol>
</section>
</div>
<div id="mitigations-1">
<section id="section-7.1.2.3">
            <h5 id="name-mitigations-2">
<a href="#section-7.1.2.3" class="section-number selfRef">7.1.2.3. </a><a href="#name-mitigations-2" class="section-name selfRef">Mitigations</a>
            </h5>
<ol start="1" type="1" class="normal type-1" id="section-7.1.2.3-1">
<li id="section-7.1.2.3-1.1">The linear secret sharing scheme employed by the client ensures that privacy
is preserved as long as at least one aggregator does not reveal its input
shares.<a href="#section-7.1.2.3-1.1" class="pilcrow">¶</a>
</li>
              <li id="section-7.1.2.3-1.2">If computed over a sufficient number of reports, aggregate shares reveal
nothing about either the inputs or the participating clients.<a href="#section-7.1.2.3-1.2" class="pilcrow">¶</a>
</li>
              <li id="section-7.1.2.3-1.3">Clients can ensure that aggregate counts are non-sensitive by generating
input independently of user behavior. For example, a client should
periodically upload a report even if the event that the task is tracking has
not occurred, so that the absence of reports cannot be distinguished from
their presence.<a href="#section-7.1.2.3-1.3" class="pilcrow">¶</a>
</li>
              <li id="section-7.1.2.3-1.4">
                <p id="section-7.1.2.3-1.4.1">Bogus inputs can be generated that encode "null" shares that do not affect
the aggregate output, but mask the total number of true inputs.<a href="#section-7.1.2.3-1.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1.2.3-1.4.2.1">Either leaders or clients can generate these inputs to mask the total
number from non-leader aggregators or all the aggregators, respectively.<a href="#section-7.1.2.3-1.4.2.1" class="pilcrow">¶</a>
</li>
                  <li class="normal" id="section-7.1.2.3-1.4.2.2">In either case, care must be taken to ensure that bogus inputs are
indistinguishable from true inputs (metadata, etc), especially when
constructing timestamps on reports.<a href="#section-7.1.2.3-1.4.2.2" class="pilcrow">¶</a>
</li>
                </ul>
</li>
            </ol>
<p id="section-7.1.2.3-2">[OPEN ISSUE: Define what "null" shares are. They should be defined such that
inserting null shares into an aggregation is effectively a no-op. See issue#98.]<a href="#section-7.1.2.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="leader">
<section id="section-7.1.3">
          <h4 id="name-leader">
<a href="#section-7.1.3" class="section-number selfRef">7.1.3. </a><a href="#name-leader" class="section-name selfRef">Leader</a>
          </h4>
<p id="section-7.1.3-1">The leader is also an aggregator, and so all the assets, capabilities and
mitigations available to aggregators also apply to the leader.<a href="#section-7.1.3-1" class="pilcrow">¶</a></p>
<div id="capabilities-2">
<section id="section-7.1.3.1">
            <h5 id="name-capabilities-3">
<a href="#section-7.1.3.1" class="section-number selfRef">7.1.3.1. </a><a href="#name-capabilities-3" class="section-name selfRef">Capabilities</a>
            </h5>
<ol start="1" type="1" class="normal type-1" id="section-7.1.3.1-1">
<li id="section-7.1.3.1-1.1">
                <p id="section-7.1.3.1-1.1.1">Input validity proof verification. The leader can forge proofs and collude
with a malicious client to trick aggregators into aggregating invalid inputs.<a href="#section-7.1.3.1-1.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1.3.1-1.1.2.1">This capability is no stronger than any aggregator's ability to forge
validity proof in collusion with a malicious client.<a href="#section-7.1.3.1-1.1.2.1" class="pilcrow">¶</a>
</li>
                </ul>
</li>
              <li id="section-7.1.3.1-1.2">
                <p id="section-7.1.3.1-1.2.1">Relaying messages between aggregators. The leader can compromise availability
by dropping messages.<a href="#section-7.1.3.1-1.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1.3.1-1.2.2.1">This capability is no stronger than any aggregator's ability to refuse to
emit aggregate shares.<a href="#section-7.1.3.1-1.2.2.1" class="pilcrow">¶</a>
</li>
                </ul>
</li>
              <li id="section-7.1.3.1-1.3">Shrinking the anonymity set. The leader instructs aggregators to construct
output parts and so could request aggregations over few inputs.<a href="#section-7.1.3.1-1.3" class="pilcrow">¶</a>
</li>
            </ol>
</section>
</div>
<div id="mitigations-2">
<section id="section-7.1.3.2">
            <h5 id="name-mitigations-3">
<a href="#section-7.1.3.2" class="section-number selfRef">7.1.3.2. </a><a href="#name-mitigations-3" class="section-name selfRef">Mitigations</a>
            </h5>
<ol start="1" type="1" class="normal type-1" id="section-7.1.3.2-1">
<li id="section-7.1.3.2-1.1">Aggregators enforce agreed upon minimum aggregation thresholds to prevent
deanonymizing.<a href="#section-7.1.3.2-1.1" class="pilcrow">¶</a>
</li>
              <li id="section-7.1.3.2-1.2">If aggregator output satisfies differential privacy <a href="#dp" class="auto internal xref">Section 7.5</a>, then genuine
records are protected regardless of the size of the anonymity set.<a href="#section-7.1.3.2-1.2" class="pilcrow">¶</a>
</li>
            </ol>
</section>
</div>
</section>
</div>
<div id="collector">
<section id="section-7.1.4">
          <h4 id="name-collector">
<a href="#section-7.1.4" class="section-number selfRef">7.1.4. </a><a href="#name-collector" class="section-name selfRef">Collector</a>
          </h4>
<div id="capabilities-3">
<section id="section-7.1.4.1">
            <h5 id="name-capabilities-4">
<a href="#section-7.1.4.1" class="section-number selfRef">7.1.4.1. </a><a href="#name-capabilities-4" class="section-name selfRef">Capabilities</a>
            </h5>
<ol start="1" type="1" class="normal type-1" id="section-7.1.4.1-1">
<li id="section-7.1.4.1-1.1">Advertising shared configuration parameters (e.g., minimum thresholds for
aggregations, joint randomness, arithmetic circuits).<a href="#section-7.1.4.1-1.1" class="pilcrow">¶</a>
</li>
              <li id="section-7.1.4.1-1.2">Collectors may trivially defeat availability by discarding aggregate shares
submitted by aggregators.<a href="#section-7.1.4.1-1.2" class="pilcrow">¶</a>
</li>
              <li id="section-7.1.4.1-1.3">Known input injection. Collectors may collude with clients to send known
input to the aggregators, allowing collectors to shrink the effective
anonymity set by subtracting the known inputs from the final output. Sybil
attacks <span>[<a href="#Dou02" class="cite xref">Dou02</a>]</span> could be used to amplify this capability.<a href="#section-7.1.4.1-1.3" class="pilcrow">¶</a>
</li>
            </ol>
</section>
</div>
<div id="mitigations-3">
<section id="section-7.1.4.2">
            <h5 id="name-mitigations-4">
<a href="#section-7.1.4.2" class="section-number selfRef">7.1.4.2. </a><a href="#name-mitigations-4" class="section-name selfRef">Mitigations</a>
            </h5>
<ol start="1" type="1" class="normal type-1" id="section-7.1.4.2-1">
<li id="section-7.1.4.2-1.1">Aggregators should refuse shared parameters that are trivially insecure
(i.e., aggregation threshold of 1 contribution).<a href="#section-7.1.4.2-1.1" class="pilcrow">¶</a>
</li>
              <li id="section-7.1.4.2-1.2">If aggregator output satisfies differential privacy <a href="#dp" class="auto internal xref">Section 7.5</a>, then genuine
records are protected regardless of the size of the anonymity set.<a href="#section-7.1.4.2-1.2" class="pilcrow">¶</a>
</li>
            </ol>
</section>
</div>
</section>
</div>
<div id="aggregator-collusion">
<section id="section-7.1.5">
          <h4 id="name-aggregator-collusion">
<a href="#section-7.1.5" class="section-number selfRef">7.1.5. </a><a href="#name-aggregator-collusion" class="section-name selfRef">Aggregator collusion</a>
          </h4>
<p id="section-7.1.5-1">If all aggregators collude (e.g. by promiscuously sharing unencrypted input
shares), then none of the properties of the system hold. Accordingly, such
scenarios are outside of the threat model.<a href="#section-7.1.5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="attacker-on-the-network">
<section id="section-7.1.6">
          <h4 id="name-attacker-on-the-network">
<a href="#section-7.1.6" class="section-number selfRef">7.1.6. </a><a href="#name-attacker-on-the-network" class="section-name selfRef">Attacker on the network</a>
          </h4>
<p id="section-7.1.6-1">We assume the existence of attackers on the network links between participants.<a href="#section-7.1.6-1" class="pilcrow">¶</a></p>
<div id="capabilities-4">
<section id="section-7.1.6.1">
            <h5 id="name-capabilities-5">
<a href="#section-7.1.6.1" class="section-number selfRef">7.1.6.1. </a><a href="#name-capabilities-5" class="section-name selfRef">Capabilities</a>
            </h5>
<ol start="1" type="1" class="normal type-1" id="section-7.1.6.1-1">
<li id="section-7.1.6.1-1.1">
                <p id="section-7.1.6.1-1.1.1">Observation of network traffic. Attackers may observe messages exchanged
between participants at the IP layer.<a href="#section-7.1.6.1-1.1.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.1.6.1-1.1.2">
<li id="section-7.1.6.1-1.1.2.1">
                    <p id="section-7.1.6.1-1.1.2.1.1">The time of transmission of input shares by clients could reveal
information about user activity.<a href="#section-7.1.6.1-1.1.2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1.6.1-1.1.2.1.2.1">For example, if a user opts into a new feature, and the client
immediately reports this to aggregators, then just by observing
network traffic, the attacker can infer what the user did.<a href="#section-7.1.6.1-1.1.2.1.2.1" class="pilcrow">¶</a>
</li>
                    </ul>
</li>
                  <li id="section-7.1.6.1-1.1.2.2">
                    <p id="section-7.1.6.1-1.1.2.2.1">Observation of message size could allow the attacker to learn how much
  input is being submitted by a client.<a href="#section-7.1.6.1-1.1.2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.1.6.1-1.1.2.2.2.1">For example, if the attacker observes an encrypted message of some
size, they can infer the size of the plaintext, plus or minus the
cipher block size. From this they may be able to infer which
aggregations the user has opted into or out of.<a href="#section-7.1.6.1-1.1.2.2.2.1" class="pilcrow">¶</a>
</li>
                    </ul>
</li>
                </ol>
</li>
              <li id="section-7.1.6.1-1.2">Tampering with network traffic. Attackers may drop messages or inject new
messages into communications between participants.<a href="#section-7.1.6.1-1.2" class="pilcrow">¶</a>
</li>
            </ol>
</section>
</div>
<div id="mitigations-4">
<section id="section-7.1.6.2">
            <h5 id="name-mitigations-5">
<a href="#section-7.1.6.2" class="section-number selfRef">7.1.6.2. </a><a href="#name-mitigations-5" class="section-name selfRef">Mitigations</a>
            </h5>
<ol start="1" type="1" class="normal type-1" id="section-7.1.6.2-1">
<li id="section-7.1.6.2-1.1">All messages exchanged between participants in the system should be
encrypted.<a href="#section-7.1.6.2-1.1" class="pilcrow">¶</a>
</li>
              <li id="section-7.1.6.2-1.2">All messages exchanged between aggregators, the collector and the leader
should be mutually authenticated so that network attackers cannot impersonate
participants.<a href="#section-7.1.6.2-1.2" class="pilcrow">¶</a>
</li>
              <li id="section-7.1.6.2-1.3">Clients should be required to submit inputs at regular intervals so that the
timing of individual messages does not reveal anything.<a href="#section-7.1.6.2-1.3" class="pilcrow">¶</a>
</li>
              <li id="section-7.1.6.2-1.4">Clients should submit dummy inputs even for aggregations the user has not
opted into.<a href="#section-7.1.6.2-1.4" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-7.1.6.2-2">[[OPEN ISSUE: The threat model for Prio --- as it's described in the original
paper and <span>[<a href="#BBCGGI19" class="cite xref">BBCGGI19</a>]</span> --- considers <strong>either</strong> a malicious client (attacking
robustness) <strong>or</strong> a malicious subset of aggregators (attacking privacy). In
particular, robustness isn't guaranteed if any one of the aggregators is
malicious; in theory it may be possible for a malicious client and aggregator to
collude and break robustness. Is this a contingency we need to address? There
are techniques in <span>[<a href="#BBCGGI19" class="cite xref">BBCGGI19</a>]</span> that account for this; we need to figure out if
they're practical.]]<a href="#section-7.1.6.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="client-authentication-or-attestation">
<section id="section-7.2">
        <h3 id="name-client-authentication-or-at">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-client-authentication-or-at" class="section-name selfRef">Client authentication or attestation</a>
        </h3>
<p id="section-7.2-1">[TODO: Solve issue#89]<a href="#section-7.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="anon-proxy">
<section id="section-7.3">
        <h3 id="name-anonymizing-proxies">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-anonymizing-proxies" class="section-name selfRef">Anonymizing proxies</a>
        </h3>
<p id="section-7.3-1">Client reports can contain auxiliary information such as source IP, HTTP user
agent or in deployments which use it, client authentication information, which
could be used by aggregators to identify participating clients or permit some
attacks on robustness. This auxiliary information could be removed by having
clients submit reports to an anonymizing proxy server which would then use
Oblivious HTTP <span>[<a href="#I-D.draft-ietf-ohai-ohttp-07" class="cite xref">I-D.draft-ietf-ohai-ohttp-07</a>]</span> to forward inputs to the
DAP leader, without requiring any server participating in DAP to be aware of
whatever client authentication or attestation scheme is in use.<a href="#section-7.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="batch-parameters">
<section id="section-7.4">
        <h3 id="name-batch-parameters">
<a href="#section-7.4" class="section-number selfRef">7.4. </a><a href="#name-batch-parameters" class="section-name selfRef">Batch parameters</a>
        </h3>
<p id="section-7.4-1">An important parameter of a DAP deployment is the minimum batch size. If an
aggregation includes too few inputs, then the outputs can reveal information
about individual participants. Aggregators use the batch size field of the
shared task parameters to enforce minimum batch size during the collect
protocol, but server implementations may also opt out of participating in a DAP
task if the minimum batch size is too small. This document does not specify how
to choose minimum batch sizes.<a href="#section-7.4-1" class="pilcrow">¶</a></p>
<p id="section-7.4-2">The DAP parameters also specify the maximum number of times a report can be
used. Some protocols, such as Poplar <span>[<a href="#BBCGGI21" class="cite xref">BBCGGI21</a>]</span>, require reports to be used in
multiple batches spanning multiple collect requests.<a href="#section-7.4-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="dp">
<section id="section-7.5">
        <h3 id="name-differential-privacy">
<a href="#section-7.5" class="section-number selfRef">7.5. </a><a href="#name-differential-privacy" class="section-name selfRef">Differential privacy</a>
        </h3>
<p id="section-7.5-1">Optionally, DAP deployments can choose to ensure their output F achieves
differential privacy <span>[<a href="#Vad16" class="cite xref">Vad16</a>]</span>. A simple approach would require the aggregators to
add two-sided noise (e.g. sampled from a two-sided geometric distribution) to
outputs. Since each aggregator is adding noise independently, privacy can be
guaranteed even if all but one of the aggregators is malicious. Differential
privacy is a strong privacy definition, and protects users in extreme
circumstances: Even if an adversary has prior knowledge of every input in a
batch except for one, that one record is still formally protected.<a href="#section-7.5-1" class="pilcrow">¶</a></p>
<p id="section-7.5-2">[OPEN ISSUE: While parameters configuring the differential privacy noise (like
specific distributions / variance) can be agreed upon out of band by the
aggregators and collector, there may be benefits to adding explicit protocol
support by encoding them into task parameters.]<a href="#section-7.5-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="robustness-in-the-presence-of-malicious-servers">
<section id="section-7.6">
        <h3 id="name-robustness-in-the-presence-">
<a href="#section-7.6" class="section-number selfRef">7.6. </a><a href="#name-robustness-in-the-presence-" class="section-name selfRef">Robustness in the presence of malicious servers</a>
        </h3>
<p id="section-7.6-1">Most DAP protocols, including Prio and Poplar, are robust against malicious
clients, but are not robust against malicious servers. Any aggregator can simply
emit bogus aggregate shares and undetectably spoil aggregates. If enough
aggregators were available, this could be mitigated by running the protocol
multiple times with distinct subsets of aggregators chosen so that no aggregator
appears in all subsets and checking all the outputs against each other. If all
the protocol runs do not agree, then participants know that at least one
aggregator is defective, and it may be possible to identify the defector (i.e.,
if a majority of runs agree, and a single aggregator appears in every run that
disagrees). See
<a href="https://github.com/ietf-wg-ppm/draft-ietf-ppm-dap/issues/22">#22</a> for
discussion.<a href="#section-7.6-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="verification-key">
<section id="section-7.7">
        <h3 id="name-verification-key-requiremen">
<a href="#section-7.7" class="section-number selfRef">7.7. </a><a href="#name-verification-key-requiremen" class="section-name selfRef">Verification key requirements</a>
        </h3>
<p id="section-7.7-1">The verification key for a task <span class="bcp14">SHOULD</span> be chosen before any reports are generated.
It <span class="bcp14">SHOULD</span> be fixed for the lifetime of the task and not be rotated. One way
to ensure this is to include the verification key in a derivation of the task ID.<a href="#section-7.7-1" class="pilcrow">¶</a></p>
<p id="section-7.7-2">This consideration comes from current security analysis for existing VDAFs. For example,
to ensure that the security proofs for Prio3 hold, the verification key <span class="bcp14">MUST</span> be
chosen independently of the generated reports. This can be achieved as
recommended above.<a href="#section-7.7-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="infrastructure-diversity">
<section id="section-7.8">
        <h3 id="name-infrastructure-diversity">
<a href="#section-7.8" class="section-number selfRef">7.8. </a><a href="#name-infrastructure-diversity" class="section-name selfRef">Infrastructure diversity</a>
        </h3>
<p id="section-7.8-1">Prio deployments should ensure that aggregators do not have common dependencies
that would enable a single vendor to reassemble inputs. For example, if all
participating aggregators stored unencrypted input shares on the same cloud
object storage service, then that cloud vendor would be able to reassemble all
the input shares and defeat privacy.<a href="#section-7.8-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="operational-requirements">
<section id="section-7.9">
        <h3 id="name-system-requirements">
<a href="#section-7.9" class="section-number selfRef">7.9. </a><a href="#name-system-requirements" class="section-name selfRef">System requirements</a>
        </h3>
<div id="data-types">
<section id="section-7.9.1">
          <h4 id="name-data-types">
<a href="#section-7.9.1" class="section-number selfRef">7.9.1. </a><a href="#name-data-types" class="section-name selfRef">Data types</a>
        </h4>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-8">
      <h2 id="name-iana-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<div id="protocol-message-media-types">
<section id="section-8.1">
        <h3 id="name-protocol-message-media-type">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-protocol-message-media-type" class="section-name selfRef">Protocol Message Media Types</a>
        </h3>
<p id="section-8.1-1">This specification defines the following protocol messages, along with their
corresponding media types types:<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.1-2.1">HpkeConfigList <a href="#hpke-config" class="auto internal xref">Section 4.3.1</a>: "application/dap-hpke-config-list"<a href="#section-8.1-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.1-2.2">Report <a href="#upload-request" class="auto internal xref">Section 4.3.2</a>: "application/dap-report"<a href="#section-8.1-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.1-2.3">AggregationJobInitReq <a href="#leader-init" class="auto internal xref">Section 4.4.1.1</a>: "application/dap-aggregation-job-init-req"<a href="#section-8.1-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.1-2.4">AggregationJobResp <a href="#aggregation-helper-init" class="auto internal xref">Section 4.4.1.2</a>: "application/dap-aggregation-job-resp"<a href="#section-8.1-2.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.1-2.5">AggregationJobContinueReq <a href="#aggregation-leader-continuation" class="auto internal xref">Section 4.4.2.1</a>: "application/dap-aggregation-job-continue-req"<a href="#section-8.1-2.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.1-2.6">AggregateShareReq <a href="#collect-flow" class="auto internal xref">Section 4.5</a>: "application/dap-aggregate-share-req"<a href="#section-8.1-2.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.1-2.7">AggregateShare <a href="#collect-flow" class="auto internal xref">Section 4.5</a>: "application/dap-aggregate-share"<a href="#section-8.1-2.7" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.1-2.8">CollectionReq <a href="#collect-flow" class="auto internal xref">Section 4.5</a>: "application/dap-collect-req"<a href="#section-8.1-2.8" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.1-2.9">Collection <a href="#collect-flow" class="auto internal xref">Section 4.5</a>: "application/dap-collection"<a href="#section-8.1-2.9" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-8.1-3">The definition for each media type is in the following subsections.<a href="#section-8.1-3" class="pilcrow">¶</a></p>
<p id="section-8.1-4">Protocol message format evolution is supported through the definition of new
formats that are identified by new media types.<a href="#section-8.1-4" class="pilcrow">¶</a></p>
<p id="section-8.1-5">IANA [shall update / has updated] the "Media Types" registry at
https://www.iana.org/assignments/media-types with the registration information
in this section for all media types listed above.<a href="#section-8.1-5" class="pilcrow">¶</a></p>
<p id="section-8.1-6">[OPEN ISSUE: Solicit review of these allocations from domain experts.]<a href="#section-8.1-6" class="pilcrow">¶</a></p>
<div id="applicationdap-hpke-config-list-media-type">
<section id="section-8.1.1">
          <h4 id="name-application-dap-hpke-config">
<a href="#section-8.1.1" class="section-number selfRef">8.1.1. </a><a href="#name-application-dap-hpke-config" class="section-name selfRef">"application/dap-hpke-config-list" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-8.1.1-1">
            <dt id="section-8.1.1-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.1-1.2">
              <p id="section-8.1.1-1.2.1">application<a href="#section-8.1.1-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.1-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.1-1.4">
              <p id="section-8.1.1-1.4.1">dap-hpke-config-list<a href="#section-8.1.1-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.1-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.1-1.6">
              <p id="section-8.1.1-1.6.1">N/A<a href="#section-8.1.1-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.1-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.1-1.8">
              <p id="section-8.1.1-1.8.1">None<a href="#section-8.1.1-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.1-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.1-1.10">
              <p id="section-8.1.1-1.10.1">only "8bit" or "binary" is permitted<a href="#section-8.1.1-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.1-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.1-1.12">
              <p id="section-8.1.1-1.12.1">see <a href="#task-configuration" class="auto internal xref">Section 4.2</a><a href="#section-8.1.1-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.1-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.1-1.14">
              <p id="section-8.1.1-1.14.1">N/A<a href="#section-8.1.1-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.1-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.1-1.16">
              <p id="section-8.1.1-1.16.1">this specification<a href="#section-8.1.1-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.1-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.1-1.18">
              <p id="section-8.1.1-1.18.1">N/A<a href="#section-8.1.1-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.1-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.1-1.20">
              <p id="section-8.1.1-1.20.1">N/A<a href="#section-8.1.1-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.1-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.1-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-8.1.1-1.22.1">
                <dt id="section-8.1.1-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.1-1.22.1.2">N/A<a href="#section-8.1.1-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.1.1-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.1-1.22.1.4">N/A<a href="#section-8.1.1-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.1.1-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.1-1.22.1.6">N/A<a href="#section-8.1.1-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.1.1-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.1-1.22.1.8">N/A<a href="#section-8.1.1-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.1-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.1-1.24">
              <p id="section-8.1.1-1.24.1">see Authors' Addresses section<a href="#section-8.1.1-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.1-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.1-1.26">
              <p id="section-8.1.1-1.26.1">COMMON<a href="#section-8.1.1-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.1-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.1-1.28">
              <p id="section-8.1.1-1.28.1">N/A<a href="#section-8.1.1-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.1-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.1-1.30">
              <p id="section-8.1.1-1.30.1">see Authors' Addresses section<a href="#section-8.1.1-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.1-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.1-1.32">
              <p id="section-8.1.1-1.32.1">IESG<a href="#section-8.1.1-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="applicationdap-report-media-type">
<section id="section-8.1.2">
          <h4 id="name-application-dap-report-medi">
<a href="#section-8.1.2" class="section-number selfRef">8.1.2. </a><a href="#name-application-dap-report-medi" class="section-name selfRef">"application/dap-report" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-8.1.2-1">
            <dt id="section-8.1.2-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.2-1.2">
              <p id="section-8.1.2-1.2.1">application<a href="#section-8.1.2-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.2-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.2-1.4">
              <p id="section-8.1.2-1.4.1">dap-report<a href="#section-8.1.2-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.2-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.2-1.6">
              <p id="section-8.1.2-1.6.1">N/A<a href="#section-8.1.2-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.2-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.2-1.8">
              <p id="section-8.1.2-1.8.1">None<a href="#section-8.1.2-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.2-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.2-1.10">
              <p id="section-8.1.2-1.10.1">only "8bit" or "binary" is permitted<a href="#section-8.1.2-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.2-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.2-1.12">
              <p id="section-8.1.2-1.12.1">see <a href="#upload-request" class="auto internal xref">Section 4.3.2</a><a href="#section-8.1.2-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.2-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.2-1.14">
              <p id="section-8.1.2-1.14.1">N/A<a href="#section-8.1.2-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.2-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.2-1.16">
              <p id="section-8.1.2-1.16.1">this specification<a href="#section-8.1.2-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.2-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.2-1.18">
              <p id="section-8.1.2-1.18.1">N/A<a href="#section-8.1.2-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.2-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.2-1.20">
              <p id="section-8.1.2-1.20.1">N/A<a href="#section-8.1.2-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.2-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.2-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-8.1.2-1.22.1">
                <dt id="section-8.1.2-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.2-1.22.1.2">N/A<a href="#section-8.1.2-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.1.2-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.2-1.22.1.4">N/A<a href="#section-8.1.2-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.1.2-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.2-1.22.1.6">N/A<a href="#section-8.1.2-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.1.2-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.2-1.22.1.8">N/A<a href="#section-8.1.2-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.2-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.2-1.24">
              <p id="section-8.1.2-1.24.1">see Authors' Addresses section<a href="#section-8.1.2-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.2-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.2-1.26">
              <p id="section-8.1.2-1.26.1">COMMON<a href="#section-8.1.2-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.2-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.2-1.28">
              <p id="section-8.1.2-1.28.1">N/A<a href="#section-8.1.2-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.2-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.2-1.30">
              <p id="section-8.1.2-1.30.1">see Authors' Addresses section<a href="#section-8.1.2-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.2-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.2-1.32">
              <p id="section-8.1.2-1.32.1">IESG<a href="#section-8.1.2-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="applicationdap-aggregation-job-init-req-media-type">
<section id="section-8.1.3">
          <h4 id="name-application-dap-aggregation">
<a href="#section-8.1.3" class="section-number selfRef">8.1.3. </a><a href="#name-application-dap-aggregation" class="section-name selfRef">"application/dap-aggregation-job-init-req" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-8.1.3-1">
            <dt id="section-8.1.3-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.3-1.2">
              <p id="section-8.1.3-1.2.1">application<a href="#section-8.1.3-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.3-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.3-1.4">
              <p id="section-8.1.3-1.4.1">dap-aggregation-job-init-req<a href="#section-8.1.3-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.3-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.3-1.6">
              <p id="section-8.1.3-1.6.1">N/A<a href="#section-8.1.3-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.3-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.3-1.8">
              <p id="section-8.1.3-1.8.1">None<a href="#section-8.1.3-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.3-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.3-1.10">
              <p id="section-8.1.3-1.10.1">only "8bit" or "binary" is permitted<a href="#section-8.1.3-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.3-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.3-1.12">
              <p id="section-8.1.3-1.12.1">see <a href="#collect-flow" class="auto internal xref">Section 4.5</a><a href="#section-8.1.3-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.3-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.3-1.14">
              <p id="section-8.1.3-1.14.1">N/A<a href="#section-8.1.3-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.3-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.3-1.16">
              <p id="section-8.1.3-1.16.1">this specification<a href="#section-8.1.3-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.3-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.3-1.18">
              <p id="section-8.1.3-1.18.1">N/A<a href="#section-8.1.3-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.3-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.3-1.20">
              <p id="section-8.1.3-1.20.1">N/A<a href="#section-8.1.3-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.3-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.3-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-8.1.3-1.22.1">
                <dt id="section-8.1.3-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.3-1.22.1.2">N/A<a href="#section-8.1.3-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.1.3-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.3-1.22.1.4">N/A<a href="#section-8.1.3-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.1.3-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.3-1.22.1.6">N/A<a href="#section-8.1.3-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.1.3-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.3-1.22.1.8">N/A<a href="#section-8.1.3-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.3-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.3-1.24">
              <p id="section-8.1.3-1.24.1">see Authors' Addresses section<a href="#section-8.1.3-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.3-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.3-1.26">
              <p id="section-8.1.3-1.26.1">COMMON<a href="#section-8.1.3-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.3-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.3-1.28">
              <p id="section-8.1.3-1.28.1">N/A<a href="#section-8.1.3-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.3-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.3-1.30">
              <p id="section-8.1.3-1.30.1">see Authors' Addresses section<a href="#section-8.1.3-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.3-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.3-1.32">
              <p id="section-8.1.3-1.32.1">IESG<a href="#section-8.1.3-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="applicationdap-aggregation-job-resp-media-type">
<section id="section-8.1.4">
          <h4 id="name-application-dap-aggregation-">
<a href="#section-8.1.4" class="section-number selfRef">8.1.4. </a><a href="#name-application-dap-aggregation-" class="section-name selfRef">"application/dap-aggregation-job-resp" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-8.1.4-1">
            <dt id="section-8.1.4-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.4-1.2">
              <p id="section-8.1.4-1.2.1">application<a href="#section-8.1.4-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.4-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.4-1.4">
              <p id="section-8.1.4-1.4.1">dap-aggregation-job-resp<a href="#section-8.1.4-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.4-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.4-1.6">
              <p id="section-8.1.4-1.6.1">N/A<a href="#section-8.1.4-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.4-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.4-1.8">
              <p id="section-8.1.4-1.8.1">None<a href="#section-8.1.4-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.4-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.4-1.10">
              <p id="section-8.1.4-1.10.1">only "8bit" or "binary" is permitted<a href="#section-8.1.4-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.4-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.4-1.12">
              <p id="section-8.1.4-1.12.1">see <a href="#collect-flow" class="auto internal xref">Section 4.5</a><a href="#section-8.1.4-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.4-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.4-1.14">
              <p id="section-8.1.4-1.14.1">N/A<a href="#section-8.1.4-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.4-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.4-1.16">
              <p id="section-8.1.4-1.16.1">this specification<a href="#section-8.1.4-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.4-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.4-1.18">
              <p id="section-8.1.4-1.18.1">N/A<a href="#section-8.1.4-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.4-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.4-1.20">
              <p id="section-8.1.4-1.20.1">N/A<a href="#section-8.1.4-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.4-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.4-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-8.1.4-1.22.1">
                <dt id="section-8.1.4-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.4-1.22.1.2">N/A<a href="#section-8.1.4-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.1.4-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.4-1.22.1.4">N/A<a href="#section-8.1.4-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.1.4-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.4-1.22.1.6">N/A<a href="#section-8.1.4-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.1.4-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.4-1.22.1.8">N/A<a href="#section-8.1.4-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.4-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.4-1.24">
              <p id="section-8.1.4-1.24.1">see Authors' Addresses section<a href="#section-8.1.4-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.4-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.4-1.26">
              <p id="section-8.1.4-1.26.1">COMMON<a href="#section-8.1.4-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.4-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.4-1.28">
              <p id="section-8.1.4-1.28.1">N/A<a href="#section-8.1.4-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.4-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.4-1.30">
              <p id="section-8.1.4-1.30.1">see Authors' Addresses section<a href="#section-8.1.4-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.4-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.4-1.32">
              <p id="section-8.1.4-1.32.1">IESG<a href="#section-8.1.4-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="applicationdap-aggregation-job-continue-req-media-type">
<section id="section-8.1.5">
          <h4 id="name-application-dap-aggregation-j">
<a href="#section-8.1.5" class="section-number selfRef">8.1.5. </a><a href="#name-application-dap-aggregation-j" class="section-name selfRef">"application/dap-aggregation-job-continue-req" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-8.1.5-1">
            <dt id="section-8.1.5-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.5-1.2">
              <p id="section-8.1.5-1.2.1">application<a href="#section-8.1.5-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.5-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.5-1.4">
              <p id="section-8.1.5-1.4.1">dap-aggregation-job-continue-req<a href="#section-8.1.5-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.5-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.5-1.6">
              <p id="section-8.1.5-1.6.1">N/A<a href="#section-8.1.5-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.5-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.5-1.8">
              <p id="section-8.1.5-1.8.1">None<a href="#section-8.1.5-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.5-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.5-1.10">
              <p id="section-8.1.5-1.10.1">only "8bit" or "binary" is permitted<a href="#section-8.1.5-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.5-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.5-1.12">
              <p id="section-8.1.5-1.12.1">see <a href="#collect-flow" class="auto internal xref">Section 4.5</a><a href="#section-8.1.5-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.5-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.5-1.14">
              <p id="section-8.1.5-1.14.1">N/A<a href="#section-8.1.5-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.5-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.5-1.16">
              <p id="section-8.1.5-1.16.1">this specification<a href="#section-8.1.5-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.5-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.5-1.18">
              <p id="section-8.1.5-1.18.1">N/A<a href="#section-8.1.5-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.5-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.5-1.20">
              <p id="section-8.1.5-1.20.1">N/A<a href="#section-8.1.5-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.5-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.5-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-8.1.5-1.22.1">
                <dt id="section-8.1.5-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.5-1.22.1.2">N/A<a href="#section-8.1.5-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.1.5-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.5-1.22.1.4">N/A<a href="#section-8.1.5-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.1.5-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.5-1.22.1.6">N/A<a href="#section-8.1.5-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.1.5-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.5-1.22.1.8">N/A<a href="#section-8.1.5-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.5-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.5-1.24">
              <p id="section-8.1.5-1.24.1">see Authors' Addresses section<a href="#section-8.1.5-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.5-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.5-1.26">
              <p id="section-8.1.5-1.26.1">COMMON<a href="#section-8.1.5-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.5-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.5-1.28">
              <p id="section-8.1.5-1.28.1">N/A<a href="#section-8.1.5-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.5-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.5-1.30">
              <p id="section-8.1.5-1.30.1">see Authors' Addresses section<a href="#section-8.1.5-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.5-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.5-1.32">
              <p id="section-8.1.5-1.32.1">IESG<a href="#section-8.1.5-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="applicationdap-aggregate-share-req-media-type">
<section id="section-8.1.6">
          <h4 id="name-application-dap-aggregate-s">
<a href="#section-8.1.6" class="section-number selfRef">8.1.6. </a><a href="#name-application-dap-aggregate-s" class="section-name selfRef">"application/dap-aggregate-share-req" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-8.1.6-1">
            <dt id="section-8.1.6-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.6-1.2">
              <p id="section-8.1.6-1.2.1">application<a href="#section-8.1.6-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.6-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.6-1.4">
              <p id="section-8.1.6-1.4.1">dap-aggregate-share-req<a href="#section-8.1.6-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.6-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.6-1.6">
              <p id="section-8.1.6-1.6.1">N/A<a href="#section-8.1.6-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.6-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.6-1.8">
              <p id="section-8.1.6-1.8.1">None<a href="#section-8.1.6-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.6-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.6-1.10">
              <p id="section-8.1.6-1.10.1">only "8bit" or "binary" is permitted<a href="#section-8.1.6-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.6-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.6-1.12">
              <p id="section-8.1.6-1.12.1">see <a href="#collect-flow" class="auto internal xref">Section 4.5</a><a href="#section-8.1.6-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.6-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.6-1.14">
              <p id="section-8.1.6-1.14.1">N/A<a href="#section-8.1.6-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.6-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.6-1.16">
              <p id="section-8.1.6-1.16.1">this specification<a href="#section-8.1.6-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.6-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.6-1.18">
              <p id="section-8.1.6-1.18.1">N/A<a href="#section-8.1.6-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.6-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.6-1.20">
              <p id="section-8.1.6-1.20.1">N/A<a href="#section-8.1.6-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.6-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.6-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-8.1.6-1.22.1">
                <dt id="section-8.1.6-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.6-1.22.1.2">N/A<a href="#section-8.1.6-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.1.6-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.6-1.22.1.4">N/A<a href="#section-8.1.6-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.1.6-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.6-1.22.1.6">N/A<a href="#section-8.1.6-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.1.6-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.6-1.22.1.8">N/A<a href="#section-8.1.6-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.6-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.6-1.24">
              <p id="section-8.1.6-1.24.1">see Authors' Addresses section<a href="#section-8.1.6-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.6-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.6-1.26">
              <p id="section-8.1.6-1.26.1">COMMON<a href="#section-8.1.6-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.6-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.6-1.28">
              <p id="section-8.1.6-1.28.1">N/A<a href="#section-8.1.6-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.6-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.6-1.30">
              <p id="section-8.1.6-1.30.1">see Authors' Addresses section<a href="#section-8.1.6-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.6-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.6-1.32">
              <p id="section-8.1.6-1.32.1">IESG<a href="#section-8.1.6-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="applicationdap-aggregate-share-media-type">
<section id="section-8.1.7">
          <h4 id="name-application-dap-aggregate-sh">
<a href="#section-8.1.7" class="section-number selfRef">8.1.7. </a><a href="#name-application-dap-aggregate-sh" class="section-name selfRef">"application/dap-aggregate-share" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-8.1.7-1">
            <dt id="section-8.1.7-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.7-1.2">
              <p id="section-8.1.7-1.2.1">application<a href="#section-8.1.7-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.7-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.7-1.4">
              <p id="section-8.1.7-1.4.1">dap-aggregate-share<a href="#section-8.1.7-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.7-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.7-1.6">
              <p id="section-8.1.7-1.6.1">N/A<a href="#section-8.1.7-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.7-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.7-1.8">
              <p id="section-8.1.7-1.8.1">None<a href="#section-8.1.7-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.7-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.7-1.10">
              <p id="section-8.1.7-1.10.1">only "8bit" or "binary" is permitted<a href="#section-8.1.7-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.7-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.7-1.12">
              <p id="section-8.1.7-1.12.1">see <a href="#collect-flow" class="auto internal xref">Section 4.5</a><a href="#section-8.1.7-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.7-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.7-1.14">
              <p id="section-8.1.7-1.14.1">N/A<a href="#section-8.1.7-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.7-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.7-1.16">
              <p id="section-8.1.7-1.16.1">this specification<a href="#section-8.1.7-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.7-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.7-1.18">
              <p id="section-8.1.7-1.18.1">N/A<a href="#section-8.1.7-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.7-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.7-1.20">
              <p id="section-8.1.7-1.20.1">N/A<a href="#section-8.1.7-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.7-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.7-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-8.1.7-1.22.1">
                <dt id="section-8.1.7-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.7-1.22.1.2">N/A<a href="#section-8.1.7-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.1.7-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.7-1.22.1.4">N/A<a href="#section-8.1.7-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.1.7-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.7-1.22.1.6">N/A<a href="#section-8.1.7-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.1.7-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.7-1.22.1.8">N/A<a href="#section-8.1.7-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.7-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.7-1.24">
              <p id="section-8.1.7-1.24.1">see Authors' Addresses section<a href="#section-8.1.7-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.7-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.7-1.26">
              <p id="section-8.1.7-1.26.1">COMMON<a href="#section-8.1.7-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.7-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.7-1.28">
              <p id="section-8.1.7-1.28.1">N/A<a href="#section-8.1.7-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.7-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.7-1.30">
              <p id="section-8.1.7-1.30.1">see Authors' Addresses section<a href="#section-8.1.7-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.7-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.7-1.32">
              <p id="section-8.1.7-1.32.1">IESG<a href="#section-8.1.7-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="applicationdap-collect-req-media-type">
<section id="section-8.1.8">
          <h4 id="name-application-dap-collect-req">
<a href="#section-8.1.8" class="section-number selfRef">8.1.8. </a><a href="#name-application-dap-collect-req" class="section-name selfRef">"application/dap-collect-req" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-8.1.8-1">
            <dt id="section-8.1.8-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.8-1.2">
              <p id="section-8.1.8-1.2.1">application<a href="#section-8.1.8-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.8-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.8-1.4">
              <p id="section-8.1.8-1.4.1">dap-collect-req<a href="#section-8.1.8-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.8-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.8-1.6">
              <p id="section-8.1.8-1.6.1">N/A<a href="#section-8.1.8-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.8-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.8-1.8">
              <p id="section-8.1.8-1.8.1">None<a href="#section-8.1.8-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.8-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.8-1.10">
              <p id="section-8.1.8-1.10.1">only "8bit" or "binary" is permitted<a href="#section-8.1.8-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.8-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.8-1.12">
              <p id="section-8.1.8-1.12.1">see <a href="#collect-flow" class="auto internal xref">Section 4.5</a><a href="#section-8.1.8-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.8-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.8-1.14">
              <p id="section-8.1.8-1.14.1">N/A<a href="#section-8.1.8-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.8-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.8-1.16">
              <p id="section-8.1.8-1.16.1">this specification<a href="#section-8.1.8-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.8-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.8-1.18">
              <p id="section-8.1.8-1.18.1">N/A<a href="#section-8.1.8-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.8-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.8-1.20">
              <p id="section-8.1.8-1.20.1">N/A<a href="#section-8.1.8-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.8-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.8-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-8.1.8-1.22.1">
                <dt id="section-8.1.8-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.8-1.22.1.2">N/A<a href="#section-8.1.8-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.1.8-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.8-1.22.1.4">N/A<a href="#section-8.1.8-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.1.8-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.8-1.22.1.6">N/A<a href="#section-8.1.8-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.1.8-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.8-1.22.1.8">N/A<a href="#section-8.1.8-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.8-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.8-1.24">
              <p id="section-8.1.8-1.24.1">see Authors' Addresses section<a href="#section-8.1.8-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.8-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.8-1.26">
              <p id="section-8.1.8-1.26.1">COMMON<a href="#section-8.1.8-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.8-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.8-1.28">
              <p id="section-8.1.8-1.28.1">N/A<a href="#section-8.1.8-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.8-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.8-1.30">
              <p id="section-8.1.8-1.30.1">see Authors' Addresses section<a href="#section-8.1.8-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.8-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.8-1.32">
              <p id="section-8.1.8-1.32.1">IESG<a href="#section-8.1.8-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="applicationdap-collection-media-type">
<section id="section-8.1.9">
          <h4 id="name-application-dap-collection-">
<a href="#section-8.1.9" class="section-number selfRef">8.1.9. </a><a href="#name-application-dap-collection-" class="section-name selfRef">"application/dap-collection" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-8.1.9-1">
            <dt id="section-8.1.9-1.1">Type name:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.9-1.2">
              <p id="section-8.1.9-1.2.1">application<a href="#section-8.1.9-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.9-1.3">Subtype name:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.9-1.4">
              <p id="section-8.1.9-1.4.1">dap-collection<a href="#section-8.1.9-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.9-1.5">Required parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.9-1.6">
              <p id="section-8.1.9-1.6.1">N/A<a href="#section-8.1.9-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.9-1.7">Optional parameters:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.9-1.8">
              <p id="section-8.1.9-1.8.1">None<a href="#section-8.1.9-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.9-1.9">Encoding considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.9-1.10">
              <p id="section-8.1.9-1.10.1">only "8bit" or "binary" is permitted<a href="#section-8.1.9-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.9-1.11">Security considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.9-1.12">
              <p id="section-8.1.9-1.12.1">see <a href="#collect-flow" class="auto internal xref">Section 4.5</a><a href="#section-8.1.9-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.9-1.13">Interoperability considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.9-1.14">
              <p id="section-8.1.9-1.14.1">N/A<a href="#section-8.1.9-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.9-1.15">Published specification:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.9-1.16">
              <p id="section-8.1.9-1.16.1">this specification<a href="#section-8.1.9-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.9-1.17">Applications that use this media type:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.9-1.18">
              <p id="section-8.1.9-1.18.1">N/A<a href="#section-8.1.9-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.9-1.19">Fragment identifier considerations:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.9-1.20">
              <p id="section-8.1.9-1.20.1">N/A<a href="#section-8.1.9-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.9-1.21">Additional information:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.9-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-8.1.9-1.22.1">
                <dt id="section-8.1.9-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.9-1.22.1.2">N/A<a href="#section-8.1.9-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.1.9-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.9-1.22.1.4">N/A<a href="#section-8.1.9-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.1.9-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.9-1.22.1.6">N/A<a href="#section-8.1.9-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-8.1.9-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-8.1.9-1.22.1.8">N/A<a href="#section-8.1.9-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.9-1.23">Person and email address to contact for further information:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.9-1.24">
              <p id="section-8.1.9-1.24.1">see Authors' Addresses section<a href="#section-8.1.9-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.9-1.25">Intended usage:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.9-1.26">
              <p id="section-8.1.9-1.26.1">COMMON<a href="#section-8.1.9-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.9-1.27">Restrictions on usage:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.9-1.28">
              <p id="section-8.1.9-1.28.1">N/A<a href="#section-8.1.9-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.9-1.29">Author:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.9-1.30">
              <p id="section-8.1.9-1.30.1">see Authors' Addresses section<a href="#section-8.1.9-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-8.1.9-1.31">Change controller:</dt>
            <dd style="margin-left: 1.5em" id="section-8.1.9-1.32">
              <p id="section-8.1.9-1.32.1">IESG<a href="#section-8.1.9-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="query-type-reg">
<section id="section-8.2">
        <h3 id="name-query-types-registry">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-query-types-registry" class="section-name selfRef">Query Types Registry</a>
        </h3>
<p id="section-8.2-1">This document requests creation of a new registry for Query Types. This registry
should contain the following columns:<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<p id="section-8.2-2">[TODO: define how we want to structure this registry when the time comes]<a href="#section-8.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="upload-extension-registry">
<section id="section-8.3">
        <h3 id="name-upload-extension-registry">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-upload-extension-registry" class="section-name selfRef">Upload Extension Registry</a>
        </h3>
<p id="section-8.3-1">This document requests creation of a new registry for extensions to the Upload
protocol. This registry should contain the following columns:<a href="#section-8.3-1" class="pilcrow">¶</a></p>
<p id="section-8.3-2">[TODO: define how we want to structure this registry when the time comes]<a href="#section-8.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="urn-space">
<section id="section-8.4">
        <h3 id="name-urn-sub-namespace-for-dap-u">
<a href="#section-8.4" class="section-number selfRef">8.4. </a><a href="#name-urn-sub-namespace-for-dap-u" class="section-name selfRef">URN Sub-namespace for DAP (urn:ietf:params:ppm:dap)</a>
        </h3>
<p id="section-8.4-1">The following value [will be/has been] registered in the "IETF URN Sub-namespace
for Registered Protocol Parameter Identifiers" registry, following the template
in <span>[<a href="#RFC3553" class="cite xref">RFC3553</a>]</span>:<a href="#section-8.4-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-8.4-2">
<pre>
Registry name:  dap

Specification:  [[THIS DOCUMENT]]

Repository:  http://www.iana.org/assignments/dap

Index value:  No transformation needed.
</pre><a href="#section-8.4-2" class="pilcrow">¶</a>
</div>
<p id="section-8.4-3">Initial contents: The types and descriptions in the table in <a href="#errors" class="auto internal xref">Section 3.2</a> above,
with the Reference field set to point to this specification.<a href="#section-8.4-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="acknowledgments">
<section id="section-9">
      <h2 id="name-acknowledgments">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="section-9-1">The text in <a href="#message-transport" class="auto internal xref">Section 3</a> is based extensively on <span>[<a href="#RFC8555" class="cite xref">RFC8555</a>]</span><a href="#section-9-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-10">
      <h2 id="name-references">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-10.1">
        <h3 id="name-normative-references">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="HPKE">[HPKE]</dt>
        <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Bhargavan, K.</span>, <span class="refAuthor">Lipp, B.</span>, and <span class="refAuthor">C. Wood</span>, <span class="refTitle">"Hybrid Public Key Encryption"</span>, <span class="seriesInfo">RFC 9180</span>, <span class="seriesInfo">DOI 10.17487/RFC9180</span>, <time datetime="2022-02" class="refDate">February 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9180">https://www.rfc-editor.org/rfc/rfc9180</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.draft-ietf-ohai-ohttp-07">[I-D.draft-ietf-ohai-ohttp-07]</dt>
        <dd>
<span class="refAuthor">Thomson, M.</span> and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Oblivious HTTP"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ohai-ohttp-07</span>, <time datetime="2023-03-09" class="refDate">9 March 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-ohai-ohttp-07">https://datatracker.ietf.org/doc/html/draft-ietf-ohai-ohttp-07</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="OAuth2">[OAuth2]</dt>
        <dd>
<span class="refAuthor">Hardt, D., Ed.</span>, <span class="refTitle">"The OAuth 2.0 Authorization Framework"</span>, <span class="seriesInfo">RFC 6749</span>, <span class="seriesInfo">DOI 10.17487/RFC6749</span>, <time datetime="2012-10" class="refDate">October 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6749">https://www.rfc-editor.org/rfc/rfc6749</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3553">[RFC3553]</dt>
        <dd>
<span class="refAuthor">Mealling, M.</span>, <span class="refAuthor">Masinter, L.</span>, <span class="refAuthor">Hardie, T.</span>, and <span class="refAuthor">G. Klyne</span>, <span class="refTitle">"An IETF URN Sub-namespace for Registered Protocol Parameters"</span>, <span class="seriesInfo">BCP 73</span>, <span class="seriesInfo">RFC 3553</span>, <span class="seriesInfo">DOI 10.17487/RFC3553</span>, <time datetime="2003-06" class="refDate">June 2003</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc3553">https://www.rfc-editor.org/rfc/rfc3553</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4648">[RFC4648]</dt>
        <dd>
<span class="refAuthor">Josefsson, S.</span>, <span class="refTitle">"The Base16, Base32, and Base64 Data Encodings"</span>, <span class="seriesInfo">RFC 4648</span>, <span class="seriesInfo">DOI 10.17487/RFC4648</span>, <time datetime="2006-10" class="refDate">October 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc4648">https://www.rfc-editor.org/rfc/rfc4648</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5861">[RFC5861]</dt>
        <dd>
<span class="refAuthor">Nottingham, M.</span>, <span class="refTitle">"HTTP Cache-Control Extensions for Stale Content"</span>, <span class="seriesInfo">RFC 5861</span>, <span class="seriesInfo">DOI 10.17487/RFC5861</span>, <time datetime="2010-05" class="refDate">May 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5861">https://www.rfc-editor.org/rfc/rfc5861</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7807">[RFC7807]</dt>
        <dd>
<span class="refAuthor">Nottingham, M.</span> and <span class="refAuthor">E. Wilde</span>, <span class="refTitle">"Problem Details for HTTP APIs"</span>, <span class="seriesInfo">RFC 7807</span>, <span class="seriesInfo">DOI 10.17487/RFC7807</span>, <time datetime="2016-03" class="refDate">March 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7807">https://www.rfc-editor.org/rfc/rfc7807</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8446">[RFC8446]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8446">https://www.rfc-editor.org/rfc/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9110">[RFC9110]</dt>
        <dd>
<span class="refAuthor">Fielding, R., Ed.</span>, <span class="refAuthor">Nottingham, M., Ed.</span>, and <span class="refAuthor">J. Reschke, Ed.</span>, <span class="refTitle">"HTTP Semantics"</span>, <span class="seriesInfo">STD 97</span>, <span class="seriesInfo">RFC 9110</span>, <span class="seriesInfo">DOI 10.17487/RFC9110</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9110">https://www.rfc-editor.org/rfc/rfc9110</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9111">[RFC9111]</dt>
        <dd>
<span class="refAuthor">Fielding, R., Ed.</span>, <span class="refAuthor">Nottingham, M., Ed.</span>, and <span class="refAuthor">J. Reschke, Ed.</span>, <span class="refTitle">"HTTP Caching"</span>, <span class="seriesInfo">STD 98</span>, <span class="seriesInfo">RFC 9111</span>, <span class="seriesInfo">DOI 10.17487/RFC9111</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9111">https://www.rfc-editor.org/rfc/rfc9111</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SHS">[SHS]</dt>
        <dd>
<span class="refAuthor">Dang, Q.</span>, <span class="refTitle">"Secure Hash Standard"</span>, <span class="seriesInfo">National Institute of Standards and Technology report</span>, <span class="seriesInfo">DOI 10.6028/nist.fips.180-4</span>, <time datetime="2015-07" class="refDate">July 2015</time>, <span>&lt;<a href="https://doi.org/10.6028/nist.fips.180-4">https://doi.org/10.6028/nist.fips.180-4</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="VDAF">[VDAF]</dt>
      <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Cook, D.</span>, <span class="refAuthor">Patton, C.</span>, and <span class="refAuthor">P. Schoppmann</span>, <span class="refTitle">"Verifiable Distributed Aggregation Functions"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-irtf-cfrg-vdaf-05</span>, <time datetime="2023-03-13" class="refDate">13 March 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-05">https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-vdaf-05</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-10.2">
        <h3 id="name-informative-references">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="BBCGGI19">[BBCGGI19]</dt>
        <dd>
<span class="refAuthor">Boneh, D.</span>, <span class="refAuthor">Boyle, E.</span>, <span class="refAuthor">Corrigan-Gibbs, H.</span>, <span class="refAuthor">Gilboa, N.</span>, and <span class="refAuthor">Y. Ishai</span>, <span class="refTitle">"Zero-Knowledge Proofs on Secret-Shared Data via Fully Linear PCPs"</span>, <time datetime="2021-01-05" class="refDate">5 January 2021</time>, <span>&lt;<a href="https://eprint.iacr.org/2019/188">https://eprint.iacr.org/2019/188</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="BBCGGI21">[BBCGGI21]</dt>
        <dd>
<span class="refAuthor">Boneh, D.</span>, <span class="refAuthor">Boyle, E.</span>, <span class="refAuthor">Corrigan-Gibbs, H.</span>, <span class="refAuthor">Gilboa, N.</span>, and <span class="refAuthor">Y. Ishai</span>, <span class="refTitle">"Lightweight Techniques for Private Heavy Hitters"</span>, <time datetime="2021-01-05" class="refDate">5 January 2021</time>, <span>&lt;<a href="https://eprint.iacr.org/2021/017">https://eprint.iacr.org/2021/017</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CGB17">[CGB17]</dt>
        <dd>
<span class="refAuthor">Corrigan-Gibbs, H.</span> and <span class="refAuthor">D. Boneh</span>, <span class="refTitle">"Prio: Private, Robust, and Scalable Computation of Aggregate Statistics"</span>, <time datetime="2017-03-14" class="refDate">14 March 2017</time>, <span>&lt;<a href="https://crypto.stanford.edu/prio/paper.pdf">https://crypto.stanford.edu/prio/paper.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="Dou02">[Dou02]</dt>
        <dd>
<span class="refAuthor">Douceur, J.</span>, <span class="refTitle">"The Sybil Attack"</span>, <time datetime="2022-10-10" class="refDate">10 October 2022</time>, <span>&lt;<a href="https://link.springer.com/chapter/10.1007/3-540-45748-8_24">https://link.springer.com/chapter/10.1007/3-540-45748-8_24</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8555">[RFC8555]</dt>
        <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Hoffman-Andrews, J.</span>, <span class="refAuthor">McCarney, D.</span>, and <span class="refAuthor">J. Kasten</span>, <span class="refTitle">"Automatic Certificate Management Environment (ACME)"</span>, <span class="seriesInfo">RFC 8555</span>, <span class="seriesInfo">DOI 10.17487/RFC8555</span>, <time datetime="2019-03" class="refDate">March 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8555">https://www.rfc-editor.org/rfc/rfc8555</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="Vad16">[Vad16]</dt>
      <dd>
<span class="refAuthor">Vadhan, S.</span>, <span class="refTitle">"The Complexity of Differential Privacy"</span>, <time datetime="2016-08-09" class="refDate">9 August 2016</time>, <span>&lt;<a href="https://privacytools.seas.harvard.edu/files/privacytools/files/complexityprivacy_1.pdf">https://privacytools.seas.harvard.edu/files/privacytools/files/complexityprivacy_1.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="authors-addresses">
<section id="appendix-A">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Tim Geoghegan</span></div>
<div dir="auto" class="left"><span class="org">ISRG</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:timgeog+ietf@gmail.com" class="email">timgeog+ietf@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Christopher Patton</span></div>
<div dir="auto" class="left"><span class="org">Cloudflare</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:chrispatton+ietf@gmail.com" class="email">chrispatton+ietf@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Eric Rescorla</span></div>
<div dir="auto" class="left"><span class="org">Mozilla</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:ekr@rtfm.com" class="email">ekr@rtfm.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Christopher A. Wood</span></div>
<div dir="auto" class="left"><span class="org">Cloudflare</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:caw@heapingbits.net" class="email">caw@heapingbits.net</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
